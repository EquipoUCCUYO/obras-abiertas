"use strict";function fetchId(a){var b=/^(?:https?:\/\/)?(?:www\.)?(?:youtu\.be\/|youtube\.com\/(?:embed\/|v\/|watch\?v=|watch\?.+&v=))((\w|-){11})(?:\S+)?$/,c=/^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=)([^#\&\?]*).*/,d=(a.match(c),a.match(b));if(null!==d){return d[1]}}function getYoutubePic(a){return"https://img.youtube.com/vi/"+fetchId(a)+"/hqdefault.jpg;"}angular.module("obrasMduytApp",["ngRoute","ngSanitize","slugifier","angular-flexslider","leaflet-directive","ngYoutubeEmbed","ngTable"]).config(["$routeProvider","$logProvider","$httpProvider","$locationProvider","$provide","$sceDelegateProvider",function(a,b,c,d,e,f){a.when("/home",{templateUrl:"views/home.html",controller:"HomeCtrl",controllerAs:"home"}).when("/buscador",{templateUrl:"views/buscador.html",controller:"BuscadorCtrl",controllerAs:"buscador"}).when("/obra/:id",{templateUrl:"views/obra.html",controller:"ObraCtrl",controllerAs:"obra"}).when("/entorno/:entorno",{templateUrl:"views/entorno.html",controller:"EntornoCtrl",controllerAs:"entorno"}).otherwise({redirectTo:"/home"}),b.debugEnabled(!1),d.hashPrefix(""),e.decorator("$locale",["$delegate",function(a){return a.NUMBER_FORMATS.DECIMAL_SEP=",",a.NUMBER_FORMATS.GROUP_SEP=".",a}]),f.resourceUrlWhitelist(["self","*://ws.usig.buenosaires.gob.ar/**"])}]).service("DataService",["$http","$q","Slug","$sce",function(a,b,c,d){var e,f,g=function(a){var b=5e7;return _.inRange(a,0,b)?"monto_0_50":_.inRange(a,b,2*b)?"monto_50_100":_.inRange(a,2*b,3*b)?"monto_100_150":"monto_mas_50"},h=function(a){var b={};for(var d in a)a.hasOwnProperty(d)&&(b[d.toLowerCase()]=a[d]);b.compromiso="SI"==b.compromiso,b.destacada="SI"==b.destacada,b.ba_elige="SI"==b.ba_elige;var e=b.comuna?b.comuna.split("|"):[null];b.comuna=e[0],b.comuna=b.comuna?parseInt(b.comuna.trim()):b.comuna,b.barrio=b.barrio?b.barrio.split("|"):[],b.licitacion_oferta_empresa=b.licitacion_oferta_empresa?b.licitacion_oferta_empresa:null,b.mano_obra=b.mano_obra?parseInt(b.mano_obra):null,b.id=parseInt(b.id),b.licitacion_anio=b.licitacion_anio?parseInt(b.licitacion_anio.trim()):null,b.monto_contrato=b.monto_contrato?parseFloat(b.monto_contrato.trim()):null,b.licitacion_presupuesto_oficial=b.licitacion_presupuesto_oficial?parseFloat(b.licitacion_presupuesto_oficial.trim()):null,b.plazo_meses=b.plazo_meses?parseInt(b.plazo_meses.trim()):null,b.porcentaje_avance=b.porcentaje_avance?b.porcentaje_avance.trim():"",b.porcentaje_avance.trim(),b.porcentaje_avance=isNaN(b.porcentaje_avance)?"":b.porcentaje_avance,b.porcentaje_avance=b.porcentaje_avance?parseFloat(b.porcentaje_avance):null,b.porcentaje_avance="Finalizada"===b.etapa?100:b.porcentaje_avance,b.hideDates="En proyecto"===b.etapa||"En licitación"===b.etapa,b.fotos=[];for(var f=1;f<=4;f++){var d="imagen_"+f;b[d]&&(b.fotos[f-1]=b[d])}return b.thumb=b.fotos[0]?b.fotos[0]:"",b.slides=b.fotos.map(function(a){return{mode:a.includes("youtu")?"video":"photo",url:a,pic:a.includes("youtu")?getYoutubePic(a):a}}),b.entorno_slug=b.entorno?c.slugify(b.entorno.trim()):null,b.etapa_slug=b.etapa?c.slugify(b.etapa.trim()):null,b.tipo_slug=b.tipo?c.slugify(b.tipo.trim()):null,b.area_slug=b.area_responsable?c.slugify(b.area_responsable.trim()):null,b.red_slug=b.red?c.slugify(b.red.trim()):null,b.monto_slug=b.monto_contrato?g(b.monto_contrato):null,b.map=b.lat&&b.lng?"https://maps.googleapis.com/maps/api/staticmap?center="+b.lat+","+b.lng+"&zoom=18&size=300x100&maptype=roadmap&markers=color:blue%7Clabel:%7C"+b.lat+","+b.lng+"&key=AIzaSyBNzIaO8-waiNE1fjdDOAI4TN00ALkOa4o":"",b},i=["en-proyecto","en-licitacion","en-ejecucion","finalizada"],j=function(a){return i.indexOf(a.etapa_slug)>-1},k=function(){window.MDUYT_CONFIG||(console.warn("Archivo de configuración inexistente, utilizando configuración default de desarrollo."),window.MDUYT_CONFIG={BASE_URL:"http://csv-to-api-compromisos.herokuapp.com/",HOME_CSV:"https://goo.gl/vcb6oX",MAPAS_CSV:"https://goo.gl/YYV2E7"},window.location.href.indexOf("dist")>-1?L.Icon.Default.imagePath="/dist/images":L.Icon.Default.imagePath="images")},l=function(){k();var a=window.MDUYT_CONFIG.BASE_URL+"?source_format=csv&source="+window.MDUYT_CONFIG.HOME_CSV;return d.trustAsResourceUrl(a)},m=function(){k();var a="";return window.MDUYT_CONFIG.MAPAS_CSV&&(a=window.MDUYT_CONFIG.BASE_URL+"?source_format=csv&source="+window.MDUYT_CONFIG.MAPAS_CSV),d.trustAsResourceUrl(a)};this.getById=function(a){var c,d=b.defer();return this.retrieveAll().then(function(b){c=b.filter(function(b){return b.id===parseInt(a)}),d.resolve(c[0])}),c=d.promise,b.when(c)},this.getByEntorno=function(a){var c,d=b.defer();return this.retrieveAll().then(function(b){c=b.filter(function(b){return b.entorno_slug===a}),d.resolve(c)}),c=d.promise,b.when(c)},this.getAll=function(){var a,c=b.defer();return this.retrieveAll().then(function(a){c.resolve(a)}),a=c.promise,b.when(a)},this.getMapas=function(){var a,c=b.defer();return this.retrieveMapas().then(function(a){c.resolve(a)}),a=c.promise,b.when(a)},this.retrieveMapas=function(){var c=m(),d=b.defer();return""==c&&(f=[]),f||(a.jsonp(c).then(function(a){f=a.data,d.resolve(f)},function(a){console.log("error: ",a),e=a,d.reject(a)}),f=d.promise),b.when(f)},this.retrieveAll=function(){if(!e){var c=b.defer();a.jsonp(l()).then(function(a){e=a.data.map(h).filter(j),c.resolve(e)},function(a){e=a,c.reject(a)}),e=c.promise}return b.when(e)}}]).filter("capitalize",function(){return function(a){return a?a.charAt(0).toUpperCase()+a.substr(1).toLowerCase():""}}).filter("cleanunderscore",function(){return function(a){return a.replace(/_/g," ")}}).run(function(){}),angular.module("obrasMduytApp").directive("progressLine",function(){return{restrict:"E",replace:!0,scope:{callback:"=callback",class:"=class"},controller:["$scope","$timeout","$http",function(a,b,c){a.loading=!0;var d=function(){var b=a.obra,c=moment(b.fecha_inicio),d=moment(b.fecha_fin_inicial),e=moment(),f=d3.scale.linear().domain([0,100]).range([c.valueOf(),d.valueOf()]),g=e.valueOf(),h=parseFloat(b.porcentaje_avance);h<100&&(g=f(h));var i,j,k,l,i=[{label:"Category 1",value:g}],m=0,n=document.querySelectorAll(".chart")[0].clientWidth,o=55,p=5,q=0,r=d3.scale.linear().domain([c.valueOf(),d.valueOf()]).range([0,n]);d.valueOf();d3.select(".chart").html("");var k=d3.select(".chart").append("svg").attr("width",n).attr("height",o);j=k.selectAll("g").data(i).enter().append("g"),j.attr("class","bar").attr("cx",0).attr("transform",function(a,b){return"translate("+m+","+(b*(p+q)+q)+")"}),l=r,d3.svg.axis().scale(l).tickSize(2).orient("bottom"),j.append("rect").attr("transform","translate(0, 15)").attr("height",1).attr("width",function(a){return l(f(100))}),k.append("g").append("text").attr("class","value").attr("y",30).attr("x",0).attr("dx",0).attr("dy","0").attr("text-anchor","start").text("Inicio"),k.append("g").append("text").attr("class","value").attr("y",45).attr("x",0).attr("dx",0).attr("dy","0").attr("text-anchor","start").text(c.format("MM-YYYY")),k.append("g").append("text").attr("class","value").attr("y",30).attr("x",n).attr("dx",0).attr("dy","0").attr("text-anchor","end").text("Fin"),k.append("g").append("text").attr("class","value").attr("y",45).attr("x",n).attr("dx",0).attr("dy","0").attr("text-anchor","end").text(d.format("MM-YYYY"))},e=function(b){a.obra=b,setTimeout(d,100)};a.resizeFunction=d,a.callback(e);var f;$(window).resize(function(){clearTimeout(f),f=setTimeout(function(){a.resizeFunction&&a.resizeFunction()},500)})}],template:'<div class="chart"></div>'}}),angular.module("obrasMduytApp").directive("coloredIcons",function(){return{restrict:"E",replace:!0,scope:{callback:"=callback",scale:"=scale",class:"=class"},controller:["$scope","$element","$timeout","$http",function(a,b,c,d){a.loading=!0;a.scale;a.id="content-"+Math.floor(1e4*Math.random());var e=(a.id,function(c){b[0].clientWidth;setTimeout(function(){function d(a){var b=(a.percent,g*h),c=b*(a.percent/100),d=c%1;d3.selectAll("use").attr("fill",function(a,b){return a<c-1?"#f1662f":a>c-1&&a<c?(f.append("svg:stop").attr("offset",100*d+"%").attr("stop-color","#f1662f").attr("stop-opacity",1),f.append("svg:stop").attr("offset",100*d+"%").attr("stop-color","#aaa").attr("stop-opacity",1),f.append("svg:stop").attr("offset","100%").attr("stop-color","#aaa").attr("stop-opacity",1),"url(#gradient)"):"#aaa"})}d3.select(b[0]).html("");var e=d3.select(b[0]).append("svg").attr("viewBox","0 0 100 16"),f=e.append("svg:defs").append("svg:linearGradient").attr("id","gradient").attr("y1","100%").attr("y2","0%").attr("spreadMethod","pad");f.append("svg:stop").attr("offset","0%").attr("stop-color","#f1662f").attr("stop-opacity",1),e.append("defs").append("g").attr("id","iconCustom").append("path").attr("d","M3.5,2H2.7C3,1.8,3.3,1.5,3.3,1.1c0-0.6-0.4-1-1-1c-0.6,0-1,0.4-1,1c0,0.4,0.2,0.7,0.6,0.9H1.1C0.7,2,0.4,2.3,0.4,2.6v1.9c0,0.3,0.3,0.6,0.6,0.6h0.2c0,0,0,0.1,0,0.1v1.9c0,0.3,0.2,0.6,0.3,0.6h1.3c0.2,0,0.3-0.3,0.3-0.6V5.3c0,0,0-0.1,0-0.1h0.2c0.3,0,0.6-0.3,0.6-0.6V2.6C4.1,2.3,3.8,2,3.5,2z"),e.append("rect").attr("width",100).attr("height",10).attr("fill","#efefef");var g=22,h=1,i=d3.range(g*h);e.append("text").attr("id","txtValue").attr("x",1).attr("y",15).attr("dy",0).text("Manzana"),e.append("text").attr("id","txtValue").attr("x",30).attr("y",15).attr("dy",0).text("Barrio"),e.append("text").attr("id","txtValue").attr("x",60).attr("y",15).attr("dy",0).text("Comuna"),e.append("text").attr("id","txtValue").attr("x",85.5).attr("y",15).attr("dy",0).text("Ciudad"),e.append("g").attr("id","pictoLayer").selectAll("use").data(i).enter().append("use").attr("xlink:href","#iconCustom").attr("id",function(a){return"icon"+a}).attr("x",function(a){return 2+a%g*4.3}).attr("y",function(a){return 1+4.3*Math.floor(a/g)}).classed("iconPlain",!0);var j=1,k=1;"manoDeObra"===a.scale&&(j=20,k=c.mano_obra),"beneficiarios"===a.scale&&(j=5e4,k=c.benficiarios),d({percent:100*k/(j*g)})},300)});a.callback(e)}],template:"<div class='colored'></div>"}}),angular.module("obrasMduytApp").directive("selectorHome",function(){return{restrict:"E",scope:{list:"=",updateFn:"&",selectedGroup:"="},template:"<div id='selector-home' class='row' ng-show='selectedGroup'><div ng-repeat='(key, g) in list' class='col-md-3 selector' ng-class='{\"selectorSelected\":selectedGroup==g.id}'><a ng-click='updateFn({group:g.id})'><img ng-src=\"{{'images/selectores/'+g.id+'.svg'}}\"/><span>{{g.name}}</span></a></div></div>",replace:!0,link:function(a,b,c){}}}),angular.module("obrasMduytApp").directive("statsHome",["$timeout","$interval",function(a,b){return{restrict:"E",scope:{obras:"="},templateUrl:"views/includes/stats-home.html",replace:!0,link:function(a,c,d){function e(){_.map(g,function(b){a.total.obras+=1,b.monto_contrato&&(a.total.inversion+=b.monto_contrato),b.mano_obra&&(a.total.mano_obra+=b.mano_obra),100==b.porcentaje_avance&&(a.total.finalizadas+=1,a.total.porcentaje_finalizadas=Math.round(100*a.total.finalizadas/a.total.obras))})}function f(){a.counter_steps=20,a.current_step=0;var c=b(function(){a.counter_steps==a.current_step?b.cancel(c):(angular.forEach(a.total,function(b,c){a.totalTemp[c]=a.totalRender[c]+a.total[c]/a.counter_steps}),a.totalRender=angular.copy(a.totalTemp)),a.current_step++},200)}a.total={inversion:0,obras:0,finalizadas:0,mano_obra:0,porcentaje_finalizadas:0},a.totalTemp=angular.copy(a.total),a.totalRender=angular.copy(a.total);var g;a.$watch(d.obras,function(a){a&&(g=angular.copy(a),e(),f())})}}}]),angular.module("obrasMduytApp").directive("tipoChart",function(){return{restrict:"E",scope:{labels:"=",obras:"=",filterFn:"&",finishFn:"&",selectedFilter:"=",tipoColors:"="},template:"<div class='row chart-item'><div id='tipo-chart'><div class='col-md-2'><h4>Filtrar por tipo de obra</h4></div></div><div class='col-md-2'><p></p></div><div class='col-md-10 label-slug'><h3></h3></div></div>",replace:!0,link:function(a,b,c){function d(){var b=_.groupBy(j.filter(function(a){return void 0!==a.tipo}),"tipo");a.total_obras_by_tipo=_.orderBy(_.reduce(b,function(a,b,c){return a.push({tipo:c,slug:b[0].tipo_slug,cantidad:b.length}),a},[]),"cantidad","desc"),e(),window.$(window).resize(function(){i!=$(window).width()&&(clearTimeout(a.timeoutId),a.timeoutId=setTimeout(function(){e()},1e3))})}function e(){k.w=d3.select("#tipo-chart").node().getBoundingClientRect().width,k.margin=k.w/100,k.barh=40,k.gap=10,k.h=a.total_obras_by_tipo.length*(k.barh+k.gap)+2*k.gap,k.tipo_chart_container||(k.tipo_chart_container=d3.select("#tipo-chart").append("div").attr("id","tipo-chart-container").classed("col-md-10",!0),k.groups=k.tipo_chart_container.selectAll("div.tipo-group").data(a.total_obras_by_tipo),k.groups.enter().append("div").attr("id",function(a){return"tipo-group-"+a.slug}).classed("tipo-group",!0).each(function(b){var c=d3.select(this),d=c.append("a").datum(b).classed("tipo-container",!0).on("click",function(b){a.filterFn({filter:b.slug}),g?g&&h!=b.slug?($(".label-slug h3").html(a.labels[b.slug]),h=b.slug):g&&h==b.slug&&($(".label-slug h3").html(""),g=!1):($(".label-slug h3").html(a.labels[b.slug]),h=b.slug,g=!0)}),e=d.append("div").classed("image-container",!0);d.append("span").datum(b).classed("tipo-text",!0).attr("fill","#fff").text(function(){return b.tipo}),d3.xml("images/iconos/"+b.slug+".svg",function(c,d){if(c)return void console.error(c);var f=d.getElementsByTagName("svg")[0];e.node().appendChild(f);var g=a.tipoColors(b.tipo);e.select("svg").attr("height",50).attr("width",50).selectAll("path,rect").attr("fill",g)})})),a.finishFn()}function f(){if(a.selectedFilter){var b=k.tipo_chart_container.select("#tipo-group-"+a.selectedFilter);b.empty()?k.tipo_chart_container.selectAll(".tipo-group").classed("selected",!1):(k.tipo_chart_container.selectAll(".tipo-group").classed("selected",!1),b.classed("selected",!0))}else k.tipo_chart_container.selectAll(".tipo-group").classed("selected",!1)}var g=!1,h="",i=0;$(window).load(function(){i=$(window).width()});var j,k={};a.$watch(c.obras,function(a){a&&"object"==typeof a&&(j=a,d())}),a.$watch(c.selectedFilter,function(a){k.groups&&f()})}}}),angular.module("obrasMduytApp").directive("etapaChart",function(){return{restrict:"E",scope:{obras:"=",filterFn:"&",selectedFilter:"=",tipoColors:"="},template:"<div id='etapa-chart'></div>",replace:!0,link:function(a,b,c){function d(){a.obras_by_etapa=_.map(_.groupBy(h.filter(function(a){return void 0!==a.etapa}),"etapa"),function(a,b){var c=_.groupBy(a.filter(function(a){return void 0!==a.tipo}),"tipo"),d={slug:a[0].etapa_slug,etapa:a[0].etapa,obras:_.orderBy(_.reduce(c,function(a,b,c){return a.push({tipo:c,slug:b[0].tipo_slug,cantidad:b.length}),a},[]),"cantidad","desc")};return d.cantidad=d3.sum(d.obras,function(a){return a.cantidad}),d}),e()}function e(){i.w=d3.select("#etapa-chart").node().getBoundingClientRect().width,i.margin=i.w/100,i.barh=40,i.gap=10,i.h=2*i.barh+2*i.gap,i.svg||(i.svg=d3.select("#etapa-chart").append("svg"),i.mainGroup=i.svg.append("g").classed("main-group",!0),i.selection=i.mainGroup.append("rect").classed("selection",!0).attr("height",i.gap+i.barh).attr("x",i.w).attr("y",i.barh).attr("fill","#ffbc00"),i.pipe=i.mainGroup.append("line").classed("pipe",!0).attr("height",i.h).attr("y1",i.barh/2).attr("y2",2*i.barh+2*i.gap).attr("fill","black").attr("stroke","black").attr("stroke-width",1)),i.max=d3.max(a.obras_by_etapa,function(a){return a.cantidad}),i.scale=d3.scale.linear().domain([0,i.max]).range([0,i.w/2-2*i.gap]),i.svg.attr("width",i.w).attr("height",i.h),i.selection.attr("width",i.w/2-i.gap),i.groups=i.mainGroup.selectAll("g.etapa-group").data(a.obras_by_etapa),i.pipe.attr("x1",i.w/2).attr("x2",i.w/2),i.groups.enter().append("g").attr("id",function(a){return"etapa-group-"+a.slug}).classed("etapa-group",!0).each(function(b,c){var d=d3.select(this);b.index=c,_.map(b.obras,function(a){return a.index=c,a}),d.selectAll("rect.etapa-rect").data(b.obras).enter().append("rect").classed("etapa-rect",!0).attr("y",i.barh+i.gap).attr("height",i.barh).attr("fill",function(b){return a.tipoColors(b.tipo)}),d.append("text").datum(b).classed("etapa-text",!0).attr("fill","#000").attr("y",i.barh).text(function(){return b.etapa}).attr("text-anchor",function(){return 0==c?"end":"start"}),d.append("rect").datum(b).classed("click-rect",!0).attr("fill","red").attr("fill-opacity",0).on("click",function(b){a.filterFn({filter:b.slug})})});var b={g0:i.scale(i.max)+i.gap,g1:i.gap};i.groups.selectAll("rect.etapa-rect").attr("width",function(a){return i.scale(a.cantidad)}).attr("x",function(a){var c=a.cantidad,d=0==a.index?Math.abs(i.scale(c)-b["g"+a.index]):i.scale(0)+b["g"+a.index];return b["g"+a.index]=0==a.index?b["g"+a.index]-i.scale(c):b["g"+a.index]+i.scale(c),d}),i.groups.selectAll("text.etapa-text").attr("x",function(a){return 0==a.index?i.w/2-i.gap:i.gap}),i.groups.selectAll("rect.click-rect").attr("width",i.w/2).attr("height",2*i.barh+2*i.gap),i.groups.transition().attr("transform",function(a,b){return"translate("+(0==b?0:i.w/2)+",0)"})}function f(){if(a.selectedFilter){var b=i.mainGroup.select("#etapa-group-"+a.selectedFilter);if(b.empty())i.selection.transition().attr("x",i.w);else{var c=d3.transform(b.attr("transform")),d=c.translate[0],e=c.translate[1];i.selection.transition().attr("x",d+i.gap/2).attr("y",e+i.barh+i.gap/2)}}else i.selection.transition().attr("x",i.w)}var g=0;$(window).load(function(){g=$(window).width()});var h,i={};a.$watch(c.obras,function(a){a&&(h=a,d())}),a.$watch(c.selectedFilter,function(a){i.groups&&f()}),window.$(window).resize(function(){g!=$(window).width()&&(clearTimeout(a.timeoutId),a.timeoutId=setTimeout(function(){e()},1e3))})}}}),angular.module("obrasMduytApp").directive("areaResponsableChart",function(){return{restrict:"E",scope:{obras:"=",filterFn:"&",selectedFilter:"="},template:"<div id='area-responsable-chart' class='row chart-item'><div class='col-md-2'><h4>Filtrar por área de gobierno</h4></div><div class='col-md-5'><select ng-show='total_obras_by_area' id='areas' class='form-control' ng-model='selected'><option value=''>TODAS</option><option ng-repeat='option in total_obras_by_area' value='{{option.slug}}'>{{option.area}}</option></select></div><div class='col-md-5'><div id='mini-chart' ng-class=\"{'all':selected==''}\"></div><p ng-show='selectedCantidad'>{{selectedCantidad}} obras <span ng-show='selectedCantidad!=total'>({{selectedCantidad*100/total | number:0}}% del total)</span> </p></div></div>",replace:!0,link:function(a,b,c){function d(){var b=_.groupBy(h.filter(function(a){return void 0!==a.area_responsable}),"area_responsable");a.total_obras_by_area=_.orderBy(_.reduce(b,function(a,b,c){return a.push({area:c,slug:b[0].area_slug,cantidad:b.length}),a},[]),"cantidad","desc"),a.total_obras_by_area_key=_.groupBy(a.total_obras_by_area,"slug");d3.select("#area-responsable-chart #areas").on("change",function(b){var c=d3.select("#area-responsable-chart #areas").property("value");a.filterFn({filter:c})});e()}function e(){i.w=d3.select("#area-responsable-chart #mini-chart").node().getBoundingClientRect().width,i.margin=i.w/100,i.barh=27,i.gap=2,i.h=i.barh+2*i.gap,i.svg||(i.svg=d3.select("#area-responsable-chart #mini-chart").append("svg"),i.mainGroup=i.svg.append("g").classed("main-group",!0)),a.total=d3.sum(a.total_obras_by_area,function(a){return a.cantidad}),a.selectedCantidad=a.total,i.scale=d3.scale.linear().domain([0,a.total]).range([0,i.w-(a.total_obras_by_area.length+2*i.gap)]),i.svg.attr("width",i.w).attr("height",i.h),i.groups=i.mainGroup.selectAll("g.area-group").data(a.total_obras_by_area),i.groups.enter().append("g").attr("id",function(a){return"area-group-"+a.slug}).classed("area-group",!0).each(function(b){var c=d3.select(this);c.append("rect").datum(b).classed("area-rect",!0).attr("x",i.gap),c.append("rect").datum(b).classed("click-rect",!0).attr("x",i.gap).on("click",function(b){a.filterFn({filter:b.slug})})}),i.groups.selectAll("rect.area-rect").attr("height",i.barh).attr("width",function(a){return i.scale(a.cantidad)}),i.groups.selectAll("rect.click-rect").attr("height",i.barh).attr("width",function(a){return i.scale(a.cantidad)});var b=0;i.groups.transition().attr("transform",function(a){var c=b;return b=b+i.scale(a.cantidad)+i.scale(i.gap),"translate("+c+",0)"})}function f(){if(i.mainGroup.selectAll(".area-rect").classed("selected",!1),a.total_obras_by_area_key[a.selectedFilter]){a.selected=a.selectedFilter;var b=i.mainGroup.select("#area-group-"+a.selectedFilter).select(".area-rect");b.empty()||b.classed("selected",!0),a.selectedCantidad=a.total_obras_by_area_key[a.selectedFilter][0].cantidad}else a.selected="",a.selectedCantidad=a.total}var g=0;$(window).load(function(){g=$(window).width()});var h,i={};a.$watch(c.obras,function(a){a&&(h=a,d())}),a.$watch(c.selectedFilter,function(a){i.groups&&f()}),a.selected="",window.$(window).resize(function(){g!=$(window).width()&&(clearTimeout(a.timeoutId),a.timeoutId=setTimeout(function(){e()},1e3))})}}}),angular.module("ngYoutubeEmbed",[]).directive("ngYoutubeEmbed",[function(){return{restrict:"E",template:'<div ng-bind-html="youtubeEmbedFrame"></div>',scope:{url:"=",playauto:"@playauto",autohide:"@autohide",ccloadpolicy:"@ccloadpolicy",color:"@color",controls:"@controls",disablekb:"@disablekb",end:"@end",fs:"@fs",hl:"@hl",ivloadpolicy:"@ivloadpolicy",playlist:"@playlist",playsinline:"@playsinline",rel:"@rel",showinfo:"@showinfo",start:"@start",theme:"@theme",width:"@width",height:"@height"},controller:["$scope","$sce",function(a,b){var c=a.url;if(void 0!==c){if(a.playlistArray=[],void 0!==a.playlist)for(var d=a.playlist.split(","),e=0;e<d.length;e++)a.playlistArray.push(fetchId(d[e]));var f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v;f="true"===a.playauto?1:0,g="true"===a.autohide?1:0,h="true"===a.ccloadpolicy?1:0,i="white"===a.color?"white":"red",j="false"===a.controls?0:1,k="false"===a.disablekb?0:1,l=a.end,m="false"===a.fs?0:1,n=a.hl,"false"===a.ivloadpolicy?0:1,o=a.playlistArray,p="true"===a.playsinline?1:0,q="false"===a.rel?0:1,r="false"===a.showinfo?0:1,s=a.start,t=a.theme,u=void 0!==a.width?a.width:"500px",v=void 0!==a.height?a.height:"350px";var w=fetchId(c),x="<iframe width="+u+" height="+v+' src="https://www.youtube.com/embed/'+w+"?autoplay="+f+"&autohide="+g+"&cc_load_policy="+h+"&color="+i+"&controls="+j+"&disablekb="+k+"&end="+l+"&fs="+m+"&hl="+n+"&playlist="+o+"&playsinline="+p+"&rel="+q+"&showinfo="+r+"&start="+s+"&theme="+t+'" frameborder="0" allowfullscreen></iframe>';a.youtubeEmbedFrame=b.trustAsHtml(x)}}]}}]),angular.module("obrasMduytApp").controller("HomeCtrl",["$scope","DataService","$filter","$http","$sce",function(a,b,c,d,e){function f(){D.w=C.select("#home-chart-container").node().getBoundingClientRect().width,D.w=!D.svg||D.w<500?D.w-15:D.w,a.isSmallDevice=D.w<700,a.isSmallDevice?(D.h=D.w,D.margin=D.w/100):(D.h=D.w,D.margin=D.w/200),D.svg||(D.svg=C.select("#home-chart-container").append("svg"),D.mainGroup=D.svg.append("g").classed("main-group",!0),D.mainGroup.append("rect").attr("fill","white"),D.svg.append("g").attr("id","comunas-group"),D.svg.append("g").attr("id","map-group"),D.svg.append("g").attr("id","etapas-group"),D.svg.append("g").attr("id","montos-group"),E.group=D.svg.append("g").attr("id","bubbles-group"),E.icons=D.svg.append("g").attr("id","bubbles-icons"),D.selection=D.svg.append("circle").attr("class","selection-cicle").attr("cx",0).attr("cy",0).attr("r",0).style("fill","none").style("stroke","black").style("stroke-width",2)),D.svg.attr("width",D.w).attr("height",D.h),D.mainGroup.select("rect").attr("width",D.w).attr("height",D.h),a.showGroup()}function g(a,b,c){var d=Math.floor(D.w/b),e=0,f=0;a.transition().duration(700).attr("transform",function(g,h){var i=e*b,j=f*c;return e<d-1?e++:a[0].length!==h+1&&(e=0,f++),"translate("+i+","+j+")"})}function h(){function b(){a.isSmallDevice&&D.svg.attr("height",D.w),D.mapGroup.selectAll("path.map-item").style("display","block").style("stroke-width",0).transition().duration(1e3).style("stroke-width",3).attr("d",D.mapPath).style("opacity",1),D.mapGroup.selectAll("text.map-text").attr("x",function(a){return D.mapPath.centroid(a)[0]}).attr("y",function(a){return D.mapPath.centroid(a)[1]}).style("opacity",1).style("display","block")}D.mapProjection=C.geo.mercator().center([-58.43992,-34.618]).translate([D.w/2,D.h/2]).scale(240*D.w),D.mapPath=C.geo.path().projection(D.mapProjection),D.mapGroup?b():(D.mapGroup=D.svg.select("#map-group"),C.json("geo/comunas.simple.geojson",function(a){D.mapCentroids={},D.mapFeatures=a.features,L.each(D.mapFeatures,function(a){D.mapCentroids["mapa-comuna-"+a.properties.comuna]=D.mapPath.centroid(a)}),D.mapGroup.selectAll("path.map-item").data(D.mapFeatures).enter().append("path").classed("child",!0).classed("map-item",!0).attr("id",function(a){return"mapa-comuna-"+a.properties.comuna}).classed("shape",!0).on("click",j),D.mapGroup.selectAll("text.map-text").data(D.mapFeatures).enter().append("text").attr("class","map-text").classed("child",!0).attr("text-anchor","middle").attr("x",function(a){return D.mapPath.centroid(a)[0]}).attr("y",function(a){return D.mapPath.centroid(a)[1]}).text(function(a){return a.properties.comuna}),b()}))}function i(){E.clusters={},E.clusterPoints={},E.nodesComuna=[],E.nodes=a.obras.filter(function(a){return a.lat&&a.lng}).map(function(a){var b="i"+a.id,c=4,d={cluster:b,radius:c,data:a};E.clusters[b]=d;var e=D.mapProjection([parseFloat(a.lng),parseFloat(a.lat)]);return E.clusterPoints[b]={x:e[0],y:e[1],radius:4},d}),E.scale=!1}function j(b){if(a.closeTooltip(),N.node()===this)return k();N.classed("active",!1),N=C.select(this).classed("active",!0);var c=D.mapPath.bounds(b),d=c[1][0]-c[0][0],e=c[1][1]-c[0][1],f=(c[0][0]+c[1][0])/2,g=(c[0][1]+c[1][1])/2,h=.9/Math.max(d/D.w,e/D.h),i=[D.w/2-h*f,D.h/2-h*g];D.mapGroup.transition().duration(750).attr("transform","translate("+i+")scale("+h+")"),D.mapGroup.selectAll("path").transition().duration(750).style("stroke-width","1px"),D.selection.transition().duration(750).attr("transform","translate("+i+")scale("+h+")"),E.group.transition().duration(750).attr("transform","translate("+i+")scale("+h+")"),E.icons.transition().duration(750).attr("transform","translate("+i+")scale("+h+")")}function k(){N.classed("active",!1),N=C.select(null),D.mapGroup.transition().duration(750).attr("transform",""),D.selection.transition().duration(750).attr("transform",""),D.mapGroup.selectAll("path").transition().duration(750).style("stroke-width","3px"),E.icons.transition().duration(750).attr("transform",""),E.group.transition().duration(750).attr("transform","")}function l(b){var c,d,e=C.range(1,16);a.isSmallDevice?(c=D.w,d=D.w,D.svg.attr("height",e.length*D.w),D.mainGroup.select("rect").attr("height",e.length*D.w)):(c=D.h/3,d=D.w/5),D.comunasGroup||(D.comunasGroup=D.svg.select("#comunas-group"),D.comunasGroup.selectAll("g.comunas-item").data(e).enter().append("g").classed("child",!0).classed("comunas-item",!0).style("opacity",0).attr("transform",function(a,b){return"translate("+(D.w/2-d/2)+","+(D.h/2-c/2)+")"}).attr("id",function(a){return"comunas-item-"+a}).each(function(){var a=C.select(this);a.append("rect").classed("comunas-item-frame",!0).on("click",n),a.append("text").classed("comunas-item-text",!0).attr("fill","#000").text(function(a){return"Comuna "+a})})),b||D.comunasGroup.selectAll("g.comunas-item").style("display","block"),D.comunasGroup.selectAll("rect.comunas-item-frame").transition().duration(700).attr("x",D.margin).attr("y",D.margin).attr("height",c-2*D.margin).attr("width",d-2*D.margin),D.comunasGroup.selectAll("text.comunas-item-text").transition().duration(700).attr("x",15).attr("y",25),g(D.comunasGroup.selectAll("g.comunas-item").transition().duration(1e3).style("opacity",1),d,c)}function m(b){E.clusters={},E.clusterPoints={};var c=!!b&&b.replace("comunas-item-",""),d=a.obras.filter(function(a){return!c||c&&parseInt(a.comuna)===parseInt(c)}),e=Math.ceil(C.max(d,function(b){return b[a.selectedRadioDimension]})),f=Math.floor(C.min(d,function(b){return b[a.selectedRadioDimension]}));E.scale=C.scale.linear().domain([parseInt(f),parseInt(e)]).range([10,c?100:50]),E.nodes=d.filter(function(a){return a.comuna&&(!c||c&&parseInt(a.comuna)===parseInt(c))}).map(function(a){var b="c"+a.comuna,d=c?10:5,e={cluster:b,radius:d||10,data:a};return(!E.clusters[b]||d>E.clusters[b].radius)&&(E.clusters[b]=e),e}),C.selectAll("g.comunas-item").each(function(a){var b=C.select(this),c=b.select("rect");E.clusterPoints["c"+a]={x:C.transform(b.attr("transform")).translate[0]+c.attr("width")/2,y:C.transform(b.attr("transform")).translate[1]+c.attr("height")/2,radius:20}})}function n(b){if(!a.isSmallDevice){if(a.closeTooltip(),O.node()===this)return o();O.classed("active",!1),O=C.select(this).classed("active",!0);var c=O.node().parentNode;C.selectAll("g.comunas-item").transition().style("opacity",function(){return this===c?1:0}).each("end",function(){this!==c&&C.select(this).style("display","none")}),O.transition().duration(750).attr("height",D.h-2*D.margin).attr("width",D.w-2*D.margin),C.select(c).transition().duration(750).attr("transform","translate(0,0)").each("end",function(){m(C.select(c).attr("id")),y()})}}function o(a){O.classed("active",!1),O=C.select(null),C.selectAll("g.comunas-item").style("display","block"),l(a),a||setTimeout(function(){m(),y()},2e3)}function p(b){var c,d,e=["monto_0_50","monto_50_100","monto_100_150","monto_mas_50"],f={monto_0_50:"Hasta 50 millones",monto_50_100:"50  a 100 millones",monto_100_150:"100 a 150 millones",monto_mas_50:"Más de 150 millones"};a.isSmallDevice?(c=D.w,d=D.w,D.svg.attr("height",e.length*D.w),D.mainGroup.select("rect").attr("height",e.length*D.w)):(c=D.h/2,d=D.w/2),D.montosGroup||(D.montosGroup=D.svg.select("#montos-group"),D.montosGroup.selectAll("g.montos-item").data(e).enter().append("g").classed("child",!0).classed("montos-item",!0).style("opacity",0).attr("transform",function(a,b){return"translate("+(D.w/2-d/2)+","+(D.h/2-c/2)+")"}).attr("id",function(a){return"montos-item-"+a}).each(function(){var a=C.select(this);a.append("rect").classed("montos-item-frame",!0).on("click",s),a.append("text").classed("montos-item-text",!0).attr("fill","#000").text(function(a){return f[a]})})),b||D.montosGroup.selectAll("g.montos-item").style("display","block"),D.montosGroup.selectAll("rect.montos-item-frame").transition().duration(700).attr("x",D.margin).attr("y",D.margin).attr("height",c-2*D.margin).attr("width",d-2*D.margin),D.montosGroup.selectAll("text.montos-item-text").transition().duration(700).attr("x",15).attr("y",25),g(D.montosGroup.selectAll("g.montos-item").transition().duration(1e3).style("opacity",1),d,c)}function q(b){E.clusters={},E.clusterPoints={};var c=!!b&&b.replace("montos-item-",""),d=a.obras.filter(function(a){return a.monto_contrato&&""!=a.monto_contrato&&(!c||c&&a.monto_slug===c)}),e=Math.ceil(C.max(d,function(b){return b[a.selectedRadioDimension]})),f=Math.floor(C.min(d,function(b){return b[a.selectedRadioDimension]}));E.scale=C.scale.linear().domain([parseInt(f),parseInt(e)]).range([10,c?100:50]),E.nodes=d.map(function(a){var b="m-"+a.monto_slug,d=c?10:5,e={cluster:b,radius:d||10,data:a};return(!E.clusters[b]||d>E.clusters[b].radius)&&(E.clusters[b]=e),e}),c?E.clusterPoints=!1:C.selectAll("g.montos-item").each(function(a){var b=C.select(this),c=b.select("rect");E.clusterPoints["m-"+a]={x:C.transform(b.attr("transform")).translate[0]+c.attr("width")/2,y:C.transform(b.attr("transform")).translate[1]+c.attr("height")/2,radius:10}})}function r(a){P.classed("active",!1),P=C.select(null),C.selectAll("g.montos-item").style("display","block"),p(a),a||setTimeout(function(){q(),y()},2e3)}function s(b){if(!a.isSmallDevice){if(a.closeTooltip(),P.node()===this)return r();P.classed("active",!1),P=C.select(this).classed("active",!0);var c=P.node().parentNode;C.selectAll("g.montos-item").transition().style("opacity",function(){return this===c?1:0}).each("end",function(){this!==c&&C.select(this).style("display","none")}),P.transition().duration(750).attr("height",D.h-2*D.margin).attr("width",D.w-2*D.margin),
C.select(c).transition().duration(750).attr("transform","translate(0,0)").each("end",function(){q(C.select(c).attr("id")),y()})}}function t(b){var c,d,e=["en-proyecto","en-licitacion","en-ejecucion","finalizada"],f={"en-proyecto":"En Proyecto","en-licitacion":"En Licitación","en-ejecucion":"En Ejecución",finalizada:"Finalizada"};a.isSmallDevice?(c=D.w,d=D.w,D.svg.attr("height",e.length*D.w),D.mainGroup.select("rect").attr("height",e.length*D.w)):(c=D.h/2,d=D.w/2),D.etapasGroup||(D.etapasGroup=D.svg.select("#etapas-group"),D.etapasGroup.selectAll("g.etapas-item").data(e).enter().append("g").classed("child",!0).classed("etapas-item",!0).style("opacity",0).attr("transform",function(a,b){return"translate("+(D.w/2-d/2)+","+(D.h/2-c/2)+")"}).attr("id",function(a){return"etapas-item-"+a}).each(function(){var a=C.select(this);a.append("rect").classed("etapas-item-frame",!0).on("click",w),a.append("text").classed("etapas-item-text",!0).attr("fill","#000").text(function(a){return f[a]})})),b||D.etapasGroup.selectAll("g.etapas-item").style("display","block"),D.etapasGroup.selectAll("rect.etapas-item-frame").transition().duration(700).attr("x",D.margin).attr("y",D.margin).attr("height",c-2*D.margin).attr("width",d-2*D.margin),D.etapasGroup.selectAll("text.etapas-item-text").transition().duration(700).attr("x",15).attr("y",25),g(D.etapasGroup.selectAll("g.etapas-item").transition().duration(1e3).style("opacity",1),d,c)}function u(b){E.clusters={},E.clusterPoints={},E.nodesEtapas=[];var c=!!b&&b.replace("etapas-item-",""),d=a.obras.filter(function(a){return a.etapa&&""!=a.etapa&&(!c||c&&a.etapa_slug===c)}),e=Math.ceil(C.max(d,function(b){return b[a.selectedRadioDimension]})),f=Math.floor(C.min(d,function(b){return b[a.selectedRadioDimension]}));E.scale=C.scale.linear().domain([parseInt(f),parseInt(e)]).range([10,c?100:50]),E.nodes=d.map(function(a){var b="e-"+a.etapa_slug,d=c?10:5,e={cluster:b,radius:d||10,data:a};return(!E.clusters[b]||d>E.clusters[b].radius)&&(E.clusters[b]=e),e}),c?E.clusterPoints=!1:C.selectAll("g.etapas-item").each(function(a){var b=C.select(this),c=b.select("rect");E.clusterPoints["e-"+a]={x:C.transform(b.attr("transform")).translate[0]+c.attr("width")/2,y:C.transform(b.attr("transform")).translate[1]+c.attr("height")/2,radius:10}})}function v(a){Q.classed("active",!1),Q=C.select(null),C.selectAll("g.etapas-item").style("display","block"),t(a),a||setTimeout(function(){u(),y()},2e3)}function w(b){if(!a.isSmallDevice){if(a.closeTooltip(),Q.node()===this)return v();Q.classed("active",!1),Q=C.select(this).classed("active",!0);var c=Q.node().parentNode;C.selectAll("g.etapas-item").transition().style("opacity",function(){return this===c?1:0}).each("end",function(){this!==c&&C.select(this).style("display","none")}),Q.transition().duration(750).attr("height",D.h-2*D.margin).attr("width",D.w-2*D.margin),C.select(c).transition().duration(750).attr("transform","translate(0,0)").each("end",function(){u(C.select(c).attr("id")),y()})}}function x(b,c,d){d.node().innerHTML="<div class='circle-bg'></div>",d.node().appendChild(c);var e=a.tipo_colors(b),f=d.select("svg").attr("width").replace("px","");f/=2;var g=d.select("svg").attr("height",50).attr("width",50);d.select(".circle-bg").style("background-color",e),g.selectAll("path,rect").attr("fill","#fff")}function y(){"mapa"!=a.selectedGroup&&E.icons.transition().duration(500).attr("opacity",0),E.force=C.layout.force().nodes(E.nodes).size([D.w,D.h]).gravity(0).charge(1).on("tick",z).start().on("end",function(){a.loadedBanderita?"mapa"==a.selectedGroup&&E.icons.attr("opacity",1):(E.circles.filter(function(a){return a.data.destacada}).each(function(a){var b=a.x-9,c=a.y-25;E.icons.append("g").attr("class",function(b){var c=a.data.red_slug?"red "+a.data.red_slug:"";return"banderita  "+(a.data.destacada?"destacada ":"")+" "+a.data.tipo_slug+" "+a.data.area_slug+" "+a.data.etapa_slug+" "+c+" "+a.data.nombre.toLowerCase()}).attr("transform","translate("+b+","+c+") scale(0.25)")}),C.selectAll("g.banderita").append(function(){return F.cloneNode(!0).documentElement}),a.loadedBanderita=!0)}),E.circles=E.group.selectAll("circle.obra").data(E.nodes),a.isSmallDevice||E.circles.enter().append("circle").attr("class",function(a){var b=a.data.red_slug?"red "+a.data.red_slug:"";return"obra  "+(a.data.destacada?"destacada ":"")+" "+a.data.tipo_slug+" "+a.data.area_slug+" "+a.data.etapa_slug+" "+b+" "+a.data.nombre.toLowerCase()}).on("mouseenter",function(b){b.color_tipo_obra=a.tipo_colors(b.data.tipo),a.selectedObra=b,a.tooltipThumb=b.data.thumb,a.$apply();var c=C.select("#tooltip-logo-container");if(!a.selectedObra.map){var f=e.getTrustedResourceUrl("https://ws.usig.buenosaires.gob.ar/geocoder/2.2/reversegeocoding?x="+b.data.lng+"&y="+b.data.lat);d.jsonp(f,{jsonpCallbackParam:"callback"}).then(function(b){a.selectedObra.map="http://servicios.usig.buenosaires.gov.ar/LocDir/mapa.phtml?x="+b.data.puerta_x+"&y="+b.data.puerta_y+"&h=100&w=300&punto=1&r=50"})}G[b.data.tipo_slug]?x(b.data.tipo,G[b.data.tipo_slug],c):C.xml("images/iconos/"+b.data.tipo_slug+".svg",function(a,d){if(a)return void console.error(a);G[b.data.tipo_slug]=d.getElementsByTagName("svg")[0],x(b.data.tipo,G[b.data.tipo_slug],c)});var g=C.select(this);D.selection.attr("cx",g.attr("cx")).attr("cy",g.attr("cy")).attr("r",0).style("stroke",b.color_tipo_obra).transition().duration(500).attr("r",13).style("opacity",1);var h=D.w/2<C.event.pageX?C.event.pageX-320:C.event.pageX,i=parseInt(a.tooltip.style("height").replace("px","")),j=document.body,k=document.documentElement,l=Math.max(j.scrollHeight,j.offsetHeight,k.clientHeight,k.scrollHeight,k.offsetHeight),m=l-600<C.event.pageY?C.event.pageY-i:C.event.pageY;a.tooltip.style("width","300px").transition().duration(200).style("top",m+"px").style("left",h+"px").style("opacity",1)}).on("mouseout",function(a){}),a.isSmallDevice&&E.circles.enter().append("circle").attr("class",function(a){var b=a.data.red_slug?"red "+a.data.red_slug:"";return"obra "+a.data.tipo_slug+" "+a.data.area_slug+" "+a.data.etapa_slug+" "+b}).on("click",function(b){if(b.color_tipo_obra=a.tipo_colors(b.data.tipo),a.selectedObra=b,a.tooltipThumb=!1,!a.selectedObra.map){var c=e.getTrustedResourceUrl("https://ws.usig.buenosaires.gob.ar/geocoder/2.2/reversegeocoding?x="+b.data.lng+"&y="+b.data.lat);d.jsonp(c,{jsonpCallbackParam:"callback"}).then(function(b){a.selectedObra.map="http://servicios.usig.buenosaires.gov.ar/LocDir/mapa.phtml?x="+b.data.puerta_x+"&y="+b.data.puerta_y+"&h=100&w=300&punto=1&r=50"})}var f=C.select("#tooltip-logo-container");G[b.data.tipo_slug]?x(b.data.tipo,G[b.data.tipo_slug],f):C.xml("images/iconos/"+b.data.tipo_slug+".svg",function(a,c){if(a)return void console.error(a);G[b.data.tipo_slug]=c.getElementsByTagName("svg")[0],x(b.data.tipo,G[b.data.tipo_slug],f)}),C.selectAll("circle.obra").style("opacity",.3),C.select(this).style("opacity",1),a.tooltip.style("width",D.w-20+"px").transition().duration(200).style("left","10px").style("top",C.event.pageY+"px").style("opacity",1),a.$apply()}),E.circles.attr("id",function(a){return"e"+a.data.id}).style("fill",function(b){return a.tipo_colors(b.data.tipo)}),E.circles.transition().style("opacity",1).attr("r",function(a){return a.radius}),E.circles.exit().remove(),a.filterBubbles(a.selectedFilter)}function z(a){E.circles.each(A(10*a.alpha*a.alpha)).each(B(.2)).attr("cx",function(a){return a.x}).attr("cy",function(a){return a.y})}function A(a){return function(b){var c=E.clusters[b.cluster],d=1;if(c){c===b&&(E.clusterPoints?(c=E.clusterPoints[b.cluster],c={x:c.x,y:c.y,radius:-c.radius},d=5*Math.sqrt(b.radius)):(c={x:D.w/2,y:D.h/2,radius:-b.radius},d=Math.sqrt(b.radius)));var e=b.x-c.x,f=b.y-c.y,g=Math.sqrt(e*e+f*f),h=b.radius+c.radius;g!==h&&(g=(g-h)/g*a*d,b.x-=e*=g,b.y-=f*=g,c.x+=e,c.y+=f)}}}function B(a){var b=C.geom.quadtree(E.nodes);return function(c){var d=c.radius+2,e=c.x-d,f=c.x+d,g=c.y-d,h=c.y+d;b.visit(function(b,d,i,j,k){if(b.point&&b.point!==c){var l=c.x-b.point.x,m=c.y-b.point.y,n=Math.sqrt(l*l+m*m),o=c.radius+b.point.radius+2;n<o&&(n=(n-o)/n*a,c.x-=l*=n,c.y-=m*=n,b.point.x+=l,b.point.y+=m)}return d>f||j<e||i>h||k<g})}}var C=window.d3;a.loading=!0,a.pymChild=new window.pym.Child({polling:1e3});var D={},E={},F="";C.xml("images/iconos/compromiso.svg",function(a,b){F=b}),a.tipo_colors=C.scale.ordinal().range(["#A7C64D","#7874B2","#F1AD3C","#38A0D7","#BD3E93","#E84D00","#22B496","#CC4916"]),a.selectedGroup=!1,a.oldGroup="mapa",a.selectedObra=!1;var G={};a.selectedFilter=!1,a.labels={},a.labels["espacio-publico"]="Obras e intervenciones en el espacio público, tales como obras en plazas y parques, en veredas o de regeneración urbana.",a.labels.escuelas="Obras de construcción, refacción o puesta en valor de establecimientos educativos.",a.labels.arquitectura="Obras civiles de reforma, puesta en valor o construcción de edificios.",a.labels.salud="Obras de construcción, remodelación y puesta en valor en hospitales y centros de salud y atención comunitaria..",a.labels.vivienda="Construcción de viviendas nuevas y obras de mejoras en viviendas existentes.",a.labels.transporte="Obras de infraestructura destinadas al transporte público y a la construcción y mantenimiento de las vías de circulación. ",a.labels["hidraulica-e-infraestructura"]="Comprende obras e intervenciones relacionadas con el tratamiento de fluidos (cursos de agua o desagües pluviales), así como obras de equipamiento, redes sanitarias, de gas o electricidad, necesarias para la vida en un entorno urbano.",a.availableGroups=[{id:"mapa",name:"Mapa"},{id:"comunas",name:"Comunas"},{id:"montos",name:"Inversión"},{id:"etapas",name:"Etapas"}],a.selectedRadioDimension="monto_contrato",a.tooltip=C.select("#tooltip-home-chart"),a.pymChild.sendHeight();var H={comunas:l,montos:p,etapas:t,mapa:h},I={comunas:m,montos:q,etapas:u,mapa:i},J={comunas:o,montos:r,etapas:v,mapa:k},K={comunas:!1,montos:!1,etapas:!1,mapa:!1},L=window._,M=0;$(window).load(function(){M=$(window).width()}),b.getAll().then(function(b){a.obras=b,a.selectedGroup="mapa",a.loading=!1,setTimeout(function(){f()},1e3),window.$(window).resize(function(){M!=$(window).width()&&(clearTimeout(a.timeoutId),a.timeoutId=setTimeout(function(){K={comunas:!1,montos:!1,etapas:!1,mapa:!1},f()},1e3))})}),a.textFilter="",a.$watch("textFilter",function(b,c){a.loading||a.filterByText()}),a.filterByText=function(){a.textFilter=$(".text-filter").val(),a.textFilter.length>3&&a.filterBubbles(a.selectedFilter,a.textFilter),0===a.textFilter.length&&a.filterBubbles(a.selectedFilter)},a.filterBubbles=function(b){if(a.selectedFilter==b&&(C.selectAll("circle.obra").style("opacity",1),C.selectAll("g.banderita").style("opacity",1),b=!1),""==b&&""==a.textFilter)C.selectAll("circle.obra").style("opacity",1),C.selectAll("g.banderita").style("opacity",1);else if(""==a.textFilter)C.selectAll("circle.obra").style("opacity",.2),C.selectAll("g.banderita").style("opacity",.2),C.selectAll("circle.obra."+b).style("opacity",1),C.selectAll("g.banderita."+b).style("opacity",1);else{C.selectAll("circle.obra").style("opacity",.2);for(var c=a.textFilter.toLowerCase().split(" "),d=0;d<c.length;d++){var e="";""!=b&&(e+="."+b),e+="."+c[d],C.selectAll("circle.obra"+e).style("opacity",1),C.selectAll("g.banderita"+e).style("opacity",1)}}a.selectedFilter=b,a.closeTooltip(),a.$$phase||a.$apply()},a.changeGroup=function(b){a.selectedGroup=b,a.showGroup()},a.showGroup=function(){a.oldGroup!==a.selectedGroup&&(a.closeTooltip(),J[a.oldGroup](!0),D.svg.selectAll(".child").style("opacity",0).style("display","none"),D.svg.selectAll("circle.obra").transition().style("opacity",.5),a.oldGroup=a.selectedGroup),H[a.selectedGroup]();var b=K[a.selectedGroup]||"mapa"===a.selectedGroup?100:2e3;K[a.selectedGroup]=!0,setTimeout(function(){I[a.selectedGroup](),y()},b)};var N=C.select(null),O=C.select(null),P=C.select(null),Q=C.select(null);a.loadedBanderita=!1,a.closeTooltip=function(){D.selection.transition().duration(200).attr("r",0).style("opacity",0),a.tooltip.transition().duration(200).style("top","-500px").style("opacity",0)}}]),angular.module("obrasMduytApp").controller("ObraCtrl",["$scope","DataService","$routeParams",function(a,b,c){a.loading=!0,a.pymChild=new window.pym.Child({polling:1e3}),a.pymChild.sendHeight(),a.obraId=c.id,a.tipo_colors=d3.scale.ordinal().range(["#A7C64D","#7874B2","#F1AD3C","#38A0D7","#BD3E93","#E84D00","#22B496","#CC4916"]);var d={url:"//tiles1.usig.buenosaires.gob.ar/mapcache/tms/1.0.0/amba_con_transporte_3857@GoogleMapsCompatible/{z}/{x}/{y}.png",format:"tms",builder:"tms",baseLayer:!0,options:{maxZoom:18,minZoom:9,attribution:'USIG (<a href="http://www.buenosaires.gob.ar" target="_blank">GCBA</a>), © <a href="http://www.openstreetmap.org/copyright/en" target="_blank">OpenStreetMap</a> (ODbL)',tms:!0}};a.titles=d,angular.extend(a,{markers:{},center:{lat:-34.604,lng:-58.382,zoom:15},tiles:d,defaults:{scrollWheelZoom:!1}}),a.mainCallback=function(b){a.drawLineOnObraLoaded=b},a.drawFirstColored=function(b){a.firstColoredLoaded=b},a.drawSecondColored=function(b){a.secondColoredLoaded=b},b.getById(c.id).then(function(b){a.obra=b,!b.hideDates&&a.drawLineOnObraLoaded&&a.drawLineOnObraLoaded(b),b.beneficiarios&&a.firstColoredLoaded&&a.firstColoredLoaded(b),b.mano_obra&&a.secondColoredLoaded&&a.secondColoredLoaded(b),a.slides=b.fotos.map(function(a){return{mode:a.includes("youtu")?"video":"photo",url:a,pic:a.includes("youtu")?getYoutubePic(a):a}}),angular.extend(a,{center:{lat:parseFloat(b.lat),lng:parseFloat(b.lng),zoom:15},markers:{m1:{lat:parseFloat(b.lat),lng:parseFloat(b.lng),focus:!0,message:b.nombre}}}),a.center.lat=parseFloat(b.lat),a.center.lng=parseFloat(b.lng);b.fecha_inicio,b.fecha_fin_inicial;a.loading=!1})}]),angular.module("obrasMduytApp").controller("EntornoCtrl",["$scope","DataService","$routeParams","leafletData","$timeout",function(a,b,c,d,e){a.loading=!0,a.pymChild=new window.pym.Child({polling:1e3}),a.pymChild.sendHeight();var f={url:"//tiles1.usig.buenosaires.gob.ar/mapcache/tms/1.0.0/amba_con_transporte_3857@GoogleMapsCompatible/{z}/{x}/{y}.png",format:"tms",builder:"tms",baseLayer:!0,options:{maxZoom:18,minZoom:9,attribution:'USIG (<a href="http://www.buenosaires.gob.ar" target="_blank">GCBA</a>), © <a href="http://www.openstreetmap.org/copyright/en" target="_blank">OpenStreetMap</a> (ODbL)',tms:!0}};a.titles=f,angular.extend(a,{markers:{},center:{lat:-34.604,lng:-58.382,zoom:15},tiles:f,defaults:{scrollWheelZoom:!1}}),b.getByEntorno(c.entorno).then(function(b){a.entorno=c.entorno,a.obras=b;for(var f={},g=[],h=0;h<b.length;h++){var i=b[h];if(i.lat&&i.lng){var j={lat:parseFloat(i.lat),lng:parseFloat(i.lng),focus:!0,message:i.nombre};f["m"+h]=j,g.push(L.marker([j.lat,j.lng]))}}var k=new L.featureGroup(g);angular.extend(a,{markers:f}),a.loading=!1,e(function(){d.getMap().then(function(a){a.fitBounds(k.getBounds(),{padding:[50,50]})})},1e3)})}]),angular.module("obrasMduytApp").controller("BuscadorCtrl",["$scope","DataService","$routeParams","NgTableParams","$filter","$sce","ngTableEventsChannel",function(a,b,c,d,e,f,g){a.loading=!0,a.pymChild=new window.pym.Child({polling:1e3}),a.pymChild.sendHeight(),a.montos_string={monto_0_50:"Hasta 50 millones",monto_50_100:"50  a 100 millones",monto_100_150:"100 a 150 millones",monto_mas_50:"Más de 150 millones"},b.getAll().then(function(b){function c(a,b){return b[this.field]}function e(a,b){var c=b[this.field],d="";return c&&""!=c&&(d="<a href='"+c+"' class='btn btn-default btn-xs btn-block' target='_blank'>Más información</a>"),f.trustAsHtml(d)}function h(b){a.results=b.data}function i(){$('[ng-table-pagination="params"]').appendTo("#footer")}var j={comunas:d3.keys(d3.nest().key(function(a){return a.comuna}).map(b.filter(function(a){return null!==a.comuna}))).map(function(a){return{id:a.trim(),title:"Comuna "+a}}),etapas:d3.keys(d3.nest().key(function(a){return a.etapa}).map(b)).map(function(a){return{id:a,title:a}}),tipos:d3.keys(d3.nest().key(function(a){return a.tipo}).map(b)).map(function(a){return{id:a,title:a}}),montos:d3.keys(d3.nest().key(function(a){return a.monto_slug}).map(b.filter(function(a){return a.monto_slug}))).map(function(b){return{id:b,title:a.montos_string[b]}}),areas:d3.keys(d3.nest().key(function(a){return a.area_responsable}).map(b.filter(function(a){return a.area_responsable}))).map(function(a){return{id:a,title:a}})};j.comunas.unshift({id:"",title:"TODAS"}),j.etapas.unshift({id:"",title:"TODAS"}),j.areas.unshift({id:"",title:"TODAS"}),j.tipos.unshift({id:"",title:"TODOS"}),j.montos.unshift({id:"",title:"TODOS"}),a.cols=[{field:"comuna",title:"Comuna",filter:{comuna:"select"},filterData:j.comunas,show:!0,getValue:c},{field:"nombre",title:"Nombre",filter:{nombre:"text"},show:!0,class:"lupita",getValue:c},{field:"area_responsable",title:"Área Responsable",filter:{area_responsable:"select"},filterData:j.areas,show:!0,getValue:c},{field:"etapa",title:"Etapa",filter:{etapa:"select"},filterData:j.etapas,show:!0,getValue:c},{field:"tipo",title:"Tipo",filter:{tipo:"select"},filterData:j.tipos,show:!0,getValue:c},{field:"monto_slug",title:"Monto Inversión",filter:{monto_slug:"select"},filterData:j.montos,show:!0,getValue:c},{field:"link_interno",title:"",filter:!1,show:!0,getValue:e},{field:"licitacion_oferta_empresa",title:"Empresa",filter:{licitacion_oferta_empresa:"text"},show:!0,class:"lupita",getValue:c}],g.onAfterCreated(i,a),g.onAfterReloadData(h,a),a.tableParams=new d({sorting:{comuna:"asc"},filter:{comuna:"",etapa:"",tipo:"",monto_slug:"",area_responsable:""},page:1,count:10},{dataset:b,counts:[10,25,50]});a.loading=!1,a.timeoutId,window.$(window).resize(function(){clearTimeout(a.timeoutId),a.timeoutId=setTimeout(function(){},1e3)})})}]),function(a,b){"object"==typeof exports&&"object"==typeof module?module.exports=b(require("angular")):"function"==typeof define&&define.amd?define(["angular"],b):"object"==typeof exports?exports["ng-table"]=b(require("angular")):a["ng-table"]=b(a.angular)}(this,function(a){return function(a){function b(d){if(c[d])return c[d].exports;var e=c[d]={i:d,l:!1,exports:{}};return a[d].call(e.exports,e,e.exports,b),e.l=!0,e.exports}var c={};return b.m=a,b.c=c,b.i=function(a){return a},b.d=function(a,b,c){Object.defineProperty(a,b,{configurable:!1,enumerable:!0,get:c})},b.n=function(a){var c=a&&a.__esModule?function(){return a.default}:function(){return a};return b.d(c,"a",c),c},b.o=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)},b.p="",b(b.s=33)}(function(a){for(var b in a)if(Object.prototype.hasOwnProperty.call(a,b))switch(typeof a[b]){case"function":break;case"object":a[b]=function(b){var c=b.slice(1),d=a[b[0]];return function(a,b,e){d.apply(this,[a,b,e].concat(c))}}(a[b]);break;default:a[b]=a[a[b]]}return a}([function(b,c){b.exports=a},function(a,b,c){function d(a){for(var c in a)b.hasOwnProperty(c)||(b[c]=a[c])}var e=c(0),f=c(4),g=c(5),h=c(6),i=c(7),j=c(8),k=c(9),l=c(10),m=c(11),n=c(12),o=c(13),p=c(14),q=c(15),r=c(16),s=c(17);c(25),c(27),c(26),c(28),c(31),c(30),Object.defineProperty(b,"__esModule",{value:!0}),b.default=e.module("ngTable-browser",[]).directive("ngTable",f.ngTable).factory("ngTableColumn",g.ngTableColumn).directive("ngTableColumnsBinding",h.ngTableColumnsBinding).controller("ngTableController",i.ngTableController).directive("ngTableDynamic",j.ngTableDynamic).provider("ngTableFilterConfig",k.ngTableFilterConfigProvider).directive("ngTableFilterRow",l.ngTableFilterRow).controller("ngTableFilterRowController",m.ngTableFilterRowController).directive("ngTableGroupRow",n.ngTableGroupRow).controller("ngTableGroupRowController",o.ngTableGroupRowController).directive("ngTablePagination",p.ngTablePagination).directive("ngTableSelectFilterDs",q.ngTableSelectFilterDs).directive("ngTableSorterRow",r.ngTableSorterRow).controller("ngTableSorterRowController",s.ngTableSorterRowController),d(c(18))},function(a,b,c){function d(a){for(var c in a)b.hasOwnProperty(c)||(b[c]=a[c])}var e=c(0),f=c(19),g=c(20),h=c(22),i=c(21);Object.defineProperty(b,"__esModule",{value:!0}),b.default=e.module("ngTable-core",[]).provider("ngTableDefaultGetData",f.ngTableDefaultGetDataProvider).value("ngTableDefaults",g.ngTableDefaults).factory("NgTableParams",h.ngTableParamsFactory).factory("ngTableEventsChannel",i.ngTableEventsChannel),d(c(23))},,function(a,b,c){function d(a,b){return{restrict:"A",priority:1001,scope:!0,controller:"ngTableController",compile:function(a){var c,d,f=[],g=0,h=[];if(e.forEach(a.find("tr"),function(a){h.push(e.element(a))}),c=h.filter(function(a){return!a.hasClass("ng-table-group")})[0],d=h.filter(function(a){return a.hasClass("ng-table-group")})[0],c)return e.forEach(c.find("td"),function(a){var c=e.element(a);if(!c.attr("ignore-cell")||"true"!==c.attr("ignore-cell")){var h=function(a){return c.attr("x-data-"+a)||c.attr("data-"+a)||c.attr(a)},i=function(a,b){c.attr("x-data-"+a)?c.attr("x-data-"+a,b):c.attr("data"+a)?c.attr("data"+a,b):c.attr(a,b)},j=function(a){var c=h(a);if(c){var d,e=function(a){return void 0!==d?d:b(c)(a)};return e.assign=function(a,e){var f=b(c);f.assign?f.assign(a.$parent,e):d=e},e}},k=h("title-alt")||h("title");k&&c.attr("data-title-text","{{"+k+"}}"),f.push({id:g++,title:j("title"),titleAlt:j("title-alt"),headerTitle:j("header-title"),sortable:j("sortable"),class:j("header-class"),filter:j("filter"),groupable:j("groupable"),headerTemplateURL:j("header"),filterData:j("filter-data"),show:c.attr("ng-if")?j("ng-if"):void 0}),(d||c.attr("ng-if"))&&i("ng-if","$columns["+(f.length-1)+"].show(this)")}}),function(a,b,c,d){a.$columns=f=d.buildColumns(f),d.setupBindingsToInternalScope(c.ngTable),d.loadFilterData(f),d.compileDirectiveTemplates()}}}}var e=c(0);d.$inject=["$q","$parse"],b.ngTable=d},function(a,b,c){function d(){function a(a,c,f){var g=Object.create(a),h=b();for(var i in h)void 0===g[i]&&(g[i]=h[i]),e.isFunction(g[i])||function(b){var c=function c(){return 1!==arguments.length||d(arguments[0])?a[b]:void c.assign(null,arguments[0])};c.assign=function(c,d){a[b]=d},g[b]=c}(i),function(b){var h=g[b];g[b]=function(){if(1!==arguments.length||d(arguments[0])){var b=arguments[0]||c,i=Object.create(b);return e.extend(i,{$column:g,$columns:f}),h.call(a,i)}h.assign(null,arguments[0])},h.assign&&(g[b].assign=h.assign)}(i);return g}function b(){return{class:c(""),filter:c(!1),groupable:c(!1),filterData:e.noop,headerTemplateURL:c(!1),headerTitle:c(""),sortable:c(!1),show:c(!0),title:c(""),titleAlt:c("")}}function c(a){var b=a,c=function a(){return 1!==arguments.length||d(arguments[0])?b:void a.assign(null,arguments[0])};return c.assign=function(a,c){b=c},c}function d(a){return null!=a&&e.isFunction(a.$new)}return{buildColumn:a}}var e=c(0);d.$inject=[],b.ngTableColumn=d},function(a,b){function c(a){function b(b,c,d){var e=a(d.ngTableColumnsBinding).assign;e&&b.$watch("$columns",function(a){var c=(a||[]).slice(0);e(b,c)})}return{restrict:"A",require:"ngTable",link:b}}c.$inject=["$parse"],b.ngTableColumnsBinding=c},function(a,b,c){function d(a,b,c,d,f,g,h,i,j,k){function l(b){if(b&&!a.params.hasErrorState()){var c=a.params,d=c.settings().filterOptions;if(c.hasFilterChanges()){var e=function(){c.page(1),c.reload()};d.filterDelay?s(e,d.filterDelay):e()}else c.reload()}}function m(){g.showFilter?a.$parent.$watch(g.showFilter,function(b){a.show_filter=b}):a.$watch(p,function(b){a.show_filter=b}),g.disableFilter&&a.$parent.$watch(g.disableFilter,function(b){a.$filterRow.disabled=b})}function n(){if(a.$groupRow={show:!1},g.showGroup){var b=d(g.showGroup);a.$parent.$watch(b,function(b){a.$groupRow.show=b}),b.assign&&a.$watch("$groupRow.show",function(c){b.assign(a.$parent,c)})}else a.$watch("params.hasGroup()",function(b){a.$groupRow.show=b})}function o(){return(a.$columns||[]).filter(function(b){return b.show(a)})}function p(){return!!a.$columns&&q(a.$columns,function(b){return b.show(a)&&!!b.filter(a)})}function q(a,b){for(var c=!1,d=0;d<a.length;d++){if(b(a[d])){c=!0;break}}return c}function r(){k.onAfterReloadData(function(b,c){var d=o();b.hasGroup()?(a.$groups=c||[],a.$groups.visibleColumnCount=d.length):(a.$data=c||[],a.$data.visibleColumnCount=d.length)},a,function(b){return a.params===b}),k.onPagesChanged(function(b,c){a.pages=c},a,function(b){return a.params===b})}a.$filterRow={disabled:!1},a.$loading=!1,a.hasOwnProperty("params")||(a.params=new b(!0));var s=function(){var a;return function(b,d){c.cancel(a),a=c(b,d)}}();a.$watch("params",function(a,b){a!==b&&a&&a.reload()},!1),a.$watch("params.isDataReloadRequired()",l),this.compileDirectiveTemplates=function(){if(!h.hasClass("ng-table")){a.templates={header:g.templateHeader?g.templateHeader:"ng-table/header.html",pagination:g.templatePagination?g.templatePagination:"ng-table/pager.html"},h.addClass("ng-table");var b=null,c=!1;e.forEach(h.children(),function(a){"THEAD"===a.tagName&&(c=!0)}),c||(b=e.element('<thead ng-include="templates.header"></thead>',i),h.prepend(b));var d=e.element('<div ng-table-pagination="params" template-url="templates.pagination"></div>',i);h.after(d),b&&f(b)(a),f(d)(a)}},this.loadFilterData=function(b){function c(a){return a&&"object"==typeof a&&"function"==typeof a.then}e.forEach(b,function(b){var d=b.filterData(a);return d?c(d)?(delete b.filterData,d.then(function(a){e.isArray(a)||e.isFunction(a)||e.isObject(a)||(a=[]),b.data=a})):b.data=d:void delete b.filterData})},this.buildColumns=function(b){var c=[];return(b||[]).forEach(function(b){c.push(j.buildColumn(b,a,c))}),c},this.parseNgTableDynamicExpr=function(a){if(!a||a.indexOf(" with ")>-1){var b=a.split(/\s+with\s+/);return{tableParams:b[0],columns:b[1]}}throw new Error("Parse error (expected example: ng-table-dynamic='tableParams with cols')")},this.setupBindingsToInternalScope=function(b){a.$watch(b,function(b){void 0!==b&&(a.params=b)},!1),m(),n()},r()}var e=c(0);d.$inject=["$scope","NgTableParams","$timeout","$parse","$compile","$attrs","$element","$document","ngTableColumn","ngTableEventsChannel"],b.ngTableController=d},function(a,b,c){function d(){return{restrict:"A",priority:1001,scope:!0,controller:"ngTableController",compile:function(a){var b;if(e.forEach(a.find("tr"),function(a){a=e.element(a),a.hasClass("ng-table-group")||b||(b=a)}),b)return e.forEach(b.find("td"),function(a){var b=e.element(a);(function(a){return b.attr("x-data-"+a)||b.attr("data-"+a)||b.attr(a)})("title")||b.attr("data-title-text","{{$columns[$index].titleAlt(this) || $columns[$index].title(this)}}"),b.attr("ng-if")||b.attr("ng-if","$columns[$index].show(this)")}),function(a,b,c,d){var e=d.parseNgTableDynamicExpr(c.ngTableDynamic);d.setupBindingsToInternalScope(e.tableParams),d.compileDirectiveTemplates(),a.$watchCollection(e.columns,function(b){a.$columns=d.buildColumns(b),d.loadFilterData(a.$columns)})}}}}var e=c(0);d.$inject=[],b.ngTableDynamic=d},function(a,b,c){function d(){function a(){b()}function b(){f=g}function c(a){var b=e.extend({},f,a);b.aliasUrls=e.extend({},f.aliasUrls,a.aliasUrls),f=b}function d(){function a(a,b){var c;return c="string"!=typeof a?a.id:a,-1!==c.indexOf("/")?c:d.getUrlForAlias(c,b)}function b(a,b){return f.aliasUrls[a]||f.defaultBaseUrl+a+f.defaultExt}var c,d={config:c,getTemplateUrl:a,getUrlForAlias:b};return Object.defineProperty(d,"config",{get:function(){return c=c||e.copy(f)},enumerable:!0}),d}var f,g={defaultBaseUrl:"ng-table/filters/",defaultExt:".html",aliasUrls:{}};this.$get=d,this.resetConfigs=b,this.setConfig=c,a(),d.$inject=[]}var e=c(0);d.$inject=[],b.ngTableFilterConfigProvider=d},function(a,b,c){function d(){return{restrict:"E",replace:!0,templateUrl:e,scope:!0,controller:"ngTableFilterRowController"}}var e=c(24);d.$inject=[],b.ngTableFilterRow=d},function(a,b){function c(a,b){a.config=b,a.getFilterCellCss=function(a,b){if("horizontal"!==b)return"s12";var c=Object.keys(a).length;return"s"+parseInt((12/c).toString(),10)},a.getFilterPlaceholderValue=function(a,b){return"string"==typeof a?"":a.placeholder}}c.$inject=["$scope","ngTableFilterConfig"],b.ngTableFilterRowController=c},function(a,b,c){function d(){return{restrict:"E",replace:!0,templateUrl:e,scope:!0,controller:"ngTableGroupRowController",controllerAs:"dctrl"}}var e=c(29);d.$inject=[],b.ngTableGroupRow=d},function(a,b){function c(a){function b(){a.getGroupables=f,a.getGroupTitle=e,a.getVisibleColumns=g,a.groupBy=h,a.isSelectedGroup=j,a.toggleDetail=l,a.$watch("params.group()",k,!0)}function c(){var b;b=a.params.hasGroup(a.$selGroup,"asc")?"desc":a.params.hasGroup(a.$selGroup,"desc")?"":"asc",a.params.group(a.$selGroup,b)}function d(b){return a.$columns.filter(function(c){return c.groupable(a)===b})[0]}function e(b){return i(b)?b.title:b.title(a)}function f(){var b=a.$columns.filter(function(b){return!!b.groupable(a)});return m.concat(b)}function g(){return a.$columns.filter(function(b){return b.show(a)})}function h(b){j(b)?c():i(b)?a.params.group(b):a.params.group(b.groupable(a))}function i(a){return"function"==typeof a}function j(b){return i(b)?b===a.$selGroup:b.groupable(a)===a.$selGroup}function k(b){var c=d(a.$selGroup);if(c&&c.show.assign&&c.show.assign(a,!0),i(b))m=[b],a.$selGroup=b,a.$selGroupTitle=b.title;else{var e=Object.keys(b||{})[0],f=d(e);f&&(a.$selGroupTitle=f.title(a),a.$selGroup=e,f.show.assign&&f.show.assign(a,!1))}}function l(){return a.params.settings().groupOptions.isExpanded=!a.params.settings().groupOptions.isExpanded,a.params.reload()}var m=[];b()}c.$inject=["$scope"],b.ngTableGroupRowController=c},function(a,b,c){function d(a,b,c){return{restrict:"A",scope:{params:"=ngTablePagination",templateUrl:"="},replace:!1,link:function(d,f){c.onAfterReloadData(function(a){d.pages=a.generatePagesArray()},d,function(a){return a===d.params}),d.$watch("templateUrl",function(c){if(void 0!==c){var g=e.element('<div ng-include="templateUrl"></div>',b);f.append(g),a(g)(d)}})}}}var e=c(0);d.$inject=["$compile","$document","ngTableEventsChannel"],b.ngTablePagination=d},function(a,b){function c(){return{restrict:"A",controller:d}}function d(a,b,c,d){function e(){i=b(c.ngTableSelectFilterDs)(a),a.$watch(function(){return i&&i.data},f)}function f(){h(i).then(function(b){b&&!g(b)&&b.unshift({id:"",title:""}),b=b||[],a.$selectData=b})}function g(a){for(var b,c=0;c<a.length;c++){var d=a[c];if(d&&""===d.id){b=!0;break}}return b}function h(a){var b=a.data;return b instanceof Array?d.when(b):d.when(b&&b())}var i;e()}c.$inject=[],b.ngTableSelectFilterDs=c,d.$inject=["$scope","$parse","$attrs","$q"]},function(a,b,c){function d(){return{restrict:"E",replace:!0,templateUrl:e,scope:!0,controller:"ngTableSorterRowController"}}var e=c(32);d.$inject=[],b.ngTableSorterRow=d},function(a,b){function c(a){function b(b,c){var d=b.sortable&&b.sortable();if(d&&"string"==typeof d){var e=a.params.settings().defaultSort,f="asc"===e?"desc":"asc",g=a.params.sorting()&&a.params.sorting()[d]&&a.params.sorting()[d]===e,h=c.ctrlKey||c.metaKey?a.params.sorting():{};h[d]=g?f:e,a.params.parameters({sorting:h})}}a.sortBy=b}c.$inject=["$scope"],b.ngTableSorterRowController=c},function(a,b){},function(a,b,c){var d=c(0),e=function(){function a(){function a(a){function c(c){var e=c.settings().filterOptions;return d.isFunction(e.filterFn)?e.filterFn:a(e.filterFilterName||b.filterFilterName)}function e(c){return a(b.sortingFilterName)}function f(a,b){if(!b.hasFilter())return a;var d=b.filter(!0),e=Object.keys(d),f=e.reduce(function(a,b){return a=j(a,d[b],b)},{});return c(b).call(b,a,f,b.settings().filterOptions.filterComparator)}function g(a,b){var c=a.slice((b.page()-1)*b.count(),b.page()*b.count());return b.total(a.length),c}function h(a,b){var c=b.orderBy(),d=e(b);return c.length?d(a,c):a}function i(a,b){if(null==a)return[];var c=d.extend({},k,b.settings().dataOptions),e=c.applyFilter?f(a,b):a,i=c.applySort?h(e,b):e;return c.applyPaging?g(i,b):i}function j(a,b,c){var d=c.split("."),e=a,f=d[d.length-1],g=e;return d.slice(0,d.length-1).forEach(function(a){g.hasOwnProperty(a)||(g[a]={}),g=g[a]}),g[f]=b,e}var k={applyFilter:!0,applySort:!0,applyPaging:!0};return i.applyPaging=g,i.getFilterFn=c,i.getOrderByFn=e,i}
this.filterFilterName="filter",this.sortingFilterName="orderBy";var b=this;this.$get=a,a.$inject=["$filter"]}return a}();b.ngTableDefaultGetDataProvider=e},function(a,b){b.ngTableDefaults={params:{},settings:{}}},function(a,b,c){function d(a){function b(a,b){var f=a.charAt(0).toUpperCase()+a.substring(1),g=(h={},h["on"+f]=c(a),h["publish"+f]=d(a),h);return e.extend(b,g);var h}function c(b){function c(a){return a?d(a)?a:function(b){return b===a}:function(a){return!0}}function d(a){return"function"==typeof a}function e(a){return a&&"function"==typeof a.$new}return function(d,f,g){var h,i=a;return e(f)?(i=f,h=c(g)):h=c(f),i.$on("ngTable:"+b,function(a,b){for(var c=[],e=2;e<arguments.length;e++)c[e-2]=arguments[e];if(!b.isNullInstance){var f=[b].concat(c);h.apply(this,f)&&d.apply(this,f)}})}}function d(b){return function(){for(var c=[],d=0;d<arguments.length;d++)c[d-0]=arguments[d];a.$broadcast.apply(a,["ngTable:"+b].concat(c))}}var f={};return f=b("afterCreated",f),f=b("afterReloadData",f),f=b("datasetChanged",f),f=b("pagesChanged",f)}var e=c(0);d.$inject=["$rootScope"],b.ngTableEventsChannel=d},function(a,b,c){function d(a,b,c,d,f,g){function h(c,h){function i(a){return!isNaN(parseFloat(a))&&isFinite(a)}function j(a){var b=B.groupOptions&&B.groupOptions.defaultSort;if(a){if(m(a))return null==a.sortDirection&&(a.sortDirection=b),a;if("object"==typeof a){for(var c in a)null==a[c]&&(a[c]=b);return a}return d={},d[a]=b,d}return a;var d}function k(a){var b=[];for(var c in a)b.push(("asc"===a[c]?"+":"-")+c);return b}function l(){var a=A.group;return{params:A,groupSortDirection:m(a)?a.sortDirection:void 0}}function m(a){return"function"==typeof a}function n(){var a=A.filter&&A.filter.$,b=r&&r.params.filter&&r.params.filter.$;return!e.equals(a,b)}function o(){B.filterOptions.filterDelay===x.filterDelay&&B.total<=B.filterOptions.filterDelayThreshold&&B.getData===z.getData&&(B.filterOptions.filterDelay=0)}function p(b){return(B.interceptors||[]).reduce(function(b,c){var d=c.response&&c.response.bind(c)||a.when,e=c.responseError&&c.responseError.bind(c)||a.reject;return b.then(function(a){return d(a,t)},function(a){return e(a,t)})},b)}function q(){function b(a){return f(a.settings().dataset,a)}function c(b){var c,g=b.group(),h=void 0;if(m(g))c=g,h=g.sortDirection;else{var i=Object.keys(g)[0];h=g[i],c=function(a){return d(a,i)}}var j=b.settings(),l=j.dataOptions;j.dataOptions={applyPaging:!1};var n=j.getData;return a.when(n(b)).then(function(a){var d={};e.forEach(a,function(a){var b=c(a);d[b]=d[b]||{data:[],$hideRows:!j.groupOptions.isExpanded,value:b},d[b].data.push(a)});var g=[];for(var i in d)g.push(d[i]);return h&&(g=f.getOrderByFn()(g,k({value:h}))),f.applyPaging(g,b)}).finally(function(){j.dataOptions=l})}function d(a,b){var c;if(c="string"==typeof b?b.split("."):b,void 0!==a){if(0===c.length)return a;if(null!==a)return d(a[c[0]],c.slice(1))}}return{getData:b,getGroups:c}}"boolean"==typeof c&&(this.isNullInstance=!0);var r,s,t=this,u=!1,v=[],w=function(){for(var a=[],c=0;c<arguments.length;c++)a[c-0]=arguments[c];B.debugMode&&b.debug&&b.debug.apply(b,a)},x={filterComparator:void 0,filterDelay:500,filterDelayThreshold:1e4,filterFilterName:void 0,filterFn:void 0,filterLayout:"stack"},y={defaultSort:"asc",isExpanded:!0},z=q();this.data=[],this.parameters=function(a,b){if(b=b||!1,void 0!==typeof a){for(var c in a){var d=a[c];if(b&&c.indexOf("[")>=0){for(var f=c.split(/\[(.*)\]/).reverse(),g="",h=0,k=f.length;h<k;h++){var l=f[h];if(""!==l){var m=d;d={},d[g=l]=i(m)?parseFloat(m):m}}"sorting"===g&&(A[g]={}),A[g]=e.extend(A[g]||{},d[g])}else A[c]="group"===c?j(a[c]):i(a[c])?parseFloat(a[c]):a[c]}return w("ngTable: set parameters",A),this}return A},this.settings=function(a){if(e.isDefined(a)){a.filterOptions&&(a.filterOptions=e.extend({},B.filterOptions,a.filterOptions)),a.groupOptions&&(a.groupOptions=e.extend({},B.groupOptions,a.groupOptions)),e.isArray(a.dataset)&&(a.total=a.dataset.length);var b=B.dataset;B=e.extend(B,a),e.isArray(a.dataset)&&o();if(a.hasOwnProperty("dataset")&&a.dataset!=b){u&&this.page(1),u=!1;var c=function(){g.publishDatasetChanged(t,a.dataset,b)};v?v.push(c):c()}return w("ngTable: set settings",B),this}return B},this.page=function(a){return void 0!==a?this.parameters({page:a}):A.page},this.total=function(a){return void 0!==a?this.settings({total:a}):B.total},this.count=function(a){return void 0!==a?this.parameters({count:a,page:1}):A.count},this.filter=function(a){if(null!=a&&"object"==typeof a)return this.parameters({filter:a,page:1});if(!0===a){for(var b=Object.keys(A.filter),c={},d=0;d<b.length;d++){var e=A.filter[b[d]];null!=e&&""!==e&&(c[b[d]]=e)}return c}return A.filter},this.group=function(a,b){if(void 0===a)return A.group;var c={page:1};return m(a)&&void 0!==b?(a.sortDirection=b,c.group=a):c.group="string"==typeof a&&void 0!==b?(d={},d[a]=b,d):a,this.parameters(c),this;var d},this.sorting=function(a,b){return"string"==typeof a&&void 0!==b?(this.parameters({sorting:(c={},c[a]=b,c)}),this):void 0!==a?this.parameters({sorting:a}):A.sorting;var c},this.isSortBy=function(a,b){return void 0!==b?void 0!==A.sorting[a]&&A.sorting[a]==b:void 0!==A.sorting[a]},this.orderBy=function(){return k(A.sorting)},this.generatePagesArray=function(a,b,c,d){arguments.length||(a=this.page(),b=this.total(),c=this.count());var e,f,g,h;d=d&&d<6?6:d;var i=[];if((h=Math.ceil(b/c))>1){i.push({type:"prev",number:Math.max(1,a-1),active:a>1}),i.push({type:"first",number:1,active:a>1,current:1===a}),f=Math.round((B.paginationMaxBlocks-B.paginationMinBlocks)/2),g=Math.max(2,a-f),e=Math.min(h-1,a+2*f-(a-g)),g=Math.max(2,g-(2*f-(e-g)));for(var j=g;j<=e;)j===g&&2!==j||j===e&&j!==h-1?i.push({type:"more",active:!1}):i.push({type:"page",number:j,active:a!==j,current:a===j}),j++;i.push({type:"last",number:h,active:a!==h,current:a===h}),i.push({type:"next",number:Math.min(h,a+1),active:a<h})}return i},this.isDataReloadRequired=function(){return!u||!e.equals(l(),r)||n()},this.hasFilter=function(){return Object.keys(this.filter(!0)).length>0},this.hasGroup=function(a,b){return null==a?m(A.group)||Object.keys(A.group).length>0:m(a)?null==b?A.group===a:A.group===a&&a.sortDirection===b:null==b?-1!==Object.keys(A.group).indexOf(a):A.group[a]===b},this.hasFilterChanges=function(){var a=r&&r.params.filter;return!e.equals(A.filter,a)||n()},this.url=function(a){function b(a,b){c(f)?f.push(b+"="+encodeURIComponent(a)):f[b]=encodeURIComponent(a)}function c(b){return a}function d(a,b){return"group"===b||void 0!==typeof a&&""!==a}a=a||!1;var f=a?[]:{};for(var g in A)if(A.hasOwnProperty(g)){var h=A[g],i=encodeURIComponent(g);if("object"==typeof h){for(var j in h)if(d(h[j],g)){var k=i+"["+encodeURIComponent(j)+"]";b(h[j],k)}}else!e.isFunction(h)&&d(h,g)&&b(h,i)}return f},this.reload=function(){var b=this,c=null;if(B.$loading=!0,r=e.copy(l()),u=!0,b.hasGroup())c=p(a.when(B.getGroups(b)));else{var d=B.getData;c=p(a.when(d(b)))}w("ngTable: reload data");var f=b.data;return c.then(function(a){return B.$loading=!1,s=null,b.data=a,g.publishAfterReloadData(b,a,f),b.reloadPages(),a}).catch(function(b){return s=r,a.reject(b)})},this.hasErrorState=function(){return!(!s||!e.equals(s,l()))},this.reloadPages=function(){var a;return function(){var b=a,c=t.generatePagesArray(t.page(),t.total(),t.count());e.equals(b,c)||(a=c,g.publishPagesChanged(this,c,b))}}();var A={page:1,count:10,filter:{},sorting:{},group:{}};e.extend(A,d.params);var B={$loading:!1,dataset:null,total:0,defaultSort:"desc",filterOptions:e.copy(x),groupOptions:e.copy(y),counts:[10,25,50,100],interceptors:[],paginationMaxBlocks:11,paginationMinBlocks:5,sortingIndicator:"span"};return this.settings(z),this.settings(d.settings),this.settings(h),this.parameters(c,!0),g.publishAfterCreated(this),e.forEach(v,function(a){a()}),v=null,this}return h}var e=c(0);d.$inject=["$q","$log","$filter","ngTableDefaults","ngTableDefaultGetData","ngTableEventsChannel"],b.ngTableParamsFactory=d},18,function(a,b,c){var d="ng-table/filterRow.html";c(0).module("ng").run(["$templateCache",function(a){a.put(d,'<tr ng-show=show_filter class=ng-table-filters> <th data-title-text="{{$column.titleAlt(this) || $column.title(this)}}" ng-repeat="$column in $columns" ng-if=$column.show(this) class="filter {{$column.class(this)}}" ng-class="params.settings().filterOptions.filterLayout === \'horizontal\' ? \'filter-horizontal\' : \'\'"> <div ng-repeat="(name, filter) in $column.filter(this)" ng-include=config.getTemplateUrl(filter) class=filter-cell ng-class="[getFilterCellCss($column.filter(this), params.settings().filterOptions.filterLayout), $last ? \'last\' : \'\']"> </div> </th> </tr> ')}]),a.exports=d},function(a,b,c){var d="ng-table/filters/number.html";c(0).module("ng").run(["$templateCache",function(a){a.put(d,'<input type=number name={{name}} ng-disabled=$filterRow.disabled ng-model=params.filter()[name] class="input-filter form-control" placeholder="{{getFilterPlaceholderValue(filter, name)}}"/> ')}]),a.exports=d},function(a,b,c){var d="ng-table/filters/select-multiple.html";c(0).module("ng").run(["$templateCache",function(a){a.put(d,'<select ng-options="data.id as data.title for data in $column.data" ng-disabled=$filterRow.disabled multiple=multiple ng-multiple=true ng-model=params.filter()[name] class="filter filter-select-multiple form-control" name={{name}}> </select> ')}]),a.exports=d},function(a,b,c){var d="ng-table/filters/select.html";c(0).module("ng").run(["$templateCache",function(a){a.put(d,'<select ng-options="data.id as data.title for data in $selectData" ng-table-select-filter-ds=$column ng-disabled=$filterRow.disabled ng-model=params.filter()[name] class="filter filter-select form-control" name={{name}}> <option style=display:none value=""></option> </select> ')}]),a.exports=d},function(a,b,c){var d="ng-table/filters/text.html";c(0).module("ng").run(["$templateCache",function(a){a.put(d,'<input type=text name={{name}} ng-disabled=$filterRow.disabled ng-model=params.filter()[name] class="input-filter form-control" placeholder="{{getFilterPlaceholderValue(filter, name)}}"/> ')}]),a.exports=d},function(a,b,c){var d="ng-table/groupRow.html";c(0).module("ng").run(["$templateCache",function(a){a.put(d,'<tr ng-if=params.hasGroup() ng-show=$groupRow.show class=ng-table-group-header> <th colspan={{getVisibleColumns().length}} class=sortable ng-class="{\n                    \'sort-asc\': params.hasGroup($selGroup, \'asc\'),\n                    \'sort-desc\':params.hasGroup($selGroup, \'desc\')\n                  }"> <a href="" ng-click="isSelectorOpen = !isSelectorOpen" class=ng-table-group-selector> <strong class=sort-indicator>{{$selGroupTitle}}</strong> <button class="btn btn-default btn-xs ng-table-group-close" ng-click="$groupRow.show = false; $event.preventDefault(); $event.stopPropagation();"> <span class="glyphicon glyphicon-remove"></span> </button> <button class="btn btn-default btn-xs ng-table-group-toggle" ng-click="toggleDetail(); $event.preventDefault(); $event.stopPropagation();"> <span class=glyphicon ng-class="{\n                    \'glyphicon-resize-small\': params.settings().groupOptions.isExpanded,\n                    \'glyphicon-resize-full\': !params.settings().groupOptions.isExpanded\n                }"></span> </button> </a> <div class=list-group ng-if=isSelectorOpen> <a href="" class=list-group-item ng-repeat="group in getGroupables()" ng-click=groupBy(group)> <strong>{{ getGroupTitle(group)}}</strong> <strong ng-class="isSelectedGroup(group) && \'sort-indicator\'"></strong> </a> </div> </th> </tr> ')}]),a.exports=d},function(a,b,c){var d="ng-table/header.html";c(0).module("ng").run(["$templateCache",function(a){a.put(d,"<ng-table-group-row></ng-table-group-row> <ng-table-sorter-row></ng-table-sorter-row> <ng-table-filter-row></ng-table-filter-row> ")}]),a.exports=d},function(a,b,c){var d="ng-table/pager.html";c(0).module("ng").run(["$templateCache",function(a){a.put(d,'<div class="ng-cloak ng-table-pager" ng-if=params.data.length> <div ng-if=params.settings().counts.length class="ng-table-counts btn-group pull-right"> <button ng-repeat="count in params.settings().counts" type=button ng-class="{\'active\':params.count() == count}" ng-click=params.count(count) class="btn btn-default"> <span ng-bind=count></span> </button> </div> <ul ng-if=pages.length class="pagination ng-table-pagination"> <li ng-class="{\'disabled\': !page.active && !page.current, \'active\': page.current}" ng-repeat="page in pages" ng-switch=page.type> <a ng-switch-when=prev ng-click=params.page(page.number) href="">&laquo;</a> <a ng-switch-when=first ng-click=params.page(page.number) href=""><span ng-bind=page.number></span></a> <a ng-switch-when=page ng-click=params.page(page.number) href=""><span ng-bind=page.number></span></a> <a ng-switch-when=more ng-click=params.page(page.number) href="">&#8230;</a> <a ng-switch-when=last ng-click=params.page(page.number) href=""><span ng-bind=page.number></span></a> <a ng-switch-when=next ng-click=params.page(page.number) href="">&raquo;</a> </li> </ul> </div> ')}]),a.exports=d},function(a,b,c){var d="ng-table/sorterRow.html";c(0).module("ng").run(["$templateCache",function(a){a.put(d,"<tr class=ng-table-sort-header> <th title={{$column.headerTitle(this)}} ng-repeat=\"$column in $columns\" ng-class=\"{\n                    'sortable': $column.sortable(this),\n                    'sort-asc': params.sorting()[$column.sortable(this)]=='asc',\n                    'sort-desc': params.sorting()[$column.sortable(this)]=='desc'\n                  }\" ng-click=\"sortBy($column, $event)\" ng-if=$column.show(this) ng-init=\"template = $column.headerTemplateURL(this)\" class=\"header {{$column.class(this)}}\"> <div ng-if=!template class=ng-table-header ng-class=\"{'sort-indicator': params.settings().sortingIndicator == 'div'}\"> <span ng-bind=$column.title(this) ng-class=\"{'sort-indicator': params.settings().sortingIndicator == 'span'}\"></span> </div> <div ng-if=template ng-include=template></div> </th> </tr> ")}]),a.exports=d},function(a,b,c){function d(a){for(var c in a)b.hasOwnProperty(c)||(b[c]=a[c])}var e=c(0),f=c(2),g=c(1),h=e.module("ngTable",[f.default.name,g.default.name]);b.ngTable=h,d(c(2)),d(c(1))}]))}),angular.module("obrasMduytApp").run(["$templateCache",function(a){a.put("views/buscador.html",'<div ng-show="loading" class="row"> <div class="col-sm-12"> <h1 id="loading" class="text-center">Cargando obras</h1> <p class="text-center"><img src="images/loader.75526f36.gif"></p> <hr> </div> </div> <div ng-if="!loading"> <div class="row"> <table id="buscador-table" ng-table-dynamic="tableParams with cols" class="table table-responsive"> <tr ng-repeat="row in $data"> </tr> </table> </div> <div class="row"> <h2 ng-show="results.length==0" class="text-center">No hay resultados para los filtros aplicados</h2> <div class="col-sm-12 well resultado-buscador" ng-repeat="o in results"> <div class="row"> <div class="col-sm-3"> <img ng-show="o.imagen_1" ng-src="{{o.imagen_1}}" class="img-responsive"> <img ng-hide="o.imagen_1" ng-src="http://placehold.it/400x300" class="img-responsive"> </div> <div class="col-sm-9"> <div class="row"> <div class="col-sm-6"> <span class="title">Obra:</span> <span class="desc">{{o.nombre}}</span> </div> <div class="col-sm-3"> <span class="title">Empresa:</span> <span class="desc">{{o.licitacion_oferta_empresa}}</span> </div> <div class="col-sm-3"> <span class="title">Monto inversión:</span> <span class="desc">{{o.monto_contrato | currency}}</span> </div> </div> <div class="row"> <div class="col-sm-12"> <span class="title">Descripción:</span> <span class="desc">{{o.descripcion}}</span> </div> </div> <div class="row"> <div class="col-sm-2"> <span class="title">Área Responsable:</span> <span class="desc">{{o.area_responsable}}</span> </div> <div class="col-sm-2"> <span class="title">Tipo:</span> <span class="desc">{{o.tipo}}</span> </div> <div class="col-sm-2"> <span class="title">Comuna:</span> <span class="desc">Comuna {{o.comuna}}</span> </div> <div class="col-sm-2"> <span class="title">Etapa:</span> <span class="desc">{{o.etapa}}</span> </div> <div class="col-sm-3 col-sm-offset-1"> <a ng-show="o.link_interno" ng-href="{{o.link_interno}}" target="_parent" class="btn btn-default btn-block">Más información</a> </div> </div> </div> </div> </div> </div> <div class="row"> <div id="footer" class="col-sm-12"> </div> </div> </div>'),a.put("views/directives/youtubePlayer.html",'<div class="detalle-frame {{class}}"> <p class="detalle-frame-title text-left" ng-if="title">{{title}} </p> <i ng-if="nota || fuente" class="detalle-frame-icon glyphicon glyphicon-info-sign" data-container="body" title="{{nota}}" data-toggle="popover" data-placement="bottom" data-content="Fuente: {{fuente}}"> </i> <span ng-show="loading">Cargando...</span> <a class="yt-switch" href="javascript:;" ng-click="ytSwitch=true;" ng-hide="ytSwitch" ng-style="{\'background-image\':\'url(\'+ytThumbnail+\')\'}"> <img class="img-responsive" src="images/play.png"> </a> <ng-youtube-embed ng-if="ytSwitch" url="url" playauto="true" color="white" disablekb="true" width="100%" height="300px" rel="false" theme="light" modestbranding="1"> </ng-youtube-embed> </div>'),a.put("views/entorno.html",'<div ng-show="loading" class="row"> <div class="col-sm-12"> <h1 id="loading" class="text-center">Cargando obras</h1> <p class="text-center"><img src="images/loader.75526f36.gif"></p> <hr> </div> </div> <div ng-if="!loading"> <div class="row"> <div class="col-md-12"> <h2>Entorno: {{obras[0].entorno}}</h2> <div ng-repeat="obra in obras"> \x3c!-- Obra: {{$index+1}} -> {{obra}} --\x3e <div ng-include="\'views/includes/obra-detail.html\'"></div> </div> </div> </div> <div class="row"> <div class="col-md-12"> <h4> Ubicación en el Mapa </h4> <leaflet center="center" tiles="tiles" markers="markers" defaults="defaults" width="100%" height="350px"></leaflet> </div> </div> </div>'),a.put("views/home.html",'<div ng-show="loading" class="row"> <div class="col-sm-12"> <h1 id="loading" class="text-center">Cargando obras</h1> <p class="text-center"><img src="images/loader.75526f36.gif"></p> <hr> </div> </div> <div ng-if="!loading"> <div class="row"> <div class="col-sm-12"> <stats-home obras="obras"></stats-home> </div> </div> <div class="hidden-xs"> <selector-home list="availableGroups" selected-group="selectedGroup" update-fn="changeGroup(group)"></selector-home> </div> <div class="row hidden-xs"> <div class="col-sm-12"> <tipo-chart labels="labels" obras="obras" selected-filter="selectedFilter" filter-fn="filterBubbles(filter)" tipo-colors="tipo_colors" finish-fn="tipoChartFinished()"></tipo-chart> </div> </div> <div class="row hidden-xs"> <div class="col-sm-12"> <area-responsable-chart obras="obras" selected-filter="selectedFilter" filter-fn="filterBubbles(filter)"></area-responsable-chart> </div> </div> <div class="row"> <div class="col-sm-12"> <h1> Conocé las obras de tu comuna </h1> </div> </div> <div class="row"> <div class="col-sm-12"> <div id="search-box" class="row chart-item"> <div class="col-md-2 hidden-xs"> <h4> Buscar por </h4> </div> <div class="col-xs-12 col-md-8 search"> <input ng-model="textFilter" ng-change="filterByText()" class="form-control text-filter" type="text" placeholder="Filtra por nombre o descripcion de obra"> </div> </div> </div> </div> <div id="main-chart-container" class="row"> <div class="col-sm-12"> <a ng-click="filterBubbles(\'destacada\')" class="btn btn btn-secondary btn-sm show-destacadas"><i class="glyphicon glyphicon-flag"></i> Ver Obras Destacadas</a> <p> </p> <p> </p> </div> </div> <div class="col-sm-12"> <div id="home-chart-container"></div> </div> </div> <div id="mobile-filler" class="row"> </div>  \x3c!-- Tooltip OBRAS --\x3e <div id="tooltip-home-chart"> <button type="button" class="close pull-right" ng-click="closeTooltip()">&times;</button> <div class="row"> <div class="col-xs-12"> <div id="tooltip-logo-container" class="pull-left"></div> <div class="tooltip-title"> <span class="type" ng-style="{color: selectedObra.color_tipo_obra}">{{selectedObra.data.tipo}}</span> <span class="title">{{selectedObra.data.nombre}}</span> </div> </div> </div> <div class="tooltip-img" ng-show="tooltipThumb"> <img class="obra-pic img-responsive" ng-src="{{tooltipThumb}}"> </div> <div class="row"> <div class="col-xs-12"> <div ng-show="selectedObra.data.porcentaje_avance" class="progress"> <span class="desc">{{selectedObra.data.etapa}}<span ng-show="selectedObra.data.porcentaje_avance">: {{selectedObra.data.porcentaje_avance}}%</span></span> <div class="progress-bar" role="progressbar" ng-style="{ \'width\': selectedObra.data.porcentaje_avance + \'%\' }"> <i ng-show="selectedObra.data.porcentaje_avance == 100" class="glyphicon glyphicon-ok"></i> </div> <div class="progress-w" ng-show="selectedObra.data.porcentaje_avance<22" ng-style="{ \'width\': (100 - selectedObra.data.porcentaje_avance) + \'%\' }"></div> </div> </div> </div> <div class="hidden-xs"> <div class="row tooltip-text" ng-show="selectedObra.data.area_responsable"> <div class="col-xs-2"> <img src="images/iconos/ministerio.svg"> </div> <div class="col-xs-10"> <p class="tooltip-text">{{selectedObra.data.area_responsable}}</p> </div> </div> <p class="tooltip-text tooltip-map"> <span class="tooltip-map-loading" ng-show="!selectedObra.map"><small>Cargando mapa</small></span> <span class="tooltip-map-placeholder"> <img class="obra-pic img-responsive" ng-show="selectedObra.map" ng-src="{{selectedObra.map}}"> </span> </p> <div class="row tooltip-text" ng-show="selectedObra.data.direccion"> <div class="col-xs-2"> <img src="images/iconos/location.svg"> </div> <div class="col-xs-10"> <p class="tooltip-text">{{selectedObra.data.direccion}}<br>Comuna {{selectedObra.data.comuna}}</p> </div> </div> </div> <p class="tooltip-text" ng-show="selectedObra.data.link_interno"><a target="_parent" ng-href="{{selectedObra.data.link_interno}}" class="btn btn-link btn-xs btn-block btn-ver-mas">VER MÁS</a></p> <div class="row compromiso-row" ng-show="selectedObra.data.compromiso"> <div class="col-xs-12"> <span class="label label-primary">Compromiso de Gobierno</span> </div> </div> </div>'),a.put("views/includes/obra-detail.html",'<div class="row obra"> <div class="col-md-12"> <h3>Obra: {{obra.nombre}}</h3> <div class="row"> <div class="col-md-8"> <ul> <flex-slider slide="s in obra.slides track by s.url" animation="slide" control-nav="thumbnails"> <li data-thumb="{{s.pic}}" ng-switch="s.mode"> <div ng-switch-when="video"> <ng-youtube-embed url="s.url" playauto="true" color="white" disablekb="true" width="100%" rel="false" theme="light" modestbranding="1"> </ng-youtube-embed> </div> <img ng-switch-default ng-src="{{s.pic}}"> </li> </flex-slider> </ul> <p> {{obra.descripcion}} </p> </div> <div class="col-md-3 ficha-tecnica"> <h4> Ficha técnica</h4> <p class="etiquetas"> <a href="http://www.buenosaires.gob.ar/compromisos" target="_blank>"><span ng-show="obra.compromiso" class="label label-primary compromiso-row compromiso"> <img src="images/iconos/compromiso.svg">Compromiso de Gobierno</span></a> <span ng-show="obra.destacada" class="label label-primary compromiso-row destacada"> <img src="images/iconos/archivo.svg">Obra Destacada</span> <a href="https://baelige.buenosaires.gob.ar/" target="_blank>"> <span ng-show="obra.ba_elige" class="label label-primary compromiso-row ba-elige"> <img src="images/iconos/archivo.svg">BA Elige</span></a> </p> <div class="etapa"> <div class="row"> <div class="col-md-2"> <img src="images/iconos/calendario.svg"> </div> <div class="col-md-10"> <p>Etapa:</p> <p><strong>{{obra.etapa}}</strong> </p> <div class="progress"> <div class="progress-bar bg-color-{{obra.slug}}" role="progressbar" ng-style="{ \'width\': obra.porcentaje_avance + \'%\' }"> <div class="progressbar-w" ng-show="!obra.porcentaje_avance"><p></p> </div> <span class="progressbar-w" ng-hide="obra.porcentaje_avance<22 || !obra.porcentaje_avance"> </span> </div> <div class="progress-w" ng-show="obra.porcentaje_avance<22" ng-style="{ \'width\': (100 - obra.porcentaje_avance) + \'%\' }"></div> </div> <div ng-if="!obra.hideDates" class="row fechas" ng-show="obra.fecha_inicio"> <div class="col-md-6" ng-show="obra.fecha_inicio"> <p> Inicio: <strong>{{obra.fecha_inicio}}</strong></p> </div> <div class="col-md-6" ng-show="obra.fecha_fin"> <p> Fin: <strong>{{obra.fecha_fin}}</strong> </p> </div> </div> </div> </div> <div class="row"> <div class="col-md-2"> <p> </p> </div> <div class="col-md-10"> <p> <small> {{obra.etapa_detalle}}</small> </p> </div> </div> </div> <div class="row"> <div class="col-md-2"> <img src="images/iconos/estilo.svg"> </div> <div class="col-md-10"> <p> Tipo de obra: </p> <strong>{{obra.tipo}}</strong> </div> </div> <div class="row"> <div class="col-md-2"> <img src="images/iconos/ministerio.svg"> </div> <div class="col-md-10"> <p> Área responsable: </p> <strong> {{obra.area_responsable}}</strong> </div> </div> <div class="row" ng-show="obra.licitacion_oferta_empresa"> <div class="col-md-2"> <img src="images/iconos/trabajador.svg"> </div> <div class="col-md-10"> <p> Empresa: </p> <strong> {{obra.licitacion_oferta_empresa}}</strong> <div ng-show="obra.cuit_contratista"> <p> CUIT Empresa: </p> <strong> {{obra.cuit_contratista}}</strong> </div> <div ng-show="obra.contratacion_tipo"> <p> Tipo de contratación: </p> <strong> {{obra.contratista_tipo}}</strong> </div> <div ng-show="obra.nro_contratacion"> <p> N° de contratación: </p> <strong> {{obra.nro_contratacion}}</strong> </div> </div> </div> <div class="row" ng-show="obra.plazo_meses"> <div class="col-md-2"> <img src="images/iconos/relojarena.svg"> </div> <div class="col-md-10"> <p> Plazo total: </p> <strong> {{obra.plazo_meses}} meses </strong> </div> </div> <div class="row" ng-show="obra.hideDates && obra.licitacion_anio"> <div class="col-md-2"> <img src="images/iconos/calendario.svg"> </div> <div class="col-md-10"> <p> Año de licitación: </p> <strong> {{obra.licitacion_anio}}</strong> </div> </div> <div class="row" ng-show="obra.beneficiarios"> <div class="col-md-2"> <img src="images/iconos/ministerio.svg"> </div> <div class="col-md-10"> <p> Cantidad de Beneficiaros:</p> <strong> {{obra.benficiarios}}<small> personas</small> </strong> </div> </div> <div class="row" ng-show="obra.beneficiarios"> <div class="col-md-2"> <img src="images/iconos/ministerio.svg"> </div> <div class="col-md-10"> <p> Mano de Obra: </p> <strong> {{obra.mano_obra}} <small>personas</small> </strong> </div> </div> <div class="row" ng-show="obra.beneficiarios"> <div class="col-md-2"> <img src="images/iconos/trabajador.svg"> </div> <div class="col-md-10"> <p> Mano de Obra: </p> <strong> {{obra.mano_obra}} <small>personas</small> </strong> </div> </div> <div class="row" ng-show="obra.monto_contrato"> <div class="col-md-2"> <img src="images/iconos/dinero.svg"> </div> <div class="col-md-10"> <p>Monto Contrato: </p> <strong> {{obra.monto_contrato | currency}} </strong> </div> </div> <div class="row" ng-show="obra.direccion"> <div class="col-md-2"> <img src="images/iconos/location.svg"> </div> <div class="col-md-10"> <p> Dirección: </p> <strong> {{obra.direccion}} </strong> </div> </div> <div class="row" ng-show="obra.licitacion_presupuesto_oficial"> <div class="col-md-2"> <img src="images/iconos/dinero.svg"> </div> <div class="col-md-10"> <p> Monto Actualizado: </p> <strong> {{obra.licitacion_presupuesto_oficial | currency}} </strong> </div> </div> <div class="row" ng-show="obra.financiamiento"> <div class="col-md-2"> <img src="images/iconos/dinero.svg"> </div> <div class="col-md-10"> <p>Financiador:</p> <strong>{{obra.financiamiento}}</strong> </div> </div> <div class="row" ng-show="obra.pliego_descarga"> <div class="col-md-2"> <img src="images/iconos/archivo.svg"> </div> <div class="col-md-10"> <p><a ng-href="{{obra.pliego_descarga}}" target="_blank">Información de la contratación</a> </p> </div> </div> <div class="row" ng-show="obra.estudio_ambiental_descarga"> <div class="col-md-2"> <img src="images/iconos/archivo.svg"> </div> <div class="col-md-10"> <p><a ng-href="{{obra.estudio_ambiental_descarga}}" target="_blank">Evaluación de impacto ambiental</a> </p> </div> </div> </div> </div> </div> </div>'),a.put("views/includes/stats-home.html",'<div id="stats-home" class="row" ng-show="obras"> <div class="col-custom-2-5 col-sm-6"> <div class="row"> <div class="col-xs-4 icon-container"> <img class="" src="images/indicadores/inversion.svg"> </div> <div class="col-xs-8 value-container"> <h5>Total de inversión:</h5> <span class="value">{{totalRender.inversion | currency:$ :0}}</span> </div> </div> </div> <div class="col-custom-1-5 col-sm-6"> <div class="row"> <div class="col-xs-4 icon-container"> <img class="" src="images/indicadores/obras.svg"> </div> <div class="col-xs-8 value-container"> <h5>Total de obras:</h5> <span class="value">{{totalRender.obras | number:0}}</span> </div> </div> </div> <div class="col-custom-1-5 col-sm-6"> <div class="row"> <div class="col-xs-4 icon-container"> <img class="" src="images/indicadores/finalizadas.svg"> </div> <div class="col-xs-8 value-container"> <h5>Finalizadas:</h5> <span class="value">{{totalRender.porcentaje_finalizadas | number:0}}%</span> </div> </div> </div> <div class="hidden-xs col-custom-1-5 col-md-6"> <div class="row"> <div class="col-xs-4 icon-container"> <img class="" src="images/indicadores/personas.svg"> </div> <div class="col-xs-8 value-container"> <h5>Empleados:</h5> <span class="value">{{totalRender.mano_obra | number:0}}</span> </div> </div> </div> </div>'),a.put("views/includes/youtubePlayer.html",'<div class="detalle-frame {{class}}"> <p class="detalle-frame-title text-left" ng-if="title">{{title}} </p> <i ng-if="nota || fuente" class="detalle-frame-icon glyphicon glyphicon-info-sign" data-container="body" title="{{nota}}" data-toggle="popover" data-placement="bottom" data-content="Fuente: {{fuente}}"> </i> <span ng-show="loading">Cargando...</span> <a class="yt-switch" href="javascript:;" ng-click="ytSwitch=true;" ng-hide="ytSwitch" ng-style="{\'background-image\':\'url(\'+ytThumbnail+\')\'}"> <img class="img-responsive" src="images/play.png"> </a> <ng-youtube-embed ng-if="ytSwitch" url="url" playauto="true" color="white" disablekb="true" width="100%" height="300px" rel="false" theme="light" modestbranding="1"> </ng-youtube-embed> </div>'),
a.put("views/obra.html",'<div ng-show="loading" class="row"> <div class="col-sm-12"> <h1 id="loading" class="text-center">Cargando obra</h1> <p class="text-center"><img src="images/loader.75526f36.gif"></p> <hr> </div> </div> <div ng-if="!loading"> <div class="row obra"> <div class="col-xs-12"> <div class="row"> <div class="col-xs-12"> <div class="tooltip-title"> <div class="row"> <div class="col-xs-1"> <div class="inner"> <div id="tooltip-logo-container" class="icon pull-left" ng-style="{\'background-color\': tipo_colors(obra.tipo)}"> <img ng-src="images/iconos/{{obra.tipo_slug}}.svg"> </div> </div> </div> <div class="col-xs-10"> <p class="type" ng-style="{color: tipo_colors(obra.tipo)}">{{obra.tipo}}</p> <h3 class="title">{{obra.nombre}}</h3> </div> </div> </div> </div> </div> <div class="row"> <div class="col-md-8"> <ul> <flex-slider slide="s in obra.slides track by s.url" animation="slide" control-nav="thumbnails"> <li data-thumb="{{s.pic}}" ng-switch="s.mode"> <div ng-switch-when="video"> <ng-youtube-embed url="s.url" playauto="true" color="white" disablekb="true" width="100%" rel="false" theme="light" modestbranding="1"> </ng-youtube-embed> </div> <img ng-switch-default ng-src="{{s.pic}}"> </li> </flex-slider> </ul> <p> {{c.descripcion}} </p> </div> <div class="col-md-3 ficha-tecnica"> <h4> Ficha técnica</h4> <p class="etiquetas"> <a href="http://www.buenosaires.gob.ar/compromisos" target="_blank>"><span ng-show="obra.compromiso" class="label label-primary compromiso-row compromiso"> <img src="images/iconos/compromiso.svg">Compromiso de Gobierno</span></a> <span ng-show="obra.destacada" class="label label-primary compromiso-row destacada"> <img src="images/iconos/archivo.svg">Obra Destacada</span> <a href="https://baelige.buenosaires.gob.ar/" target="_blank>"> <span ng-show="obra.ba_elige" class="label label-primary compromiso-row ba-elige"> <img src="images/iconos/archivo.svg">BA Elige</span></a> </p> <div class="etapa"> <div class="row"> <div class="col-md-2"> <img src="images/iconos/calendario.svg"> </div> <div class="col-md-10"> <p>Etapa:</p> <p><strong>{{obra.etapa}}</strong> </p> <div class="progress"> <div class="progress-bar bg-color-{{obra.slug}}" role="progressbar" ng-style="{ \'width\': obra.porcentaje_avance + \'%\' }"> <div class="progressbar-w" ng-show="!obra.porcentaje_avance"> <p></p> </div> <span class="progressbar-w" ng-hide="obra.porcentaje_avance<22 || !obra.porcentaje_avance"></span> </div> <div class="progress-w" ng-show="obra.porcentaje_avance<22" ng-style="{ \'width\': (100 - obra.porcentaje_avance) + \'%\' }"> </div> </div> <div ng-if="!obra.hideDates" class="row fechas" ng-show="obra.fecha_inicio"> <div class="col-md-6" ng-show="obra.fecha_inicio"> <p> Inicio: <strong>{{obra.fecha_inicio}}</strong></p> </div> <div class="col-md-6" ng-show="obra.fecha_fin"> <p> Fin: <strong>{{obra.fecha_fin}}</strong> </p> </div> </div> </div> </div> <div class="row"> <div class="col-md-2"> <p> </p> </div> <div class="col-md-10"> <p> <small> {{obra.etapa_detalle}}</small> </p> </div> </div> <div class="row"> <div class="col-md-2"> <img src="images/iconos/estilo.svg"> </div> <div class="col-md-10"> <p> Tipo de obra: </p> <strong>{{obra.tipo}}</strong> </div> </div> <div class="row"> <div class="col-md-2"> <img src="images/iconos/ministerio.svg"> </div> <div class="col-md-10"> <p> Área responsable: </p> <strong> {{obra.area_responsable}}</strong> </div> </div> <div class="row" ng-show="obra.licitacion_oferta_empresa"> <div class="col-md-2"> <img src="images/iconos/trabajador.svg"> </div> <div class="col-md-10"> <p> Empresa: </p> <strong> {{obra.licitacion_oferta_empresa}}</strong> <div ng-show="obra.cuit_contratista"> <p> CUIT Empresa: </p> <strong> {{obra.cuit_contratista}}</strong> </div> <div ng-show="obra.contratacion_tipo"> <p> Tipo de contratación: </p> <strong> {{obra.contratista_tipo}}</strong> </div> <div ng-show="obra.nro_contratacion"> <p> N° de contratación: </p> <strong> {{obra.nro_contratacion}}</strong> </div> </div> </div> <div class="row" ng-show="obra.plazo_meses"> <div class="col-md-2"> <img src="images/iconos/relojarena.svg"> </div> <div class="col-md-10"> <p> Plazo total: </p> <strong> {{obra.plazo_meses}} meses </strong> </div> </div> <div class="row" ng-show="obra.hideDates && obra.licitacion_anio"> <div class="col-md-2"> <img src="images/iconos/calendario.svg"> </div> <div class="col-md-10"> <p> Año de licitación: </p> <strong> {{obra.licitacion_anio}}</strong> </div> </div> <div class="row" ng-show="obra.beneficiarios"> <div class="col-md-2"> <img src="images/iconos/ministerio.svg"> </div> <div class="col-md-10"> <p> Cantidad de Beneficiaros:</p> <strong> {{obra.benficiarios}}<small> personas</small> </strong> </div> </div> <div class="row" ng-show="obra.beneficiarios"> <div class="col-md-2"> <img src="images/iconos/ministerio.svg"> </div> <div class="col-md-10"> <p> Mano de Obra: </p> <strong> {{obra.mano_obra}} <small>personas</small> </strong> </div> </div> <div class="row" ng-show="obra.beneficiarios"> <div class="col-md-2"> <img src="images/iconos/trabajador.svg"> </div> <div class="col-md-10"> <p> Mano de Obra: </p> <strong> {{obra.mano_obra}} <small>personas</small> </strong> <colored-icons scale="\'manoDeObra\'" callback="drawSecondColored"></colored-icons> </div> </div> <div class="row" ng-show="obra.monto_contrato"> <div class="col-md-2"> <img src="images/iconos/dinero.svg"> </div> <div class="col-md-10"> <p> Monto Contrato: </p> <strong> {{obra.monto_contrato | currency}} </strong> </div> </div> <div class="row" ng-show="obra.direccion"> <div class="col-md-2"> <img src="images/iconos/location.svg"> </div> <div class="col-md-10"> <p> Dirección: </p> <strong> {{obra.direccion}} </strong> </div> </div> <div class="row" ng-show="obra.licitacion_presupuesto_oficial"> <div class="col-md-2"> <img src="images/iconos/dinero.svg"> </div> <div class="col-md-10"> <p> Monto Actualizado: </p> <strong> {{obra.licitacion_presupuesto_oficial | currency}} </strong> </div> </div> <div class="row" ng-show="obra.financiamiento"> <div class="col-md-2"> <img src="images/iconos/dinero.svg"> </div> <div class="col-md-10"> <p>Financiador:</p> <strong>{{obra.financiamiento}}</strong> </div> </div> <div class="row" ng-show="obra.pliego_descarga"> <div class="col-md-2"> <img src="images/iconos/archivo.svg"> </div> <div class="col-md-10"> <p><a ng-href="{{obra.pliego_descarga}}" target="_blank">Información de la contratación</a> </p> </div> </div> <div class="row" ng-show="obra.estudio_ambiental_descarga"> <div class="col-md-2"> <img src="images/iconos/archivo.svg"> </div> <div class="col-md-10"> <p><a ng-href="{{obra.estudio_ambiental_descarga}}" target="_blank">Evaluación de impacto ambiental</a> </p> </div> </div> </div> \x3c!-- etapa --\x3e </div> \x3c!-- ficha técnica --\x3e </div> \x3c!-- row --\x3e <div class="row"> <div class="col-md-12"> <h4> Ubicación de obra </h4> <leaflet center="center" tiles="tiles" markers="markers" defaults="defaults" width="100%" height="350px"></leaflet> </div> </div> </div>\x3c!-- col md 12 --\x3e </div>\x3c!-- row obra --\x3e </div>\x3c!-- if loading --\x3e')}]);