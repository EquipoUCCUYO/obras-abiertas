function loadData(a,b,c,d){if(!window.MDUYT_CONFIG)throw"Archivo de configuraciÃ³n inexistente";var e;"GET_REQUEST"===window.MDUYT_CONFIG.LOAD_USING?e=window.MDUYT_CONFIG.DATA_CSV:"JSONP_PROXY"===window.MDUYT_CONFIG.LOAD_USING&&(e=window.MDUYT_CONFIG.JSONP_PROXY+"?source_format=csv&source="+window.MDUYT_CONFIG.DATA_CSV);var f,g=a.trustAsResourceUrl(e),h=b.defer(),i=function(a){f="GET_REQUEST"===window.MDUYT_CONFIG.LOAD_USING?Papa.parse(a.data,{header:!0}).data:a.data,f=f.map(function(a,b){return cleanData(a,b,d)}),h.resolve(f)},j=function(a){f=a,h.reject(a)};return"GET_REQUEST"===window.MDUYT_CONFIG.LOAD_USING?c.get(g).then(i,j):"JSONP_PROXY"===window.MDUYT_CONFIG.LOAD_USING&&c.jsonp(g).then(i,j),h.promise}function loadMapsData(){}d3.sankey=function(){function a(){n.forEach(function(a){a.sourceLinks=[],a.targetLinks=[]}),o.forEach(function(a){var b=a.source,c=a.target;"number"==typeof b&&(b=a.source=n[a.source]),"number"==typeof c&&(c=a.target=n[a.target]),b.sourceLinks.push(a),c.targetLinks.push(a)})}function b(){n.forEach(function(a){a.value=Math.max(d3.sum(a.sourceLinks,i),d3.sum(a.targetLinks,i))})}function c(){for(var a,b=n,c=0;b.length;)a=[],b.forEach(function(b){b.x=c,b.dx=k,b.sourceLinks.forEach(function(b){a.push(b.target)})}),b=a,++c;d(c),e((m[0]-k)/(c-1))}function d(a){n.forEach(function(b){b.sourceLinks.length||(b.x=a-1)})}function e(a){n.forEach(function(b){b.x*=a})}function f(a){function b(){var a=d3.min(g,function(a){return(m[1]-(a.length-1)*l)/d3.sum(a,i)});g.forEach(function(b){b.forEach(function(b,c){b.y=c,b.dy=b.value*a})}),o.forEach(function(b){b.dy=b.value*a})}function c(a){function b(a){return h(a.source)*a.value}g.forEach(function(c,d){c.forEach(function(c){if(c.targetLinks.length){var d=d3.sum(c.targetLinks,b)/d3.sum(c.targetLinks,i);c.y+=(d-h(c))*a}})})}function d(a){function b(a){return h(a.target)*a.value}g.slice().reverse().forEach(function(c){c.forEach(function(c){if(c.sourceLinks.length){var d=d3.sum(c.sourceLinks,b)/d3.sum(c.sourceLinks,i);c.y+=(d-h(c))*a}})})}function e(){g.forEach(function(a){var b,c,d,e=0,g=a.length;for(a.sort(f),d=0;g>d;++d)b=a[d],c=e-b.y,c>0&&(b.y+=c),e=b.y+b.dy+l;if(c=e-l-m[1],c>0)for(e=b.y-=c,d=g-2;d>=0;--d)b=a[d],c=b.y+b.dy+l-e,c>0&&(b.y-=c),e=b.y})}function f(a,b){return a.y-b.y}var g=d3.nest().key(function(a){return a.x}).sortKeys(d3.ascending).entries(n).map(function(a){return a.values});b(),e();for(var j=1;a>0;--a)d(j*=.99),e(),c(j),e()}function g(){function a(a,b){return a.source.y-b.source.y}function b(a,b){return a.target.y-b.target.y}n.forEach(function(c){c.sourceLinks.sort(b),c.targetLinks.sort(a)}),n.forEach(function(a){var b=0,c=0;a.sourceLinks.forEach(function(a){a.sy=b,b+=a.dy}),a.targetLinks.forEach(function(a){a.ty=c,c+=a.dy})})}function h(a){return a.y+a.dy/2}function i(a){return a.value}var j={},k=24,l=8,m=[1,1],n=[],o=[];return j.nodeWidth=function(a){return arguments.length?(k=+a,j):k},j.nodePadding=function(a){return arguments.length?(l=+a,j):l},j.nodes=function(a){return arguments.length?(n=a,j):n},j.links=function(a){return arguments.length?(o=a,j):o},j.size=function(a){return arguments.length?(m=a,j):m},j.layout=function(d){return a(),b(),c(),f(d),g(),j},j.relayout=function(){return g(),j},j.link=function(){function a(a){var c=a.source.x+a.source.dx,d=a.target.x,e=d3.interpolateNumber(c,d),f=e(b),g=e(1-b),h=a.source.y+a.sy+a.dy/2,i=a.target.y+a.ty+a.dy/2;return"M"+c+","+h+"C"+f+","+h+" "+g+","+i+" "+d+","+i}var b=.5;return a.curvature=function(c){return arguments.length?(b=+c,a):b},a},j},Array.isArray||(Array.isArray=function(a){return"[object Array]"===Object.prototype.toString.call(a)}),function(a,b){"function"==typeof define&&define.amd?define([],b):"object"==typeof module&&"undefined"!=typeof exports?module.exports=b():a.Papa=b()}(this,function(){"use strict";function a(a){this._handle=null,this._finished=!1,this._completed=!1,this._input=null,this._baseIndex=0,this._partialLine="",this._rowCount=0,this._start=0,this._nextChunk=null,this.isFirstChunk=!0,this._completeResults={data:[],errors:[],meta:{}},function(a){var b=m(a);b.chunkSize=parseInt(b.chunkSize),a.step||a.chunk||(b.chunkSize=null),this._handle=new g(b),(this._handle.streamer=this)._config=b}.call(this,a),this.parseChunk=function(a,b){if(this.isFirstChunk&&o(this._config.beforeFirstChunk)){var c=this._config.beforeFirstChunk(a);void 0!==c&&(a=c)}this.isFirstChunk=!1;var d=this._partialLine+a;this._partialLine="";var e=this._handle.parse(d,this._baseIndex,!this._finished);if(!this._handle.paused()&&!this._handle.aborted()){var f=e.meta.cursor;this._finished||(this._partialLine=d.substring(f-this._baseIndex),this._baseIndex=f),e&&e.data&&(this._rowCount+=e.data.length);var g=this._finished||this._config.preview&&this._rowCount>=this._config.preview;if(t)r.postMessage({results:e,workerId:x.WORKER_ID,finished:g});else if(o(this._config.chunk)&&!b){if(this._config.chunk(e,this._handle),this._handle.paused()||this._handle.aborted())return;e=void 0,this._completeResults=void 0}return this._config.step||this._config.chunk||(this._completeResults.data=this._completeResults.data.concat(e.data),this._completeResults.errors=this._completeResults.errors.concat(e.errors),this._completeResults.meta=e.meta),this._completed||!g||!o(this._config.complete)||e&&e.meta.aborted||(this._config.complete(this._completeResults,this._input),this._completed=!0),g||e&&e.meta.paused||this._nextChunk(),e}},this._sendError=function(a){o(this._config.error)?this._config.error(a):t&&this._config.error&&r.postMessage({workerId:x.WORKER_ID,error:a,finished:!1})}}function b(b){var c;(b=b||{}).chunkSize||(b.chunkSize=x.RemoteChunkSize),a.call(this,b),this._nextChunk=s?function(){this._readChunk(),this._chunkLoaded()}:function(){this._readChunk()},this.stream=function(a){this._input=a,this._nextChunk()},this._readChunk=function(){if(this._finished)this._chunkLoaded();else{if(c=new XMLHttpRequest,this._config.withCredentials&&(c.withCredentials=this._config.withCredentials),s||(c.onload=n(this._chunkLoaded,this),c.onerror=n(this._chunkError,this)),c.open("GET",this._input,!s),this._config.downloadRequestHeaders){var a=this._config.downloadRequestHeaders;for(var b in a)c.setRequestHeader(b,a[b])}if(this._config.chunkSize){var d=this._start+this._config.chunkSize-1;c.setRequestHeader("Range","bytes="+this._start+"-"+d),c.setRequestHeader("If-None-Match","webkit-no-cache")}try{c.send()}catch(a){this._chunkError(a.message)}s&&0===c.status?this._chunkError():this._start+=this._config.chunkSize}},this._chunkLoaded=function(){4===c.readyState&&(c.status<200||400<=c.status?this._chunkError():(this._finished=!this._config.chunkSize||this._start>function(a){var b=a.getResponseHeader("Content-Range");return null===b?-1:parseInt(b.substr(b.lastIndexOf("/")+1))}(c),this.parseChunk(c.responseText)))},this._chunkError=function(a){var b=c.statusText||a;this._sendError(new Error(b))}}function c(b){var c,d;(b=b||{}).chunkSize||(b.chunkSize=x.LocalChunkSize),a.call(this,b);var e="undefined"!=typeof FileReader;this.stream=function(a){this._input=a,d=a.slice||a.webkitSlice||a.mozSlice,e?((c=new FileReader).onload=n(this._chunkLoaded,this),c.onerror=n(this._chunkError,this)):c=new FileReaderSync,this._nextChunk()},this._nextChunk=function(){this._finished||this._config.preview&&!(this._rowCount<this._config.preview)||this._readChunk()},this._readChunk=function(){var a=this._input;if(this._config.chunkSize){var b=Math.min(this._start+this._config.chunkSize,this._input.size);a=d.call(a,this._start,b)}var f=c.readAsText(a,this._config.encoding);e||this._chunkLoaded({target:{result:f}})},this._chunkLoaded=function(a){this._start+=this._config.chunkSize,this._finished=!this._config.chunkSize||this._start>=this._input.size,this.parseChunk(a.target.result)},this._chunkError=function(){this._sendError(c.error)}}function d(b){var c;a.call(this,b=b||{}),this.stream=function(a){return c=a,this._nextChunk()},this._nextChunk=function(){if(!this._finished){var a=this._config.chunkSize,b=a?c.substr(0,a):c;return c=a?c.substr(a):"",this._finished=!c,this.parseChunk(b)}}}function e(b){a.call(this,b=b||{});var c=[],d=!0,e=!1;this.pause=function(){a.prototype.pause.apply(this,arguments),this._input.pause()},this.resume=function(){a.prototype.resume.apply(this,arguments),this._input.resume()},this.stream=function(a){this._input=a,this._input.on("data",this._streamData),this._input.on("end",this._streamEnd),this._input.on("error",this._streamError)},this._checkIsFinished=function(){e&&1===c.length&&(this._finished=!0)},this._nextChunk=function(){this._checkIsFinished(),c.length?this.parseChunk(c.shift()):d=!0},this._streamData=n(function(a){try{c.push("string"==typeof a?a:a.toString(this._config.encoding)),d&&(d=!1,this._checkIsFinished(),this.parseChunk(c.shift()))}catch(a){this._streamError(a)}},this),this._streamError=n(function(a){this._streamCleanUp(),this._sendError(a)},this),this._streamEnd=n(function(){this._streamCleanUp(),e=!0,this._streamData("")},this),this._streamCleanUp=n(function(){this._input.removeListener("data",this._streamData),this._input.removeListener("end",this._streamEnd),this._input.removeListener("error",this._streamError)},this)}function f(b){var c=require("stream").Duplex,d=m(b),e=!0,f=!1,g=[],h=null;this._onCsvData=function(a){for(var b=a.data,c=0;c<b.length;c++)h.push(b[c])||this._handle.paused()||this._handle.pause()},this._onCsvComplete=function(){h.push(null)},d.step=n(this._onCsvData,this),d.complete=n(this._onCsvComplete,this),a.call(this,d),this._nextChunk=function(){f&&1===g.length&&(this._finished=!0),g.length?g.shift()():e=!0},this._addToParseQueue=function(a,b){g.push(n(function(){return this.parseChunk("string"==typeof a?a:a.toString(d.encoding)),o(b)?b():void 0},this)),e&&(e=!1,this._nextChunk())},this._onRead=function(){this._handle.paused()&&this._handle.resume()},this._onWrite=function(a,b,c){this._addToParseQueue(a,c)},this._onWriteComplete=function(){f=!0,this._addToParseQueue("")},this.getStream=function(){return h},(h=new c({readableObjectMode:!0,decodeStrings:!1,read:n(this._onRead,this),write:n(this._onWrite,this)})).once("finish",n(this._onWriteComplete,this))}function g(a){function b(b){return"greedy"===a.skipEmptyLines?""===b.join("").trim():1===b.length&&0===b[0].length}function c(){if(v&&k&&(f("Delimiter","UndetectableDelimiter","Unable to auto-detect delimiting character; defaulted to '"+x.DefaultDelimiter+"'"),k=!1),a.skipEmptyLines)for(var c=0;c<v.data.length;c++)b(v.data[c])&&v.data.splice(c--,1);return d()&&function(){if(v){for(var b=0;d()&&b<v.data.length;b++)for(var c=0;c<v.data[b].length;c++){var e=v.data[b][c];a.trimHeaders&&(e=e.trim()),u.push(e)}v.data.splice(0,1)}}(),function(){if(!v||!a.header&&!a.dynamicTyping&&!a.transform)return v;for(var b=0;b<v.data.length;b++){var c,d=a.header?{}:[];for(c=0;c<v.data[b].length;c++){var g=c,h=v.data[b][c];a.header&&(g=c>=u.length?"__parsed_extra":u[c]),a.transform&&(h=a.transform(h,g)),h=e(g,h),"__parsed_extra"===g?(d[g]=d[g]||[],d[g].push(h)):d[g]=h}v.data[b]=d,a.header&&(c>u.length?f("FieldMismatch","TooManyFields","Too many fields: expected "+u.length+" fields but parsed "+c,r+b):c<u.length&&f("FieldMismatch","TooFewFields","Too few fields: expected "+u.length+" fields but parsed "+c,r+b))}return a.header&&v.meta&&(v.meta.fields=u),r+=v.data.length,v}()}function d(){return a.header&&0===u.length}function e(b,c){return d=b,a.dynamicTypingFunction&&void 0===a.dynamicTyping[d]&&(a.dynamicTyping[d]=a.dynamicTypingFunction(d)),!0===(a.dynamicTyping[d]||a.dynamicTyping)?"true"===c||"TRUE"===c||"false"!==c&&"FALSE"!==c&&(l.test(c)?parseFloat(c):n.test(c)?new Date(c):""===c?null:c):c;var d}function f(a,b,c,d){v.errors.push({type:a,code:b,message:c,row:d})}var g,j,k,l=/^\s*-?(\d*\.?\d+|\d+\.?\d*)(e[-+]?\d+)?\s*$/i,n=/(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))/,p=this,q=0,r=0,s=!1,t=!1,u=[],v={data:[],errors:[],meta:{}};if(o(a.step)){var w=a.step;a.step=function(b){if(v=b,d())c();else{if(c(),0===v.data.length)return;q+=b.data.length,a.preview&&q>a.preview?j.abort():w(v,p)}}}this.parse=function(d,e,f){var l=a.quoteChar||'"';if(a.newline||(a.newline=function(a,b){a=a.substr(0,1048576);var c=new RegExp(h(b)+"([^]*?)"+h(b),"gm"),d=(a=a.replace(c,"")).split("\r"),e=a.split("\n"),f=1<e.length&&e[0].length<d[0].length;if(1===d.length||f)return"\n";for(var g=0,i=0;i<d.length;i++)"\n"===d[i][0]&&g++;return g>=d.length/2?"\r\n":"\r"}(d,l)),k=!1,a.delimiter)o(a.delimiter)&&(a.delimiter=a.delimiter(d),v.meta.delimiter=a.delimiter);else{var n=function(c,d,e,f){for(var g,h,j,k=[",","	","|",";",x.RECORD_SEP,x.UNIT_SEP],l=0;l<k.length;l++){var m=k[l],n=0,o=0,p=0;j=void 0;for(var q=new i({comments:f,delimiter:m,newline:d,preview:10}).parse(c),r=0;r<q.data.length;r++)if(e&&b(q.data[r]))p++;else{var s=q.data[r].length;o+=s,void 0!==j?s>1&&(n+=Math.abs(s-j),j=s):j=s}0<q.data.length&&(o/=q.data.length-p),(void 0===h||h>n)&&o>1.99&&(h=n,g=m)}return{successful:!!(a.delimiter=g),bestDelimiter:g}}(d,a.newline,a.skipEmptyLines,a.comments);n.successful?a.delimiter=n.bestDelimiter:(k=!0,a.delimiter=x.DefaultDelimiter),v.meta.delimiter=a.delimiter}var p=m(a);return a.preview&&a.header&&p.preview++,g=d,j=new i(p),v=j.parse(g,e,f),c(),s?{meta:{paused:!0}}:v||{meta:{paused:!1}}},this.paused=function(){return s},this.pause=function(){s=!0,j.abort(),g=g.substr(j.getCharIndex())},this.resume=function(){s=!1,p.streamer.parseChunk(g,!0)},this.aborted=function(){return t},this.abort=function(){t=!0,j.abort(),v.meta.aborted=!0,o(a.complete)&&a.complete(v),g=""}}function h(a){return a.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function i(a){var b,c=(a=a||{}).delimiter,d=a.newline,e=a.comments,f=a.step,g=a.preview,h=a.fastMode,i=b=void 0===a.quoteChar?'"':a.quoteChar;if(void 0!==a.escapeChar&&(i=a.escapeChar),("string"!=typeof c||-1<x.BAD_DELIMITERS.indexOf(c))&&(c=","),e===c)throw"Comment character same as delimiter";!0===e?e="#":("string"!=typeof e||-1<x.BAD_DELIMITERS.indexOf(e))&&(e=!1),"\n"!==d&&"\r"!==d&&"\r\n"!==d&&(d="\n");var j=0,k=!1;this.parse=function(a,l,m){function n(a){z.push(a),C=j}function p(b){var c=0;if(-1!==b){var d=a.substring(F+1,b);d&&""===d.trim()&&(c=d.length)}return c}function q(b){return m||(void 0===b&&(b=a.substr(j)),B.push(b),j=u,n(B),y&&t()),s()}function r(b){j=b,n(B),B=[],H=a.indexOf(d,j)}function s(a){return{data:z,errors:A,meta:{delimiter:c,linebreak:d,aborted:k,truncated:!!a,cursor:C+(l||0)}}}function t(){f(s()),z=[],A=[]}if("string"!=typeof a)throw"Input must be a string";var u=a.length,v=c.length,w=d.length,x=e.length,y=o(f),z=[],A=[],B=[],C=j=0;if(!a)return s();if(h||!1!==h&&-1===a.indexOf(b)){for(var D=a.split(d),E=0;E<D.length;E++){if(B=D[E],j+=B.length,E!==D.length-1)j+=d.length;else if(m)return s();if(!e||B.substr(0,x)!==e){if(y){if(z=[],n(B.split(c)),t(),k)return s()}else n(B.split(c));if(g&&E>=g)return z=z.slice(0,g),s(!0)}}return s()}for(var F,G=a.indexOf(c,j),H=a.indexOf(d,j),I=new RegExp(i.replace(/[-[\]\/{}()*+?.\\^$|]/g,"\\$&")+b,"g");;)if(a[j]!==b)if(e&&0===B.length&&a.substr(j,x)===e){if(-1===H)return s();j=H+w,H=a.indexOf(d,j),G=a.indexOf(c,j)}else if(-1!==G&&(H>G||-1===H))B.push(a.substring(j,G)),j=G+v,G=a.indexOf(c,j);else{if(-1===H)break;if(B.push(a.substring(j,H)),r(H+w),y&&(t(),k))return s();if(g&&z.length>=g)return s(!0)}else for(F=j,j++;;){if(-1===(F=a.indexOf(b,F+1)))return m||A.push({type:"Quotes",code:"MissingQuotes",message:"Quoted field unterminated",row:z.length,index:j}),q();if(F===u-1)return q(a.substring(j,F).replace(I,b));if(b!==i||a[F+1]!==i){if(b===i||0===F||a[F-1]!==i){var J=p(-1===H?G:Math.min(G,H));if(a[F+1+J]===c){B.push(a.substring(j,F).replace(I,b)),j=F+1+J+v,G=a.indexOf(c,j),H=a.indexOf(d,j);break}var K=p(H);if(a.substr(F+1+K,w)===d){if(B.push(a.substring(j,F).replace(I,b)),r(F+1+K+w),G=a.indexOf(c,j),y&&(t(),k))return s();if(g&&z.length>=g)return s(!0);break}A.push({type:"Quotes",code:"InvalidQuotes",message:"Trailing quote on quoted field is malformed",row:z.length,index:j}),F++}}else F++}return q()},this.abort=function(){k=!0},this.getCharIndex=function(){return j}}function j(a){var b=a.data,c=v[b.workerId],d=!1;if(b.error)c.userError(b.error,b.file);else if(b.results&&b.results.data){var e={abort:function(){d=!0,k(b.workerId,{data:[],errors:[],meta:{aborted:!0}})},pause:l,resume:l};if(o(c.userStep)){for(var f=0;f<b.results.data.length&&(c.userStep({data:[b.results.data[f]],errors:b.results.errors,meta:b.results.meta},e),!d);f++);delete b.results}else o(c.userChunk)&&(c.userChunk(b.results,e,b.file),delete b.results)}b.finished&&!d&&k(b.workerId,b.results)}function k(a,b){var c=v[a];o(c.userComplete)&&c.userComplete(b),c.terminate(),delete v[a]}function l(){throw"Not implemented."}function m(a){if("object"!=typeof a||null===a)return a;var b=Array.isArray(a)?[]:{};for(var c in a)b[c]=m(a[c]);return b}function n(a,b){return function(){a.apply(b,arguments)}}function o(a){return"function"==typeof a}var p,q,r="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==r?r:{},s=!r.document&&!!r.postMessage,t=s&&/(\?|&)papaworker(=|&|$)/.test(r.location.search),u=!1,v={},w=0,x={parse:function(a,g){var h=(g=g||{}).dynamicTyping||!1;if(o(h)&&(g.dynamicTypingFunction=h,h={}),g.dynamicTyping=h,g.transform=!!o(g.transform)&&g.transform,g.worker&&x.WORKERS_SUPPORTED){var i=function(){if(!x.WORKERS_SUPPORTED)return!1;if(!u&&null===x.SCRIPT_PATH)throw new Error("Script path cannot be determined automatically when Papa Parse is loaded asynchronously. You need to set Papa.SCRIPT_PATH manually.");var a=x.SCRIPT_PATH||p;a+=(-1!==a.indexOf("?")?"&":"?")+"papaworker";var b=new r.Worker(a);return b.onmessage=j,b.id=w++,v[b.id]=b}();return i.userStep=g.step,i.userChunk=g.chunk,i.userComplete=g.complete,i.userError=g.error,g.step=o(g.step),g.chunk=o(g.chunk),g.complete=o(g.complete),g.error=o(g.error),delete g.worker,void i.postMessage({input:a,config:g,workerId:i.id})}var k=null;return a===x.NODE_STREAM_INPUT?(k=new f(g)).getStream():("string"==typeof a?k=g.download?new b(g):new d(g):!0===a.readable&&o(a.read)&&o(a.on)?k=new e(g):(r.File&&a instanceof File||a instanceof Object)&&(k=new c(g)),k.stream(a))},unparse:function(a,b){function c(a){if("object"!=typeof a)return[];var b=[];for(var c in a)b.push(c);return b}function d(a,b,c){var d="";"string"==typeof a&&(a=JSON.parse(a)),"string"==typeof b&&(b=JSON.parse(b));var f=Array.isArray(a)&&0<a.length,j=!Array.isArray(b[0]);if(f&&g){for(var k=0;k<a.length;k++)k>0&&(d+=h),d+=e(a[k],k);0<b.length&&(d+=i)}for(var l=0;l<b.length;l++){var m=f?a.length:b[l].length,n=f?a:b[l];if("greedy"!==c||""!==n.join("").trim()){for(var o=0;m>o;o++){o>0&&(d+=h);var p=f&&j?a[o]:o;d+=e(b[l][p],o)}l<b.length-1&&(!c||m>0)&&(d+=i)}}return d}function e(a,b){if(null==a)return"";if(a.constructor===Date)return JSON.stringify(a).slice(1,25);a=a.toString().replace(l,j+j);var c="boolean"==typeof f&&f||Array.isArray(f)&&f[b]||function(a,b){for(var c=0;c<b.length;c++)if(-1<a.indexOf(b[c]))return!0;return!1}(a,x.BAD_DELIMITERS)||-1<a.indexOf(h)||" "===a.charAt(0)||" "===a.charAt(a.length-1);return c?j+a+j:a}var f=!1,g=!0,h=",",i="\r\n",j='"',k=!1;!function(){"object"==typeof b&&("string"!=typeof b.delimiter||x.BAD_DELIMITERS.filter(function(a){return-1!==b.delimiter.indexOf(a)}).length||(h=b.delimiter),("boolean"==typeof b.quotes||Array.isArray(b.quotes))&&(f=b.quotes),"boolean"!=typeof b.skipEmptyLines&&"string"!=typeof b.skipEmptyLines||(k=b.skipEmptyLines),"string"==typeof b.newline&&(i=b.newline),"string"==typeof b.quoteChar&&(j=b.quoteChar),"boolean"==typeof b.header&&(g=b.header))}();var l=new RegExp(j,"g");if("string"==typeof a&&(a=JSON.parse(a)),Array.isArray(a)){if(!a.length||Array.isArray(a[0]))return d(null,a,k);if("object"==typeof a[0])return d(c(a[0]),a,k)}else if("object"==typeof a)return"string"==typeof a.data&&(a.data=JSON.parse(a.data)),Array.isArray(a.data)&&(a.fields||(a.fields=a.meta&&a.meta.fields),a.fields||(a.fields=Array.isArray(a.data[0])?a.fields:c(a.data[0])),Array.isArray(a.data[0])||"object"==typeof a.data[0]||(a.data=[a.data])),d(a.fields||[],a.data||[],k);throw"exception: Unable to serialize unrecognized input"}};if(x.RECORD_SEP=String.fromCharCode(30),x.UNIT_SEP=String.fromCharCode(31),x.BYTE_ORDER_MARK="\ufeff",x.BAD_DELIMITERS=["\r","\n",'"',x.BYTE_ORDER_MARK],x.WORKERS_SUPPORTED=!s&&!!r.Worker,x.SCRIPT_PATH=null,x.NODE_STREAM_INPUT=1,x.LocalChunkSize=10485760,x.RemoteChunkSize=5242880,x.DefaultDelimiter=",",x.Parser=i,x.ParserHandle=g,x.NetworkStreamer=b,x.FileStreamer=c,x.StringStreamer=d,x.ReadableStreamStreamer=e,x.DuplexStreamStreamer=f,r.jQuery){var y=r.jQuery;y.fn.parse=function(a){function b(){if(0!==e.length){var b,d,f,g,h=e[0];if(o(a.before)){var i=a.before(h.file,h.inputElem);if("object"==typeof i){if("abort"===i.action)return b="AbortError",d=h.file,f=h.inputElem,g=i.reason,void(o(a.error)&&a.error({name:b},d,f,g));if("skip"===i.action)return void c();"object"==typeof i.config&&(h.instanceConfig=y.extend(h.instanceConfig,i.config))}else if("skip"===i)return void c()}var j=h.instanceConfig.complete;h.instanceConfig.complete=function(a){o(j)&&j(a,h.file,h.inputElem),c()},x.parse(h.file,h.instanceConfig)}else o(a.complete)&&a.complete()}function c(){e.splice(0,1),b()}var d=a.config||{},e=[];return this.each(function(a){if("INPUT"!==y(this).prop("tagName").toUpperCase()||"file"!==y(this).attr("type").toLowerCase()||!r.FileReader||!this.files||0===this.files.length)return!0;for(var b=0;b<this.files.length;b++)e.push({file:this.files[b],inputElem:this,instanceConfig:y.extend({},d)})}),b(),this}}return t?r.onmessage=function(a){var b=a.data;if(void 0===x.WORKER_ID&&b&&(x.WORKER_ID=b.workerId),"string"==typeof b.input)r.postMessage({workerId:x.WORKER_ID,results:x.parse(b.input,b.config),finished:!0});else if(r.File&&b.input instanceof File||b.input instanceof Object){var c=x.parse(b.input,b.config);c&&r.postMessage({workerId:x.WORKER_ID,results:c,finished:!0})}}:x.WORKERS_SUPPORTED&&(q=document.getElementsByTagName("script"),p=q.length?q[q.length-1].src:"",document.body?document.addEventListener("DOMContentLoaded",function(){u=!0},!0):u=!0),(b.prototype=Object.create(a.prototype)).constructor=b,(c.prototype=Object.create(a.prototype)).constructor=c,(d.prototype=Object.create(d.prototype)).constructor=d,(e.prototype=Object.create(a.prototype)).constructor=e,(f.prototype=Object.create(a.prototype)).constructor=f,x});var getMontoRange=function(a){var b=5e7,c="monto_mas_50";return c=_.inRange(a,0,b)?"monto_0_50":_.inRange(a,b,2*b)?"monto_50_100":_.inRange(a,2*b,3*b)?"monto_100_150":"monto_mas_50"},cleanData=function(a,b,c){var d={};for(var e in a)a.hasOwnProperty(e)&&(d[e.toLowerCase()]=a[e]);d.compromiso="SI"==d.compromiso?!0:!1;var f=d.comuna?d.comuna.split("|"):[null];d.comuna=f[0],d.comuna=d.comuna?parseInt(d.comuna.trim()):d.comuna,d.barrio=d.barrio?d.barrio.split("|"):[],d.licitacion_oferta_empresa=d.licitacion_oferta_empresa?d.licitacion_oferta_empresa:null,d.mano_obra=d.mano_obra?parseInt(d.mano_obra):null,d.id=parseInt(d.id||b),d.licitacion_anio=d.licitacion_anio?parseInt(d.licitacion_anio.trim()):null,d.monto_contrato=d.monto_contrato?parseFloat(d.monto_contrato.replace(/[$]+/g,"").trim()):null,d.licitacion_presupuesto_oficial=d.licitacion_presupuesto_oficial?parseFloat(d.licitacion_presupuesto_oficial.trim()):null,d.plazo_meses=d.plazo_meses?parseInt(d.plazo_meses.trim()):null,d.porcentaje_avance=d.porcentaje_avance?d.porcentaje_avance.trim():"",d.porcentaje_avance.trim(),d.porcentaje_avance=isNaN(d.porcentaje_avance)?"":d.porcentaje_avance,d.porcentaje_avance=d.porcentaje_avance?parseFloat(d.porcentaje_avance):null,d.porcentaje_avance="Finalizada"===d.etapa?100:d.porcentaje_avance,d.hideDates="En proyecto"===d.etapa||"En licitaciÃ³n"===d.etapa||!d.fecha_inicio||!d.fecha_fin_inicial,d.fotos=[];for(var g=1;4>=g;g++){var e="imagen_"+g;d[e]&&(d.fotos[g-1]=d[e])}return d.entorno_slug=d.entorno?c.slugify(d.entorno.trim()):null,d.etapa_slug=d.etapa?c.slugify(d.etapa.trim()):null,d.tipo_slug=d.tipo?c.slugify(d.tipo.trim()):null,d.entorno=d.entorno?d.entorno:null,d.area_slug=d.area_responsable?c.slugify(d.area_responsable.trim()):null,d.red_slug=d.red?c.slugify(d.red.trim()):null,d.monto_slug=d.monto_contrato?getMontoRange(d.monto_contrato):null,d.hasDetail=!!(d.etapa||d.etapa_detalle||d.tipo||d.area_responsable||d.licitacion_oferta_empresa||d.porcentaje_avance||d.plazo_meses||d.licitacion_anio||d.beneficiarios||d.mano_obra||d.monto_contrato||d.licitacion_presupuesto_oficial||d.pliego_descarga),d};angular.module("obrasMduytApp",["ngRoute","ngSanitize","slugifier","angular-flexslider","leaflet-directive","ngTable"]).config(["$routeProvider","$logProvider","$httpProvider","$locationProvider","$provide",function(a,b,c,d,e){a.when("/home",{templateUrl:"views/home.html",controller:"HomeCtrl",controllerAs:"home"}).when("/buscador",{templateUrl:"views/buscador.html",controller:"BuscadorCtrl",controllerAs:"buscador"}).when("/obra/:id",{templateUrl:"views/obra.html",controller:"ObraCtrl",controllerAs:"obra"}).when("/entorno/:entorno",{templateUrl:"views/entorno.html",controller:"EntornoCtrl",controllerAs:"entorno"}).otherwise({redirectTo:"/home"}),b.debugEnabled(!1),d.hashPrefix(""),e.decorator("$locale",["$delegate",function(a){return a.NUMBER_FORMATS.DECIMAL_SEP=",",a.NUMBER_FORMATS.GROUP_SEP=".",a}])}]).service("DataService",["$http","$q","Slug","$sce",function(a,b,c,d){var e,f,g=function(){if(!window.MDUYT_CONFIG)throw"Archivo de configuraciÃ³n inexistente";var a;return"GET_REQUEST"===window.MDUYT_CONFIG.LOAD_USING?a=window.MDUYT_CONFIG.MAPAS_CSV:"JSONP_PROXY"===window.MDUYT_CONFIG.LOAD_USING&&(a=window.MDUYT_CONFIG.JSON_PROXY+"?source_format=csv&source="+window.MDUYT_CONFIG.MAPAS_CSV),d.trustAsResourceUrl(a)};this.getById=function(a){var c,d=b.defer();return this.retrieveAll().then(function(b){c=b.filter(function(b){return b.id===parseInt(a)}),d.resolve(c[0])}),c=d.promise,b.when(c)},this.getByEntorno=function(a){var c,d=b.defer();return this.retrieveAll().then(function(b){c=b.filter(function(b){return b.entorno_slug===a}),d.resolve(c)}),c=d.promise,b.when(c)},this.getAll=function(){var a,c=b.defer();return this.retrieveAll().then(function(a){c.resolve(a)}),a=c.promise,b.when(a)},this.getMapas=function(){var a,c=b.defer();return this.retrieveMapas().then(function(a){c.resolve(a)}),a=c.promise,b.when(a)},this.retrieveMapas=function(){var c=g(),d=b.defer();return""==c&&(f=[]),f||(a.jsonp(c).then(function(a){f=a.data,d.resolve(f)},function(a){console.log("error: ",a),e=a,d.reject(a)}),f=d.promise),b.when(f)},this.retrieveAll=function(){return e||(e=loadData(d,b,a,c)),b.when(e)}}]).filter("capitalize",function(){return function(a){return a?a.charAt(0).toUpperCase()+a.substr(1).toLowerCase():""}}).filter("cleanunderscore",function(){return function(a){return a.replace(/_/g," ")}}).run(function(){}),angular.module("obrasMduytApp").directive("progressLine",function(){return{restrict:"E",replace:!0,scope:{callback:"=callback","class":"=class"},controller:["$scope","$timeout","$http",function(a,b,c){a.loading=!0;var d=function(){var b=a.obra,c=moment(b.fecha_inicio),d=moment(b.fecha_fin_inicial),e=moment(),f=d3.scale.linear().domain([0,100]).range([c.valueOf(),d.valueOf()]),g=e.valueOf(),h=parseFloat(b.porcentaje_avance);100>h&&(g=f(h));var i,j,k,l,m,i=[{label:"Category 1",value:g}],n=0,o=document.querySelectorAll(".chart")[0].clientWidth,p=55,q=5,r=0,s=d3.scale.linear().domain([c.valueOf(),d.valueOf()]).range([0,o]);d.valueOf();d3.select(".chart").html("");var k=d3.select(".chart").append("svg").attr("width",o).attr("height",p);j=k.selectAll("g").data(i).enter().append("g"),j.attr("class","bar").attr("cx",0).attr("transform",function(a,b){return"translate("+n+","+(b*(q+r)+r)+")"}),l=s,m=d3.svg.axis().scale(l).tickSize(2).orient("bottom"),j.append("rect").attr("transform","translate(0, 15)").attr("height",1).attr("width",function(a){return l(f(100))}),k.append("g").append("text").attr("class","value").attr("y",30).attr("x",0).attr("dx",0).attr("dy","0").attr("text-anchor","start").text("Inicio"),k.append("g").append("text").attr("class","value").attr("y",45).attr("x",0).attr("dx",0).attr("dy","0").attr("text-anchor","start").text(c.format("MM-YYYY")),k.append("g").append("text").attr("class","value").attr("y",30).attr("x",o).attr("dx",0).attr("dy","0").attr("text-anchor","end").text("Fin"),k.append("g").append("text").attr("class","value").attr("y",45).attr("x",o).attr("dx",0).attr("dy","0").attr("text-anchor","end").text(d.format("MM-YYYY"))},e=function(b){a.obra=b,setTimeout(d,100)};a.resizeFunction=d,a.callback(e);var f;$(window).resize(function(){clearTimeout(f),f=setTimeout(function(){a.resizeFunction&&a.resizeFunction()},500)})}],template:'<div class="chart"></div>'}}),angular.module("obrasMduytApp").directive("coloredIcons",function(){return{restrict:"E",replace:!0,scope:{callback:"=callback",scale:"=scale","class":"=class"},controller:["$scope","$element","$timeout","$http",function(a,b,c,d){a.loading=!0;a.scale;a.id="content-"+Math.floor(1e4*Math.random());var e=("."+a.id,function(c){b[0].clientWidth;setTimeout(function(){function d(a){var b=(a.percent,g*h),c=b*(a.percent/100),d=c%1;d3.selectAll("use").attr("fill",function(a,b){return c-1>a?"#f1662f":a>c-1&&c>a?(f.append("svg:stop").attr("offset",100*d+"%").attr("stop-color","#f1662f").attr("stop-opacity",1),f.append("svg:stop").attr("offset",100*d+"%").attr("stop-color","#aaa").attr("stop-opacity",1),f.append("svg:stop").attr("offset","100%").attr("stop-color","#aaa").attr("stop-opacity",1),"url(#gradient)"):"#aaa"})}d3.select(b[0]).html("");var e=d3.select(b[0]).append("svg").attr("viewBox","0 0 100 16"),f=e.append("svg:defs").append("svg:linearGradient").attr("id","gradient").attr("y1","100%").attr("y2","0%").attr("spreadMethod","pad");f.append("svg:stop").attr("offset","0%").attr("stop-color","#f1662f").attr("stop-opacity",1),e.append("defs").append("g").attr("id","iconCustom").append("path").attr("d","M3.5,2H2.7C3,1.8,3.3,1.5,3.3,1.1c0-0.6-0.4-1-1-1c-0.6,0-1,0.4-1,1c0,0.4,0.2,0.7,0.6,0.9H1.1C0.7,2,0.4,2.3,0.4,2.6v1.9c0,0.3,0.3,0.6,0.6,0.6h0.2c0,0,0,0.1,0,0.1v1.9c0,0.3,0.2,0.6,0.3,0.6h1.3c0.2,0,0.3-0.3,0.3-0.6V5.3c0,0,0-0.1,0-0.1h0.2c0.3,0,0.6-0.3,0.6-0.6V2.6C4.1,2.3,3.8,2,3.5,2z"),e.append("rect").attr("width",100).attr("height",10).attr("fill","#efefef");var g=22,h=1,i=2,j=1,k=4.3,l=4.3,m=d3.range(g*h);e.append("text").attr("id","txtValue").attr("x",1).attr("y",15).attr("dy",0).text("Manzana"),e.append("text").attr("id","txtValue").attr("x",30).attr("y",15).attr("dy",0).text("Barrio"),e.append("text").attr("id","txtValue").attr("x",60).attr("y",15).attr("dy",0).text("Comuna"),e.append("text").attr("id","txtValue").attr("x",85.5).attr("y",15).attr("dy",0).text("Ciudad"),e.append("g").attr("id","pictoLayer").selectAll("use").data(m).enter().append("use").attr("xlink:href","#iconCustom").attr("id",function(a){return"icon"+a}).attr("x",function(a){var b=a%g;return i+b*l}).attr("y",function(a){var b=Math.floor(a/g);return j+b*k}).classed("iconPlain",!0);var n=1,o=1;"manoDeObra"===a.scale&&(n=20,o=c.mano_obra),"beneficiarios"===a.scale&&(n=5e4,o=c.benficiarios);var p=100*o/(n*g),q={percent:p};d(q)},300)});a.callback(e)}],template:"<div class='colored'></div>"}}),angular.module("obrasMduytApp").directive("selectorHome",function(){return{restrict:"E",scope:{list:"=",updateFn:"&",selectedGroup:"="},template:"<div id='selector-home' class='row' ng-show='selectedGroup'><div ng-repeat='(key, g) in list' class='col-md-4 selector' ng-class='{\"selectorSelected\":selectedGroup==g.id}'><a ng-click='updateFn({group:g.id})'><img ng-src=\"{{'images/selectores/'+g.id+'.svg'}}\"/><span>{{g.name}}</span></a></div></div>",replace:!0,link:function(a,b,c){}}}),angular.module("obrasMduytApp").directive("statsHome",["$timeout",function(a){return{restrict:"E",scope:{
obras:"="},templateUrl:"views/includes/stats-home.html",replace:!0,link:function(b,c,d){function e(){_.map(g,function(a){b.totalTemp.obras+=1,f(b.totalTemp.obras,"obras"),a.monto_contrato&&(b.totalTemp.inversion+=a.monto_contrato,f(b.totalTemp.inversion,"inversion")),a.mano_obra&&(b.totalTemp.mano_obra+=a.mano_obra,f(b.totalTemp.mano_obra,"mano_obra")),100==a.porcentaje_avance&&(b.totalTemp.finalizadas+=1,f(Math.round(100*b.totalTemp.finalizadas/b.totalTemp.obras),"porcentaje_finalizadas"))})}function f(c,d){a(function(){b.total[d]=c},200)}b.totalTemp={inversion:0,obras:0,finalizadas:0,mano_obra:0},b.total={inversion:0,obras:0,porcentaje_finalizadas:0,mano_obra:0};var g;b.$watch(d.obras,function(a){a&&(g=angular.copy(a),e())})}}}]),angular.module("obrasMduytApp").directive("tipoChart",function(){return{restrict:"E",scope:{obras:"=",filterFn:"&",finishFn:"&",selectedFilter:"=",tipoColors:"="},template:"<div id='tipo-chart' class='row chart-item'><div class='col-md-2'><h4>Filtrar por tipo de obra</h4></div></div>",replace:!0,link:function(a,b,c){function d(){var b=_.groupBy(h.filter(function(a){return"undefined"!=typeof a.tipo}),"tipo");a.total_obras_by_tipo=_.orderBy(_.reduce(b,function(a,b,c){return a.push({tipo:c,slug:b[0].tipo_slug,cantidad:b.length}),a},[]),"cantidad","desc"),e(),window.$(window).resize(function(){g!=$(window).width()&&(clearTimeout(a.timeoutId),a.timeoutId=setTimeout(function(){e()},1e3))})}function e(){i.w=d3.select("#tipo-chart").node().getBoundingClientRect().width,i.margin=i.w/100,i.barh=40,i.gap=10,i.h=a.total_obras_by_tipo.length*(i.barh+i.gap)+2*i.gap,i.tipo_chart_container||(i.tipo_chart_container=d3.select("#tipo-chart").append("div").attr("id","tipo-chart-container").classed("col-md-10",!0),i.groups=i.tipo_chart_container.selectAll("div.tipo-group").data(a.total_obras_by_tipo),i.groups.enter().append("div").attr("id",function(a){return"tipo-group-"+a.slug}).classed("tipo-group",!0).each(function(b){var c=d3.select(this),d=c.append("a").datum(b).classed("tipo-container",!0).on("click",function(b){a.filterFn({filter:b.slug})}),e=d.append("div").classed("image-container",!0);d.append("span").datum(b).classed("tipo-text",!0).attr("fill","#fff").text(function(){return b.tipo}),d3.xml("images/iconos/"+b.slug+".svg",function(c,d){if(c)return void console.error(c);var f=d.getElementsByTagName("svg")[0];e.node().appendChild(f);var g=a.tipoColors(b.tipo),h=e.select("svg").attr("height",50).attr("width",50);h.selectAll("path,rect").attr("fill",g)})})),a.finishFn()}function f(){if(a.selectedFilter){var b=i.tipo_chart_container.select("#tipo-group-"+a.selectedFilter);b.empty()?i.tipo_chart_container.selectAll(".tipo-group").classed("selected",!1):(i.tipo_chart_container.selectAll(".tipo-group").classed("selected",!1),b.classed("selected",!0))}else i.tipo_chart_container.selectAll(".tipo-group").classed("selected",!1)}var g=0;$(window).load(function(){g=$(window).width()});var h,i={};a.$watch(c.obras,function(a){a&&"object"==typeof a&&(h=a,d())}),a.$watch(c.selectedFilter,function(a){i.groups&&f()})}}}),angular.module("obrasMduytApp").directive("etapaChart",function(){return{restrict:"E",scope:{obras:"=",filterFn:"&",selectedFilter:"=",tipoColors:"="},template:"<div id='etapa-chart'></div>",replace:!0,link:function(a,b,c){function d(){a.obras_by_etapa=_.map(_.groupBy(h.filter(function(a){return"undefined"!=typeof a.etapa}),"etapa"),function(a,b){var c=_.groupBy(a.filter(function(a){return"undefined"!=typeof a.tipo}),"tipo"),d={slug:a[0].etapa_slug,etapa:a[0].etapa,obras:_.orderBy(_.reduce(c,function(a,b,c){return a.push({tipo:c,slug:b[0].tipo_slug,cantidad:b.length}),a},[]),"cantidad","desc")};return d.cantidad=d3.sum(d.obras,function(a){return a.cantidad}),d}),e()}function e(){i.w=d3.select("#etapa-chart").node().getBoundingClientRect().width,i.margin=i.w/100,i.barh=40,i.gap=10,i.h=2*i.barh+2*i.gap,i.svg||(i.svg=d3.select("#etapa-chart").append("svg"),i.mainGroup=i.svg.append("g").classed("main-group",!0),i.selection=i.mainGroup.append("rect").classed("selection",!0).attr("height",i.gap+i.barh).attr("x",i.w).attr("y",i.barh).attr("fill","#ffbc00"),i.pipe=i.mainGroup.append("line").classed("pipe",!0).attr("height",i.h).attr("y1",i.barh/2).attr("y2",2*i.barh+2*i.gap).attr("fill","black").attr("stroke","black").attr("stroke-width",1)),i.max=d3.max(a.obras_by_etapa,function(a){return a.cantidad}),i.scale=d3.scale.linear().domain([0,i.max]).range([0,i.w/2-2*i.gap]),i.svg.attr("width",i.w).attr("height",i.h),i.selection.attr("width",i.w/2-i.gap),i.groups=i.mainGroup.selectAll("g.etapa-group").data(a.obras_by_etapa),i.pipe.attr("x1",i.w/2).attr("x2",i.w/2),i.groups.enter().append("g").attr("id",function(a){return"etapa-group-"+a.slug}).classed("etapa-group",!0).each(function(b,c){var d=d3.select(this);b.index=c,_.map(b.obras,function(a){return a.index=c,a}),d.selectAll("rect.etapa-rect").data(b.obras).enter().append("rect").classed("etapa-rect",!0).attr("y",i.barh+i.gap).attr("height",i.barh).attr("fill",function(b){return a.tipoColors(b.tipo)}),d.append("text").datum(b).classed("etapa-text",!0).attr("fill","#000").attr("y",i.barh).text(function(){return b.etapa}).attr("text-anchor",function(){return 0==c?"end":"start"}),d.append("rect").datum(b).classed("click-rect",!0).attr("fill","red").attr("fill-opacity",0).on("click",function(b){a.filterFn({filter:b.slug})})});var b={g0:i.scale(i.max)+i.gap,g1:i.gap};i.groups.selectAll("rect.etapa-rect").attr("width",function(a){return i.scale(a.cantidad)}).attr("x",function(a){var c=a.cantidad,d=0==a.index?Math.abs(i.scale(c)-b["g"+a.index]):i.scale(0)+b["g"+a.index];return b["g"+a.index]=0==a.index?b["g"+a.index]-i.scale(c):b["g"+a.index]+i.scale(c),d}),i.groups.selectAll("text.etapa-text").attr("x",function(a){return 0==a.index?i.w/2-i.gap:i.gap}),i.groups.selectAll("rect.click-rect").attr("width",i.w/2).attr("height",2*i.barh+2*i.gap),i.groups.transition().attr("transform",function(a,b){var c=0==b?0:i.w/2;return"translate("+c+",0)"})}function f(){if(a.selectedFilter){var b=i.mainGroup.select("#etapa-group-"+a.selectedFilter);if(b.empty())i.selection.transition().attr("x",i.w);else{var c=d3.transform(b.attr("transform")),d=c.translate[0],e=c.translate[1];i.selection.transition().attr("x",d+i.gap/2).attr("y",e+i.barh+i.gap/2)}}else i.selection.transition().attr("x",i.w)}var g=0;$(window).load(function(){g=$(window).width()});var h,i={};a.$watch(c.obras,function(a){a&&(h=a,d())}),a.$watch(c.selectedFilter,function(a){i.groups&&f()}),window.$(window).resize(function(){g!=$(window).width()&&(clearTimeout(a.timeoutId),a.timeoutId=setTimeout(function(){e()},1e3))})}}}),angular.module("obrasMduytApp").directive("areaResponsableChart",function(){return{restrict:"E",scope:{obras:"=",filterFn:"&",selectedFilter:"="},templateUrl:"views/includes/home-area.html",replace:!0,link:function(a,b,c){function d(){var b=_.groupBy(h.filter(function(a){return"undefined"!=typeof a.area_responsable}),"area_responsable");a.total_obras_by_area=_.orderBy(_.reduce(b,function(a,b,c){return a.push({area:c,slug:b[0].area_slug,cantidad:b.length}),a},[]),"cantidad","desc"),a.total_obras_by_area_key=_.groupBy(a.total_obras_by_area,"slug");d3.select("#area-responsable-chart #areas").on("change",function(b){var c=d3.select("#area-responsable-chart #areas").property("value");a.filterFn({filter:c})});e()}function e(){i.w=d3.select("#stats-home").node().getBoundingClientRect().width,i.margin=i.w/100,i.barh=27,i.gap=2,i.h=i.barh+2*i.gap,i.svg||(i.svg=d3.select("#area-responsable-chart #mini-chart").append("svg"),i.mainGroup=i.svg.append("g").classed("main-group",!0)),a.total=d3.sum(a.total_obras_by_area,function(a){return a.cantidad}),a.selectedCantidad=a.total,i.scale=d3.scale.linear().domain([0,a.total]).range([0,i.w-(a.total_obras_by_area.length+2*i.gap)]),i.svg.attr("width",i.w).attr("height",i.h),i.groups=i.mainGroup.selectAll("g.area-group").data(a.total_obras_by_area),i.groups.enter().append("g").attr("id",function(a){return"area-group-"+a.slug}).classed("area-group",!0).each(function(b){var c=d3.select(this);c.append("rect").datum(b).classed("area-rect",!0).attr("x",i.gap),c.append("rect").datum(b).classed("click-rect",!0).attr("x",i.gap).on("click",function(b){a.filterFn({filter:b.slug})})}),i.groups.selectAll("rect.area-rect").attr("height",i.barh).attr("width",function(a){return i.scale(a.cantidad)}),i.groups.selectAll("rect.click-rect").attr("height",i.barh).attr("width",function(a){return i.scale(a.cantidad)});var b=0;i.groups.transition().attr("transform",function(a){var c=b;return b=b+i.scale(a.cantidad)+i.scale(i.gap),"translate("+c+",0)"})}function f(){if(i.mainGroup.selectAll(".area-rect").classed("selected",!1),a.total_obras_by_area_key[a.selectedFilter]){a.selected=a.selectedFilter;var b=i.mainGroup.select("#area-group-"+a.selectedFilter).select(".area-rect");b.empty()||b.classed("selected",!0),a.selectedCantidad=a.total_obras_by_area_key[a.selectedFilter][0].cantidad}else a.selected="",a.selectedCantidad=a.total}var g=0;$(window).load(function(){g=$(window).width()});var h,i={};a.$watch(c.obras,function(a){a&&(h=a,d())}),a.$watch(c.selectedFilter,function(a){i.groups&&f()}),a.selected="",window.$(window).resize(function(){g!=$(window).width()&&(clearTimeout(a.timeoutId),a.timeoutId=setTimeout(function(){e()},1e3))})}}}),angular.module("obrasMduytApp").controller("HomeCtrl",["$scope","DataService","$filter",function(a,b,c){function d(){x.w=w.select("#home-chart-container").node().getBoundingClientRect().width,x.w=!x.svg||x.w<500?x.w-15:x.w,a.isSmallDevice=x.w<700?!0:!1,a.isSmallDevice?(x.h=x.w,x.margin=x.w/100):(x.h=x.w,x.margin=x.w/200),x.svg||(x.svg=w.select("#home-chart-container").append("svg"),x.mainGroup=x.svg.append("g").classed("main-group",!0),x.mainGroup.append("rect").attr("fill","white"),x.svg.append("g").attr("id","comunas-group"),x.svg.append("g").attr("id","map-group"),x.svg.append("g").attr("id","montos-group"),x.redes=x.svg.append("g").attr("id","redes-group"),z.group=x.svg.append("g").attr("id","bubbles-group"),x.selection=x.svg.append("circle").attr("class","selection-cicle").attr("cx",0).attr("cy",0).attr("r",0).style("fill","none").style("stroke","black").style("stroke-width",2)),x.svg.attr("width",x.w).attr("height",x.h),x.mainGroup.select("rect").attr("width",x.w).attr("height",x.h),a.showGroup()}function e(a,b,c){var d=Math.floor(x.w/b),e=0,f=0;a.transition().duration(700).attr("transform",function(g,h){var i=e*b,j=f*c;return d-1>e?e++:a[0].length!==h+1&&(e=0,f++),"translate("+i+","+j+")"})}function f(){function b(){var b={nodes:[],links:[]},c=[],d=w.nest().key(function(a){return a.comuna}).rollup(function(a){return{cantidad:a.length,hijos:w.nest().key(function(a){return a.tipo}).rollup(function(a){return{cantidad:a.length,hijos:w.nest().key(function(a){return a.etapa}).rollup(function(a){return{cantidad:a.length,hijos:a}}).map(a.filter(function(a){return""!=a.etapa}))}}).map(a.filter(function(a){return""!=a.tipo}))}}).map(a.obras.filter(function(a){return a.comuna&&a.tipo&&a.etapa}));E.each(d,function(a,b){E.each(a.hijos,function(a,d){c.push({source:b,target:d,value:a.cantidad}),E.each(a.hijos,function(a,b){c.push({source:d,target:b,value:a.cantidad})})})});var e={};return c.forEach(function(a){b.nodes.push({name:a.source}),b.nodes.push({name:a.target}),e[a.source+"|"+a.target]||(e[a.source+"|"+a.target]={source:a.source,target:a.target,value:0}),e[a.source+"|"+a.target].value+=a.value}),E.forOwn(e,function(a,c){b.links.push(a)}),b.nodes=w.keys(w.nest().key(function(a){return a.name}).map(b.nodes)),b.links.forEach(function(a,c){b.links[c].source=b.nodes.indexOf(b.links[c].source),b.links[c].target=b.nodes.indexOf(b.links[c].target)}),b.nodes.forEach(function(a,c){b.nodes[c]={"node:":c,name:a}}),b}y.w=w.select("#sankey-chart-container").node().getBoundingClientRect().width,y.w=!y.svg||y.w<500?y.w-15:y.w,y.h=700,y.margin=y.w/100,y.svg||(y.svg=w.select("#sankey-chart-container").append("svg"),y.mainGroup=y.svg.append("g").classed("main-group",!0),y.mainGroup.append("rect").attr("fill","white")),y.svg.attr("width",y.w).attr("height",y.h),y.mainGroup.select("rect").attr("width",y.w).attr("height",y.h),y.sankey=w.sankey().nodeWidth(20).nodePadding(2).size([y.w,y.h]),y.path=y.sankey.link(),y.graph=b(),y.sankey.nodes(y.graph.nodes).links(y.graph.links).layout(32),y.link=y.mainGroup.selectAll(".link").data(y.graph.links).enter().append("path").attr("class","link").attr("d",y.path).style("stroke-width",function(a){return Math.max(1,a.dy)}).style("stroke",function(b){return a.tipo_colors.domain().indexOf(b.source.name)>-1?a.tipo_colors(b.source.name):a.tipo_colors(b.target.name)}).sort(function(a,b){return b.dy-a.dy}),y.link.append("title").text(function(a){var b=isNaN(a.source.name)?a.source.name:"Comuna "+a.source.name;return b+" â "+a.target.name+"\nObras: "+a.value}),y.node=y.mainGroup.selectAll(".node").data(y.graph.nodes).enter().append("g").attr("class","node").attr("transform",function(a){return"translate("+a.x+","+a.y+")"}),y.node.append("rect").attr("height",function(a){return a.dy}).attr("width",y.sankey.nodeWidth()).style("fill",function(b){return a.tipo_colors.domain().indexOf(b.name)>-1?a.tipo_colors(b.name):"#000"}).append("title").text(function(a){var b=isNaN(a.name)?a.name:"Comuna "+a.name;return b+="\nObras: "+a.value}),y.node.append("text").attr("y",function(a){return a.dy/2}).attr("x",function(a){return isNaN(a.name)?-3:3+y.sankey.nodeWidth()}).attr("text-anchor",function(a){return isNaN(a.name)?"end":"start"}).attr("dy",".35em").attr("transform",null).style("font-size",function(a){return isNaN(a.name)?"14px":"10px"}).text(function(a){return a.name}).filter(function(a){return a.x<y.width/2})}function g(){function b(){a.isSmallDevice&&x.svg.attr("height",x.w),x.mapGroup.selectAll("path.map-item").style("display","block").style("stroke-width",0).transition().duration(1e3).style("stroke-width",3).attr("d",x.mapPath).style("opacity",1)}x.mapProjection=w.geo.mercator().center([-58.43992,-34.618]).translate([x.w/2,x.h/2]).scale(240*x.w),x.mapPath=w.geo.path().projection(x.mapProjection),x.mapGroup?b():(x.mapGroup=x.svg.select("#map-group"),w.json("geo/comunas.simple.geojson",function(a){x.mapCentroids={},x.mapFeatures=a.features,E.each(x.mapFeatures,function(a){x.mapCentroids["mapa-comuna-"+a.properties.comuna]=x.mapPath.centroid(a)}),x.mapGroup.selectAll("path.map-item").data(x.mapFeatures).enter().append("path").classed("child",!0).classed("map-item",!0).attr("id",function(a){return"mapa-comuna-"+a.properties.comuna}).classed("shape",!0).on("click",i),b()}))}function h(){z.clusters={},z.clusterPoints={},z.nodesComuna=[],z.nodes=a.obras.filter(function(a){return a.lat&&a.lng}).map(function(a){var b="i"+a.id,c=4,d={cluster:b,radius:c,data:a};z.clusters[b]=d;var e=x.mapProjection([parseFloat(a.lng),parseFloat(a.lat)]);return z.clusterPoints[b]={x:e[0],y:e[1],radius:4},d}),z.scale=!1}function i(b){if(a.closeTooltip(),G.node()===this)return j();G.classed("active",!1),G=w.select(this).classed("active",!0);var c=x.mapPath.bounds(b),d=c[1][0]-c[0][0],e=c[1][1]-c[0][1],f=(c[0][0]+c[1][0])/2,g=(c[0][1]+c[1][1])/2,h=.9/Math.max(d/x.w,e/x.h),i=[x.w/2-h*f,x.h/2-h*g];x.mapGroup.transition().duration(750).attr("transform","translate("+i+")scale("+h+")"),x.mapGroup.selectAll("path").transition().duration(750).style("stroke-width","1px"),z.group.transition().duration(750).attr("transform","translate("+i+")scale("+h+")")}function j(){G.classed("active",!1),G=w.select(null),x.mapGroup.transition().duration(750).attr("transform",""),x.mapGroup.selectAll("path").transition().duration(750).style("stroke-width","3px"),z.group.transition().duration(750).attr("transform","")}function k(b){var c,d,f=w.range(1,16);a.isSmallDevice?(c=x.w,d=x.w,x.svg.attr("height",f.length*x.w),x.mainGroup.select("rect").attr("height",f.length*x.w)):(c=x.h/3,d=x.w/5),x.comunasGroup||(x.comunasGroup=x.svg.select("#comunas-group"),x.comunasGroup.selectAll("g.comunas-item").data(f).enter().append("g").classed("child",!0).classed("comunas-item",!0).style("opacity",0).attr("transform",function(a,b){return"translate("+(x.w/2-d/2)+","+(x.h/2-c/2)+")"}).attr("id",function(a){return"comunas-item-"+a}).each(function(){var a=w.select(this);a.append("rect").classed("comunas-item-frame",!0).on("click",m),a.append("text").classed("comunas-item-text",!0).attr("fill","#000").text(function(a){return"Comuna "+a})})),b||x.comunasGroup.selectAll("g.comunas-item").style("display","block"),x.comunasGroup.selectAll("rect.comunas-item-frame").transition().duration(700).attr("x",x.margin).attr("y",x.margin).attr("height",c-2*x.margin).attr("width",d-2*x.margin),x.comunasGroup.selectAll("text.comunas-item-text").transition().duration(700).attr("x",15).attr("y",25),e(x.comunasGroup.selectAll("g.comunas-item").transition().duration(1e3).style("opacity",1),d,c)}function l(b){z.clusters={},z.clusterPoints={};var c=b?b.replace("comunas-item-",""):!1,d=a.obras.filter(function(a){return a.comuna&&""!=a.comuna&&(!c||c&&a.comuna===c)}),e=Math.ceil(w.max(d,function(b){return b[a.selectedRadioDimension]})),f=Math.floor(w.min(d,function(b){return b[a.selectedRadioDimension]}));z.scale=w.scale.linear().domain([parseInt(f),parseInt(e)]).range([10,c?100:50]),z.nodes=d.filter(function(a){return a.comuna&&(!c||c&&a.comuna===c)}).map(function(a){var b="c"+a.comuna,d=c?10:5,e={cluster:b,radius:d?d:10,data:a};return(!z.clusters[b]||d>z.clusters[b].radius)&&(z.clusters[b]=e),e}),w.selectAll("g.comunas-item").each(function(a){var b=w.select(this),c=b.select("rect");z.clusterPoints["c"+a]={x:w.transform(b.attr("transform")).translate[0]+c.attr("width")/2,y:w.transform(b.attr("transform")).translate[1]+c.attr("height")/2,radius:20}})}function m(b){if(!a.isSmallDevice){if(a.closeTooltip(),H.node()===this)return n();H.classed("active",!1),H=w.select(this).classed("active",!0);var c=H.node().parentNode;w.selectAll("g.comunas-item").transition().style("opacity",function(){return this===c?1:0}).each("end",function(){this!==c&&w.select(this).style("display","none")}),H.transition().duration(750).attr("height",x.h-2*x.margin).attr("width",x.w-2*x.margin),w.select(c).transition().duration(750).attr("transform","translate(0,0)").each("end",function(){l(w.select(c).attr("id")),s()})}}function n(a){H.classed("active",!1),H=w.select(null),w.selectAll("g.comunas-item").style("display","block"),k(a),a||setTimeout(function(){l(),s()},2e3)}function o(b){var c,d,f=["monto_0_50","monto_50_100","monto_100_150","monto_mas_50"],g={monto_0_50:"Hasta 50 millones",monto_50_100:"50  a 100 millones",monto_100_150:"100 a 150 millones",monto_mas_50:"MÃ¡s de 150 millones"};a.isSmallDevice?(c=x.w,d=x.w,x.svg.attr("height",f.length*x.w),x.mainGroup.select("rect").attr("height",f.length*x.w)):(c=x.h/2,d=x.w/2),x.montosGroup||(x.montosGroup=x.svg.select("#montos-group"),x.montosGroup.selectAll("g.montos-item").data(f).enter().append("g").classed("child",!0).classed("montos-item",!0).style("opacity",0).attr("transform",function(a,b){return"translate("+(x.w/2-d/2)+","+(x.h/2-c/2)+")"}).attr("id",function(a){return"montos-item-"+a}).each(function(){var a=w.select(this);a.append("rect").classed("montos-item-frame",!0).on("click",r),a.append("text").classed("montos-item-text",!0).attr("fill","#000").text(function(a){return g[a]})})),b||x.montosGroup.selectAll("g.montos-item").style("display","block"),x.montosGroup.selectAll("rect.montos-item-frame").transition().duration(700).attr("x",x.margin).attr("y",x.margin).attr("height",c-2*x.margin).attr("width",d-2*x.margin),x.montosGroup.selectAll("text.montos-item-text").transition().duration(700).attr("x",15).attr("y",25),e(x.montosGroup.selectAll("g.montos-item").transition().duration(1e3).style("opacity",1),d,c)}function p(b){z.clusters={},z.clusterPoints={};var c=b?b.replace("montos-item-",""):!1,d=a.obras.filter(function(a){return a.monto_contrato&&""!=a.monto_contrato&&(!c||c&&a.monto_slug===c)}),e=Math.ceil(w.max(d,function(b){return b[a.selectedRadioDimension]})),f=Math.floor(w.min(d,function(b){return b[a.selectedRadioDimension]}));z.scale=w.scale.linear().domain([parseInt(f),parseInt(e)]).range([10,c?100:50]),z.nodes=d.map(function(a){var b="m-"+a.monto_slug,d=c?10:5,e={cluster:b,radius:d?d:10,data:a};return(!z.clusters[b]||d>z.clusters[b].radius)&&(z.clusters[b]=e),e}),c?z.clusterPoints=!1:w.selectAll("g.montos-item").each(function(a){var b=w.select(this),c=b.select("rect");z.clusterPoints["m-"+a]={x:w.transform(b.attr("transform")).translate[0]+c.attr("width")/2,y:w.transform(b.attr("transform")).translate[1]+c.attr("height")/2,radius:10}})}function q(a){I.classed("active",!1),I=w.select(null),w.selectAll("g.montos-item").style("display","block"),o(a),a||setTimeout(function(){p(),s()},2e3)}function r(b){if(!a.isSmallDevice){if(a.closeTooltip(),I.node()===this)return q();I.classed("active",!1),I=w.select(this).classed("active",!0);var c=I.node().parentNode;w.selectAll("g.montos-item").transition().style("opacity",function(){return this===c?1:0}).each("end",function(){this!==c&&w.select(this).style("display","none")}),I.transition().duration(750).attr("height",x.h-2*x.margin).attr("width",x.w-2*x.margin),w.select(c).transition().duration(750).attr("transform","translate(0,0)").each("end",function(){p(w.select(c).attr("id")),s()})}}function s(){z.force=w.layout.force().nodes(z.nodes).size([x.w,x.h]).gravity(0).charge(1).on("tick",t).start(),z.circles=z.group.selectAll("circle.obra").data(z.nodes),a.isSmallDevice||z.circles.enter().append("circle").attr("class",function(a){var b=a.data.red_slug?"red "+a.data.red_slug:"";return"obra "+a.data.tipo_slug+" "+a.data.area_slug+" "+a.data.etapa_slug+" "+b}).on("mouseenter",function(b){b.color_tipo_obra=a.tipo_colors(b.data.tipo),a.selectedObra=b,a.$apply();var c=w.select(this);x.selection.attr("cx",c.attr("cx")).attr("cy",c.attr("cy")).attr("r",0).style("stroke",b.color_tipo_obra).transition().duration(500).attr("r",13).style("opacity",1),a.tooltip.style("width","250px").transition().duration(200).style("left",w.event.pageX+"px").style("top",w.event.pageY+"px").style("opacity",1)}).on("mouseout",function(a){}),a.isSmallDevice&&z.circles.enter().append("circle").attr("class",function(a){var b=a.data.red_slug?"red "+a.data.red_slug:"";return"obra "+a.data.tipo_slug+" "+a.data.area_slug+" "+a.data.etapa_slug+" "+b}).on("click",function(b){b.color_tipo_obra=a.tipo_colors(b.data.tipo),a.selectedObra=b,w.selectAll("circle.obra").style("opacity",.3),w.select(this).style("opacity",1),a.$apply(),a.tooltip.style("width",x.w-20+"px").transition().duration(200).style("left","10px").style("top",w.event.pageY+"px").style("opacity",1)}),z.circles.attr("id",function(a){return"e"+a.data.id}).style("fill",function(b){return a.tipo_colors(b.data.tipo)}),z.circles.transition().style("opacity",1).attr("r",function(a){return a.radius}),z.circles.exit().remove(),a.filterBubbles(a.selectedFilter)}function t(a){z.circles.each(u(10*a.alpha*a.alpha)).each(v(.2)).attr("cx",function(a){return a.x}).attr("cy",function(a){return a.y})}function u(a){return function(b){var c=z.clusters[b.cluster],d=1;if(c){c===b&&(z.clusterPoints?(c=z.clusterPoints[b.cluster],c={x:c.x,y:c.y,radius:-c.radius},d=5*Math.sqrt(b.radius)):(c={x:x.w/2,y:x.h/2,radius:-b.radius},d=Math.sqrt(b.radius)));var e=b.x-c.x,f=b.y-c.y,g=Math.sqrt(e*e+f*f),h=b.radius+c.radius;g!==h&&(g=(g-h)/g*a*d,b.x-=e*=g,b.y-=f*=g,c.x+=e,c.y+=f)}}}function v(a){var b=w.geom.quadtree(z.nodes);return function(c){var d=c.radius+2,e=c.x-d,f=c.x+d,g=c.y-d,h=c.y+d;b.visit(function(b,d,i,j,k){if(b.point&&b.point!==c){var l=c.x-b.point.x,m=c.y-b.point.y,n=Math.sqrt(l*l+m*m),o=c.radius+b.point.radius+2;o>n&&(n=(n-o)/n*a,c.x-=l*=n,c.y-=m*=n,b.point.x+=l,b.point.y+=m)}return d>f||e>j||i>h||g>k})}}var w=window.d3;a.pymChild=new window.pym.Child({polling:1e3});var x={},y={},z={};a.tipo_colors=w.scale.ordinal().range(["#036633","#698AC6","#956336","#92C14D","#2B3180","#E3117E","#EF830C","#E31F20"]),a.selectedGroup=!1,a.oldGroup="mapa",a.selectedObra=!1,a.selectedFilter=!1,a.availableGroups=[{id:"mapa",name:"Mapa"},{id:"comunas",name:"Comunas"},{id:"montos",name:"InversiÃ³n"}],a.selectedRadioDimension="monto_contrato",a.tooltip=w.select("#tooltip-home-chart");var A={comunas:k,montos:o,mapa:g},B={comunas:l,montos:p,mapa:h},C={comunas:n,montos:q,mapa:j},D={comunas:!1,montos:!1,mapa:!1},E=window._,F=0;$(window).load(function(){F=$(window).width()}),b.getAll().then(function(b){a.obras=b,a.selectedGroup="mapa",f(),d(),window.$(window).resize(function(){F!=$(window).width()&&(clearTimeout(a.timeoutId),a.timeoutId=setTimeout(function(){D={comunas:!1,montos:!1,mapa:!1},f(),d()},1e3))})}),a.tipoChartFinished=function(){},a.filterBubbles=function(b){a.selectedFilter==b?(w.selectAll("circle.obra").style("opacity",1),b=!1):(w.selectAll("circle.obra").style("opacity",.3),w.selectAll("circle.obra."+b).style("opacity",1)),a.selectedFilter=b,a.closeTooltip(),a.$apply()},a.changeGroup=function(b){a.selectedGroup=b,a.showGroup()},a.showGroup=function(){a.oldGroup!==a.selectedGroup&&(a.closeTooltip(),C[a.oldGroup](!0),x.svg.selectAll(".child").style("opacity",0).style("display","none"),x.svg.selectAll("circle.obra").transition().style("opacity",.5),a.oldGroup=a.selectedGroup),A[a.selectedGroup]();var b=D[a.selectedGroup]||"mapa"===a.selectedGroup?100:2e3;D[a.selectedGroup]=!0,setTimeout(function(){B[a.selectedGroup](),s()},b)};var G=w.select(null),H=w.select(null),I=w.select(null);a.closeTooltip=function(){x.selection.transition().duration(200).attr("r",0).style("opacity",0),a.tooltip.transition().duration(200).style("top","-100px").style("opacity",0)}}]),angular.module("obrasMduytApp").controller("ObraCtrl",["$scope","DataService","$routeParams",function(a,b,c){a.pymChild=new window.pym.Child({polling:1e3}),a.pymChild.sendHeight(),a.obraId=c.id;var d={url:"//tiles1.usig.buenosaires.gob.ar/mapcache/tms/1.0.0/amba_con_transporte_3857@GoogleMapsCompatible/{z}/{x}/{y}.png",format:"tms",builder:"tms",baseLayer:!0,options:{maxZoom:18,minZoom:9,attribution:'USIG (<a href="http://www.buenosaires.gob.ar" target="_blank">GCBA</a>), Â© <a href="http://www.openstreetmap.org/copyright/en" target="_blank">OpenStreetMap</a> (ODbL)',tms:!0}};a.titles=d,angular.extend(a,{markers:{},center:{lat:-34.604,lng:-58.382,zoom:15},tiles:d,defaults:{scrollWheelZoom:!1}}),a.mainCallback=function(b){a.drawLineOnObraLoaded=b},a.drawFirstColored=function(b){a.firstColoredLoaded=b},a.drawSecondColored=function(b){a.secondColoredLoaded=b},b.getById(c.id).then(function(b){a.obra=b,!b.hideDates&&a.drawLineOnObraLoaded&&a.drawLineOnObraLoaded(b),b.beneficiarios&&a.firstColoredLoaded&&a.firstColoredLoaded(b),b.mano_obra&&a.secondColoredLoaded&&a.secondColoredLoaded(b),a.slides=b.fotos,angular.extend(a,{center:{lat:parseFloat(b.lat),lng:parseFloat(b.lng),zoom:15},markers:{m1:{lat:parseFloat(b.lat),lng:parseFloat(b.lng),focus:!0,message:b.nombre}}}),a.center.lat=parseFloat(b.lat),a.center.lng=parseFloat(b.lng);({starting_time:b.fecha_inicio,ending_time:b.fecha_fin_inicial})})}]),angular.module("obrasMduytApp").controller("EntornoCtrl",["$scope","DataService","$routeParams","leafletData","$timeout",function(a,b,c,d,e){a.pymChild=new window.pym.Child({polling:1e3}),a.pymChild.sendHeight();var f={url:"//tiles1.usig.buenosaires.gob.ar/mapcache/tms/1.0.0/amba_con_transporte_3857@GoogleMapsCompatible/{z}/{x}/{y}.png",format:"tms",builder:"tms",baseLayer:!0,options:{maxZoom:18,minZoom:9,attribution:'USIG (<a href="http://www.buenosaires.gob.ar" target="_blank">GCBA</a>), Â© <a href="http://www.openstreetmap.org/copyright/en" target="_blank">OpenStreetMap</a> (ODbL)',tms:!0}};a.titles=f,angular.extend(a,{markers:{},center:{lat:-34.604,lng:-58.382,zoom:15},tiles:f,defaults:{scrollWheelZoom:!1}}),b.getByEntorno(c.entorno).then(function(b){a.entorno=c.entorno,a.obras=b;for(var f={},g=[],h=0;h<b.length;h++){var i=b[h];if(i.lat&&i.lng){var j={lat:parseFloat(i.lat),lng:parseFloat(i.lng),focus:!0,message:i.nombre};f["m"+h]=j,g.push(L.marker([j.lat,j.lng]))}}var k=new L.featureGroup(g);angular.extend(a,{markers:f}),e(function(){d.getMap().then(function(a){a.fitBounds(k.getBounds(),{padding:[50,50]})})},1e3)})}]),angular.module("obrasMduytApp").controller("BuscadorCtrl",["$scope","DataService","$routeParams","NgTableParams","$filter","$sce","ngTableEventsChannel",function(a,b,c,d,e,f,g){a.pymChild=new window.pym.Child({polling:1e3}),a.pymChild.sendHeight(),a.montos_string={monto_0_50:"Hasta 50 millones",monto_50_100:"50  a 100 millones",monto_100_150:"100 a 150 millones",monto_mas_50:"MÃ¡s de 150 millones"},b.getAll().then(function(b){function c(a,b){return b[this.field]}function e(a,b){var c=b[this.field],d="";return c&&""!=c&&(d="<a href='"+c+"' class='btn btn-default btn-xs btn-block' target='_blank'>MÃ¡s informaciÃ³n</a>"),f.trustAsHtml(d)}function h(b){a.results=b.data}function i(){$('[ng-table-pagination="params"]').appendTo("#footer")}var j={comunas:d3.keys(d3.nest().key(function(a){return a.comuna}).map(b.filter(function(a){return null!==a.comuna}))).map(function(a){return{id:a.trim(),title:"Comuna "+a}}),etapas:d3.keys(d3.nest().key(function(a){return a.etapa}).map(b)).map(function(a){return{id:a,title:a}}),tipos:d3.keys(d3.nest().key(function(a){return a.tipo}).map(b)).map(function(a){return{id:a,title:a}}),montos:d3.keys(d3.nest().key(function(a){return a.monto_slug}).map(b.filter(function(a){return a.monto_slug}))).map(function(b){return{id:b,title:a.montos_string[b]}}),areas:d3.keys(d3.nest().key(function(a){return a.area_responsable}).map(b.filter(function(a){return a.area_responsable}))).map(function(a){return{id:a,title:a}})};j.comunas.unshift({id:"",title:"TODAS"}),j.etapas.unshift({id:"",title:"TODAS"}),j.areas.unshift({id:"",title:"TODAS"}),j.tipos.unshift({id:"",title:"TODOS"}),j.montos.unshift({id:"",title:"TODOS"}),a.cols=[];var k=function(a){return _.some(b,function(b){return b[a]})};k("comuna")&&a.cols.push({field:"comuna",title:"Comuna",filter:{comuna:"select"},filterData:j.comunas,show:!0,getValue:c}),a.cols.push({field:"nombre",title:"Nombre",filter:{nombre:"text"},show:!0,"class":"lupita",getValue:c}),k("area_responsable")&&a.cols.push({field:"area_responsable",title:"Ãrea Responsable",filter:{area_responsable:"select"},filterData:j.areas,show:!0,getValue:c}),k("etapa")&&a.cols.push({field:"etapa",title:"Etapa",filter:{etapa:"select"},filterData:j.etapas,show:!0,getValue:c}),k("tipo")&&a.cols.push({field:"tipo",title:"Tipo",filter:{tipo:"select"},filterData:j.tipos,show:!0,getValue:c}),k("monto_slug")&&a.cols.push({field:"monto_slug",title:"Monto InversiÃ³n",filter:{monto_slug:"select"},filterData:j.montos,show:!0,getValue:c}),k("link_interno")&&a.cols.push({field:"link_interno",title:"",filter:!1,show:!0,getValue:e}),k("licitacion_oferta_empresa")&&a.cols.push({field:"licitacion_oferta_empresa",title:"Empresa",filter:{licitacion_oferta_empresa:"text"},show:!0,"class":"lupita",getValue:c}),g.onAfterCreated(i,a),g.onAfterReloadData(h,a),a.tableParams=new d({sorting:{comuna:"asc"},filter:{comuna:"",etapa:"",tipo:"",monto_slug:"",area_responsable:""},page:1,count:10},{dataset:b,counts:[10,25,50]});a.timeoutId,window.$(window).resize(function(){clearTimeout(a.timeoutId),a.timeoutId=setTimeout(function(){},1e3)})})}]),angular.module("obrasMduytApp").run(["$templateCache",function(a){"use strict";a.put("views/buscador.html",'<div class="row"> <table id="buscador-table" ng-table-dynamic="tableParams with cols" class="table table-responsive"> <tr ng-repeat="row in $data"> </tr> </table> </div> <div class="row"> <h2 ng-show="results.length==0" class="text-center">No hay resultados para los filtros aplicados</h2> <div class="col-sm-12 well resultado-buscador" ng-repeat="o in results"> <div class="row"> <div class="col-sm-3"> <img ng-show="o.imagen_1" ng-src="{{o.imagen_1}}" class="img-responsive"> <img ng-hide="o.imagen_1" ng-src="http://placehold.it/400x300" class="img-responsive"> </div> <div class="col-sm-9"> <div class="row"> <div class="col-sm-6"> <span class="title">Obra:</span> <span class="desc">{{o.nombre}}</span> </div> <div class="col-sm-3" ng-if="o.licitacion_oferta_empresa"> <span class="title">Empresa:</span> <span class="desc">{{o.licitacion_oferta_empresa}}</span> </div> <div class="col-sm-3" ng-if="o.monto_contrato"> <span class="title">Monto inversiÃ³n:</span> <span class="desc">{{o.monto_contrato | currency}}</span> </div> </div> <div class="row"> <div class="col-sm-12"> <span class="title">DescripciÃ³n:</span> <span class="desc">{{o.descripcion}}</span> </div> </div> <div class="row"> <div class="col-sm-2" ng-if="o.area_responsable"> <span class="title">Ãrea Responsable:</span> <span class="desc">{{o.area_responsable}}</span> </div> <div class="col-sm-2" ng-if="o.tipo"> <span class="title">Tipo:</span> <span class="desc">{{o.tipo}}</span> </div> <div class="col-sm-2" ng-if="o.comuna"> <span class="title">Comuna:</span> <span class="desc">Comuna {{o.comuna}}</span> </div> <div class="col-sm-2" ng-if="o.etapa"> <span class="title">Etapa:</span> <span class="desc">{{o.etapa}}</span> </div> <div class="col-sm-3 col-sm-offset-1"> <a ng-show="o.link_interno" ng-href="{{o.link_interno}}" target="_parent" class="btn btn-default btn-block">MÃ¡s informaciÃ³n</a> </div> </div> </div> </div> </div> </div> <div class="row"> <div id="footer" class="col-sm-12"> </div> </div>'),
a.put("views/entorno.html",'<div class="row"> <div class="col-md-12"> <h2>Entorno: {{obras[0].entorno}}</h2> <div ng-repeat="obra in obras"> <!-- Obra: {{$index+1}} -> {{obra}} --> <div ng-include="\'views/includes/obra-detail.html\'"></div> </div> </div> </div> <div class="row"> <div class="col-md-12"> <h4> UbicaciÃ³n en el Mapa </h4> <leaflet center="center" tiles="tiles" markers="markers" defaults="defaults" width="100%" height="350px"></leaflet> </div> </div>'),a.put("views/home.html",'<div class="row"> <div class="col-sm-12"> <stats-home obras="obras"></stats-home> </div> </div> <selector-home list="availableGroups" selected-group="selectedGroup" update-fn="changeGroup(group)"></selector-home> <div class="row"> <div class="col-sm-12"> <tipo-chart obras="obras" selected-filter="selectedFilter" filter-fn="filterBubbles(filter)" tipo-colors="tipo_colors" finish-fn="tipoChartFinished()"></tipo-chart> </div> </div> <div class="row"> <div class="col-sm-12"> <area-responsable-chart obras="obras" selected-filter="selectedFilter" filter-fn="filterBubbles(filter)"></area-responsable-chart> </div> </div> <div id="main-chart-container" class="row"> <div class="col-sm-12"> <div id="home-chart-container"></div> </div> </div> <div class="row"> <div class="col-md-12"> <h4>Obras para una Ciudad a tu medida</h4> <p>En un solo vistazo, conocÃ© quÃ© estamos haciendo para mejorar la Ciudad.</p> </div> <div class="col-xs-4"> DÃ³nde: Comunas </div> <div class="col-xs-4 text-center"> QuÃ© hacemos: Tipos de obras </div> <div class="col-xs-4 text-right"> CÃ³mo vamos: Etapas </div> </div> <div class="row"> <div class="col-md-12"> <div id="sankey-chart-container"></div> </div> </div> <!-- Tooltip OBRAS --> <div id="tooltip-home-chart"> <button type="button" class="close pull-right" ng-click="closeTooltip()">&times;</button> <span class="main-title"><strong>{{selectedObra.data.nombre}}</strong></span> <div class="row compromiso-row" ng-show="selectedObra.data.compromiso"> <div class="col-xs-12"> <span class="label label-primary">Compromiso de Gobierno</span> </div> </div> <img class="obra-pic img-responsive" ng-show="selectedObra.data.fotos.length>0" ng-src="{{selectedObra.data.fotos[0]}}"> <span class="desc">{{selectedObra.data.etapa}} <span ng-show="selectedObra.data.porcentaje_avance">:{{selectedObra.data.porcentaje_avance}}%</span></span> <div ng-show="selectedObra.data.porcentaje_avance" class="progress"> <div class="progress-bar" role="progressbar" ng-style="{ \'width\': selectedObra.data.porcentaje_avance + \'%\', \'background-color\': selectedObra.color_tipo_obra, \'background-image\':\'none\' }"> <i ng-show="selectedObra.data.porcentaje_avance == 100" class="glyphicon glyphicon-ok"></i> </div> <div class="progress-w" ng-show="selectedObra.data.porcentaje_avance<22" ng-style="{ \'width\': (100 - selectedObra.data.porcentaje_avance) + \'%\' }"></div> </div> <span class="title">Responsable:</span> <span class="desc">{{selectedObra.data.area_responsable}}</span> <div class="row"> <div class="col-xs-10"> <span class="title">Tipo:</span> <span class="desc">{{selectedObra.data.tipo}}</span> </div> <div class="col-xs-2"> <img class="pull-right" width="50" ng-src="images/iconos/{{selectedObra.data.tipo_slug}}.svg"> </div> </div> <div class="row"> <div class="col-xs-12"> <a ng-show="selectedObra.data.link_interno" target="_parent" ng-href="{{selectedObra.data.link_interno}}" class="btn btn-default btn-xs btn-block">MÃ¡s informaciÃ³n</a> </div> </div> </div>'),a.put("views/includes/home-area.html",'<div id="area-responsable-chart" class="row chart-item" ng-if="total_obras_by_area.length"> <div class="col-md-2"><h4>Filtrar por Ã¡rea de gobierno</h4></div> <div class="col-md-5"> <select ng-show="total_obras_by_area.length" id="areas" class="form-control" ng-model="selected"> <option value>TODAS</option> <option ng-repeat="option in total_obras_by_area" value="{{option.slug}}">{{option.area}}</option> </select> </div> <div class="col-md-5"> <div id="mini-chart"></div> <p ng-show="selectedCantidad">{{selectedCantidad}} obras <span ng-show="selectedCantidad!=total">({{selectedCantidad*100/total | number:0}}% del total)</span> </p></div> </div>'),a.put("views/includes/obra-detail.html",'<div class="row obra"> <div class="col-md-12"> <h3>Obra: {{obra.nombre}}</h3> <div class="row"> <div class="col-md-8"> <img class="img-responsive" ng-src="{{obra.fotos[0]}}"> <p> {{obra.descripcion}} </p> </div> <div class="col-md-3 ficha-tecnica" ng-if="obra.hasDetail"> <h4> Ficha tÃ©cnica</h4> <div class="etapa" ng-if="obra.etapa"> <div class="row"> <div class="col-md-2"> <p>Etapa:</p> </div> <div class="col-md-10"> <p><strong>{{obra.etapa}}</strong></p> </div> </div> <div class="row" ng-if="obra.etapa_detalle"> <div class="col-md-2"> <p></p> </div> <div class="col-md-10"> <p> <small> {{obra.etapa_detalle}}</small> </p> </div> </div> </div> <div ng-if="obra.tipo"> <p> Tipo de obra: <strong>{{obra.tipo}}</strong> </p> </div> <p ng-if="obra.area_responsable"> Ãrea responsable: <strong> {{obra.area_responsable}}</strong></p> <p ng-show="obra.licitacion_oferta_empresa"> Empresa: <strong> {{obra.licitacion_oferta_empresa}}</strong></p> <p ng-if="obra.porcentaje_avance"> Estado: </p> <div class="progress" ng-if="obra.porcentaje_avance"> <div class="progress-bar bg-color-{{obra.slug}}" role="progressbar" ng-style="{ \'width\': obra.porcentaje_avance + \'%\' }"> <div class="progressbar-w" ng-show="!obra.porcentaje_avance"><p></p></div> <span class="progressbar-w" ng-hide="obra.porcentaje_avance<22 || !obra.porcentaje_avance"> </span> </div> <div class="progress-w" ng-show="obra.porcentaje_avance<22" ng-style="{ \'width\': (100 - obra.porcentaje_avance) + \'%\' }"></div> </div> <div ng-if="!obra.hideDates" class="row fechas" ng-show="obra.fecha_inicio"> <div class="col-md-6"> <p class="up"> Inicio</p> <p> {{obra.fecha_inicio}} </p> </div> <div class="col-md-6 right"> <p class="up"> Fin </p> <p> {{obra.fecha_fin_inicial}} </p> </div> </div> <p ng-if="obra.plazo_meses"> Plazo total: <strong> {{obra.plazo_meses}} meses </strong></p> <p ng-if="obra.benficiarios"> Cantidad de Beneficiaros: <strong> {{obra.benficiarios}} <small> personas</small> </strong></p> <p ng-if="obra.mano_obra"> Mano de Obra: <strong> {{obra.mano_obra}} <small>personas</small> </strong></p> <p ng-if="obra.monto_contrato"> Monto Contrato: <strong> {{obra.monto_contrato | currency}} </strong> </p> <p ng-if="obra.licitacion_presupuesto_oficial"> Monto Actualizado: <strong> {{obra.licitacion_presupuesto_oficial | currency}} </strong></p> <p ng-if="obra.pliego_descarga"><a ng-href="{{obra.pliego_descarga}}"><i class="detalle-frame-icon glyphicon glyphicon glyphicon-download-alt"> </i> Ver Pliego </a></p> </div> </div> </div> </div>'),a.put("views/includes/stats-home.html",'<div id="stats-home" class="row" ng-show="obras"> <div class="col-custom-2-5 col-sm-6"> <div class="row"> <div class="col-xs-4 icon-container"> <img class="" src="images/indicadores/inversion.svg"> </div> <div class="col-xs-8 value-container"> <h5>Total de inversiÃ³n:</h5> <span class="value">{{total.inversion | currency:$ :0}}</span> </div> </div> </div> <div class="col-custom-1-5 col-sm-6"> <div class="row"> <div class="col-xs-4 icon-container"> <img class="" src="images/indicadores/obras.svg"> </div> <div class="col-xs-8 value-container"> <h5>Total de obras:</h5> <span class="value">{{total.obras | number}}</span> </div> </div> </div> <div class="col-custom-1-5 col-sm-6"> <div class="row"> <div class="col-xs-4 icon-container"> <img class="" src="images/indicadores/finalizadas.svg"> </div> <div class="col-xs-8 value-container"> <h5>Finalizadas:</h5> <span class="value">{{total.porcentaje_finalizadas}}%</span> </div> </div> </div> <div class="col-custom-1-5 col-sm-6"> <div class="row"> <div class="col-xs-4 icon-container"> <img class="" src="images/indicadores/personas.svg"> </div> <div class="col-xs-8 value-container"> <h5>Empleados:</h5> <span class="value">{{total.mano_obra | number}}</span> </div> </div> </div> </div>'),a.put("views/obra.html",'<div class="row obra"> <div class="col-md-12"> <h3>{{obra.nombre}}</h3> <div class="row"> <div class="col-md-8"> <flex-slider slide="s in slides" animation="slide" control-nav="thumbnails"> <li data-thumb="{{s}}"> <img ng-src="{{s}}"> </li> </flex-slider> <p> {{obra.descripcion}} </p> </div> <div class="col-md-3 ficha-tecnica" ng-if="obra.hasDetail"> <h4> Ficha tÃ©cnica</h4> <div class="etapa" ng-if="obra.etapa"> <div class="row"> <div class="col-md-2"> <p>Etapa:</p> </div> <div class="col-md-10"> <p><strong>{{obra.etapa}}</strong></p> </div> </div> <div class="row" ng-if="obra.etapa_detalle"> <div class="col-md-2"> <p></p> </div> <div class="col-md-10"> <p> <small> {{obra.etapa_detalle}}</small> </p> </div> </div> </div> <div ng-if="obra.tipo"> <p> Tipo de obra: <strong>{{obra.tipo}}</strong> </p> </div> <p ng-if="obra.area_responsable"> Ãrea responsable: <strong> {{obra.area_responsable}}</strong></p> <p ng-show="obra.licitacion_oferta_empresa" ng-if="obra.licitacion_oferta_empresa"> Empresa: <strong> {{obra.licitacion_oferta_empresa}}</strong></p> <p ng-if="obra.porcentaje_avance"> Estado: </p> <div class="progress" ng-if="obra.porcentaje_avance"> <div class="progress-bar bg-color-{{obra.slug}}" role="progressbar" ng-style="{ \'width\': obra.porcentaje_avance + \'%\' }"> <div class="progressbar-w" ng-show="!obra.porcentaje_avance"><p></p></div> <span class="progressbar-w" ng-hide="obra.porcentaje_avance<22 || !obra.porcentaje_avance"> </span> </div> <div class="progress-w" ng-show="obra.porcentaje_avance<22" ng-style="{ \'width\': (100 - obra.porcentaje_avance) + \'%\' }"></div> </div> <div ng-if="!obra.hideDates" class="row fechas" ng-show="obra.fecha_inicio"> <div class="col-md-12"> <progress-line callback="mainCallback"> </progress-line> </div> </div> <p ng-if="obra.plazo_meses"> Plazo total: <strong> {{obra.plazo_meses}} meses </strong></p> <p ng-if="obra.hideDates && obra.licitacion_anio"> AÃ±o de licitaciÃ³n: <strong> {{obra.licitacion_anio}} </strong></p>  <p ng-if="obra.beneficiarios"> Cantidad de Beneficiaros: <strong> {{obra.benficiarios}} <small> personas</small> </strong></p> <colored-icons scale="\'beneficiarios\'" callback="drawFirstColored" ng-if="obra.beneficiarios"></colored-icons> <p ng-if="obra.mano_obra"> Mano de Obra: <strong> {{obra.mano_obra}} <small>personas</small> </strong></p> <colored-icons scale="\'manoDeObra\'" callback="drawSecondColored" ng-if="obra.mano_obra"></colored-icons> <p ng-if="obra.monto_contrato"> Monto Contrato: <strong> {{obra.monto_contrato | currency}} </strong> </p> <p ng-if="obra.licitacion_presupuesto_oficial"> Monto Actualizado: <strong> {{obra.licitacion_presupuesto_oficial | currency}} </strong></p> <p ng-if="obra.pliego_descarga"><a ng-href="{{obra.pliego_descarga}}"><i class="detalle-frame-icon glyphicon glyphicon glyphicon-download-alt"> </i> Ver Pliego </a></p> </div> </div> </div> </div> <div class="row"> <div class="col-md-12"> <h4> UbicaciÃ³n de obra </h4> <leaflet center="center" tiles="tiles" markers="markers" defaults="defaults" width="100%" height="350px"></leaflet> </div> </div>')}]);